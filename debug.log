2024-09-19T11:41:10.505443+0300  INFO  API_OPEN_AI обработан
2024-09-19T11:41:10.505443+0300  INFO  API_OPEN_AI обработан
2024-09-19T11:41:10.506094+0300  INFO  Ошибка при обработке запроса: Missing required arguments; Expected either ('messages' and 'model') or ('messages', 'model' and 'stream') arguments to be given
2024-09-19T11:41:10.506094+0300  INFO  Ошибка при обработке запроса: Missing required arguments; Expected either ('messages' and 'model') or ('messages', 'model' and 'stream') arguments to be given
2024-09-19T11:41:55.750141+0300  INFO  API_OPEN_AI обработан
2024-09-19T11:41:55.750141+0300  INFO  API_OPEN_AI обработан
2024-09-19T11:41:55.750770+0300  INFO  Ошибка при обработке запроса: Missing required arguments; Expected either ('messages' and 'model') or ('messages', 'model' and 'stream') arguments to be given
2024-09-19T11:41:55.750770+0300  INFO  Ошибка при обработке запроса: Missing required arguments; Expected either ('messages' and 'model') or ('messages', 'model' and 'stream') arguments to be given
2024-09-19T11:42:46.047986+0300  INFO  API_OPEN_AI обработан
2024-09-19T11:42:46.047986+0300  INFO  API_OPEN_AI обработан
2024-09-19T11:42:46.048542+0300  INFO  Ошибка при обработке запроса: Missing required arguments; Expected either ('messages' and 'model') or ('messages', 'model' and 'stream') arguments to be given
2024-09-19T11:42:46.048542+0300  INFO  Ошибка при обработке запроса: Missing required arguments; Expected either ('messages' and 'model') or ('messages', 'model' and 'stream') arguments to be given
2024-09-19T11:44:27.794961+0300  INFO  API_OPEN_AI обработан
2024-09-19T11:44:27.794961+0300  INFO  API_OPEN_AI обработан
2024-09-19T11:44:27.795506+0300  INFO  Ошибка при обработке запроса: Missing required arguments; Expected either ('messages' and 'model') or ('messages', 'model' and 'stream') arguments to be given
2024-09-19T11:44:27.795506+0300  INFO  Ошибка при обработке запроса: Missing required arguments; Expected either ('messages' and 'model') or ('messages', 'model' and 'stream') arguments to be given
2024-09-19T11:45:30.846000+0300  INFO  API_OPEN_AI обработан
2024-09-19T11:45:30.846000+0300  INFO  API_OPEN_AI обработан
2024-09-19T11:45:30.846465+0300  INFO  Ошибка при обработке запроса: Missing required arguments; Expected either ('messages' and 'model') or ('messages', 'model' and 'stream') arguments to be given
2024-09-19T11:45:30.846465+0300  INFO  Ошибка при обработке запроса: Missing required arguments; Expected either ('messages' and 'model') or ('messages', 'model' and 'stream') arguments to be given
2024-09-19T11:47:56.581490+0300  INFO  API_OPEN_AI обработан
2024-09-19T11:47:56.581490+0300  INFO  API_OPEN_AI обработан
2024-09-19T11:47:57.635387+0300  INFO  Ошибка при обработке запроса: Error code: 400 - {'error': {'message': "Invalid type for 'messages[1].content[0]': expected an object, but got a string instead.", 'type': 'invalid_request_error', 'param': 'messages[1].content[0]', 'code': 'invalid_type'}}
2024-09-19T11:47:57.635387+0300  INFO  Ошибка при обработке запроса: Error code: 400 - {'error': {'message': "Invalid type for 'messages[1].content[0]': expected an object, but got a string instead.", 'type': 'invalid_request_error', 'param': 'messages[1].content[0]', 'code': 'invalid_type'}}
2024-09-19T11:51:16.676666+0300  INFO  API_OPEN_AI обработан
2024-09-19T11:51:16.676666+0300  INFO  API_OPEN_AI обработан
2024-09-19T11:51:17.635884+0300  INFO  Ошибка при обработке запроса: Error code: 400 - {'error': {'message': "Invalid type for 'messages[1].content[0]': expected an object, but got a string instead.", 'type': 'invalid_request_error', 'param': 'messages[1].content[0]', 'code': 'invalid_type'}}
2024-09-19T11:51:17.635884+0300  INFO  Ошибка при обработке запроса: Error code: 400 - {'error': {'message': "Invalid type for 'messages[1].content[0]': expected an object, but got a string instead.", 'type': 'invalid_request_error', 'param': 'messages[1].content[0]', 'code': 'invalid_type'}}
2024-09-19T11:56:30.870899+0300  INFO  API_OPEN_AI обработан
2024-09-19T11:56:30.870899+0300  INFO  API_OPEN_AI обработан
2024-09-19T11:56:31.556746+0300  INFO  Ошибка при обработке запроса: Error code: 400 - {'error': {'message': "Invalid type for 'messages[1].content[0]': expected an object, but got a string instead.", 'type': 'invalid_request_error', 'param': 'messages[1].content[0]', 'code': 'invalid_type'}}
2024-09-19T11:56:31.556746+0300  INFO  Ошибка при обработке запроса: Error code: 400 - {'error': {'message': "Invalid type for 'messages[1].content[0]': expected an object, but got a string instead.", 'type': 'invalid_request_error', 'param': 'messages[1].content[0]', 'code': 'invalid_type'}}
2024-09-19T12:04:38.908125+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:04:38.908125+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:04:40.592449+0300  INFO  Обработка файла завершена
2024-09-19T12:04:40.592449+0300  INFO  Обработка файла завершена
2024-09-19T12:05:11.568452+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:05:11.568452+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:05:11.568452+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:05:12.861290+0300  INFO  Обработка файла завершена
2024-09-19T12:05:12.861290+0300  INFO  Обработка файла завершена
2024-09-19T12:05:12.861290+0300  INFO  Обработка файла завершена
2024-09-19T12:05:20.719715+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:05:20.719715+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:05:20.719715+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:05:20.719715+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:05:25.557740+0300  INFO  Обработка файла завершена
2024-09-19T12:05:25.557740+0300  INFO  Обработка файла завершена
2024-09-19T12:05:25.557740+0300  INFO  Обработка файла завершена
2024-09-19T12:05:25.557740+0300  INFO  Обработка файла завершена
2024-09-19T12:11:09.228472+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:11:09.228472+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:11:11.124154+0300  INFO  Обработка файла завершена
2024-09-19T12:11:11.124154+0300  INFO  Обработка файла завершена
2024-09-19T12:11:54.664220+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:11:54.664220+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:11:56.539961+0300  INFO  Обработка файла завершена
2024-09-19T12:11:56.539961+0300  INFO  Обработка файла завершена
2024-09-19T12:12:24.737467+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:12:24.737467+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:12:24.737467+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:12:26.628660+0300  INFO  Обработка файла завершена
2024-09-19T12:12:26.628660+0300  INFO  Обработка файла завершена
2024-09-19T12:12:26.628660+0300  INFO  Обработка файла завершена
2024-09-19T12:15:22.511257+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:15:22.511257+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:15:22.511257+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:15:22.511257+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:15:30.067371+0300  INFO  Обработка файла завершена
2024-09-19T12:15:30.067371+0300  INFO  Обработка файла завершена
2024-09-19T12:15:30.067371+0300  INFO  Обработка файла завершена
2024-09-19T12:15:30.067371+0300  INFO  Обработка файла завершена
2024-09-19T12:15:41.944027+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:15:41.944027+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:15:41.944027+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:15:41.944027+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:15:41.944027+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:15:43.207013+0300  INFO  Обработка файла завершена
2024-09-19T12:15:43.207013+0300  INFO  Обработка файла завершена
2024-09-19T12:15:43.207013+0300  INFO  Обработка файла завершена
2024-09-19T12:15:43.207013+0300  INFO  Обработка файла завершена
2024-09-19T12:15:43.207013+0300  INFO  Обработка файла завершена
2024-09-19T12:15:55.630733+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:15:55.630733+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:15:55.630733+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:15:55.630733+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:15:55.630733+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:15:55.630733+0300  INFO  API_OPEN_AI обработан
2024-09-19T12:16:03.233528+0300  INFO  Обработка файла завершена
2024-09-19T12:16:03.233528+0300  INFO  Обработка файла завершена
2024-09-19T12:16:03.233528+0300  INFO  Обработка файла завершена
2024-09-19T12:16:03.233528+0300  INFO  Обработка файла завершена
2024-09-19T12:16:03.233528+0300  INFO  Обработка файла завершена
2024-09-19T12:16:03.233528+0300  INFO  Обработка файла завершена
2024-09-19T12:44:35.872162+0300  INFO  Ошибка при обработке запроса: Invalid `http_client` argument; Expected an instance of `httpx.Client` but got <class 'httpx.AsyncClient'>
2024-09-19T12:44:35.872162+0300  INFO  Ошибка при обработке запроса: Invalid `http_client` argument; Expected an instance of `httpx.Client` but got <class 'httpx.AsyncClient'>
2024-09-19T12:45:52.753514+0300  INFO  Ошибка при обработке запроса: OpenAI.__init__() got an unexpected keyword argument 'http_async_client'
2024-09-19T12:45:52.753514+0300  INFO  Ошибка при обработке запроса: OpenAI.__init__() got an unexpected keyword argument 'http_async_client'
2024-09-19T12:46:10.468106+0300  INFO  Ошибка при обработке запроса: OpenAI.__init__() got an unexpected keyword argument 'http_async_client'
2024-09-19T12:46:10.468106+0300  INFO  Ошибка при обработке запроса: OpenAI.__init__() got an unexpected keyword argument 'http_async_client'
2024-09-19T13:52:55.032978+0300  INFO  API_OPEN_AI обработан
2024-09-19T13:52:55.034037+0300  INFO  Бот запущен
2024-09-19T14:15:12.510581+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:15:12.511459+0300  INFO  Бот запущен
2024-09-19T14:20:46.676839+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:20:46.677964+0300  INFO  Бот запущен
2024-09-19T14:21:13.695043+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:21:13.696045+0300  INFO  Бот запущен
2024-09-19T14:23:02.329651+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:23:02.330561+0300  INFO  Бот запущен
2024-09-19T14:23:48.949488+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:23:48.950380+0300  INFO  Бот запущен
2024-09-19T14:24:11.914835+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:24:11.915776+0300  INFO  Бот запущен
2024-09-19T14:25:22.474097+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:25:22.475021+0300  INFO  Бот запущен
2024-09-19T14:26:32.169134+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:27:31.534585+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:27:31.535743+0300  INFO  Бот запущен
2024-09-19T14:28:24.279885+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:28:24.280757+0300  INFO  Бот запущен
2024-09-19T14:31:59.906560+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:31:59.907441+0300  INFO  Бот запущен
2024-09-19T14:34:09.625819+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:34:09.626962+0300  INFO  Бот запущен
2024-09-19T14:37:15.458330+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:37:15.459204+0300  INFO  Бот запущен
2024-09-19T14:47:10.807779+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:47:46.900426+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:47:46.902303+0300  INFO  Бот запущен
2024-09-19T14:48:59.737668+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:48:59.737668+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:48:59.737668+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:48:59.737668+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:56:05.488482+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:56:05.488482+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:56:05.488482+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:56:24.670239+0300  ERROR  Ошибка при обновлении сообщения: 'str' object has no attribute 'html_text'
2024-09-19T14:56:24.670239+0300  ERROR  Ошибка при обновлении сообщения: 'str' object has no attribute 'html_text'
2024-09-19T14:56:24.670239+0300  ERROR  Ошибка при обновлении сообщения: 'str' object has no attribute 'html_text'
2024-09-19T14:57:05.291208+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:57:05.291208+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:57:05.291208+0300  INFO  API_OPEN_AI обработан
2024-09-19T14:57:14.421590+0300  ERROR  Ошибка при обновлении сообщения: BaseModel.__init__() takes 1 positional argument but 2 were given
2024-09-19T14:57:14.421590+0300  ERROR  Ошибка при обновлении сообщения: BaseModel.__init__() takes 1 positional argument but 2 were given
2024-09-19T14:57:14.421590+0300  ERROR  Ошибка при обновлении сообщения: BaseModel.__init__() takes 1 positional argument but 2 were given
2024-09-19T15:02:21.409464+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:02:21.409464+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:02:21.409464+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:03:35.238563+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:03:35.238563+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:03:35.238563+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:03:45.888873+0300  ERROR  Ошибка при обновлении сообщения: Telegram server says - Bad Request: can't parse entities: Unsupported start tag "tgbot/tgbot.h" at byte offset 1407
2024-09-19T15:03:45.888873+0300  ERROR  Ошибка при обновлении сообщения: Telegram server says - Bad Request: can't parse entities: Unsupported start tag "tgbot/tgbot.h" at byte offset 1407
2024-09-19T15:03:45.888873+0300  ERROR  Ошибка при обновлении сообщения: Telegram server says - Bad Request: can't parse entities: Unsupported start tag "tgbot/tgbot.h" at byte offset 1407
2024-09-19T15:04:30.543441+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:04:30.543441+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:04:30.543441+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:09:07.859286+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:09:07.859286+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:09:07.859286+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:09:09.159381+0300  INFO  Ответ gpt получен
2024-09-19T15:09:09.159381+0300  INFO  Ответ gpt получен
2024-09-19T15:09:09.159381+0300  INFO  Ответ gpt получен
2024-09-19T15:09:17.890589+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:09:17.890589+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:09:17.890589+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:09:17.890589+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:09:17.890589+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:09:26.843587+0300  ERROR  Ошибка при обновлении сообщения: Telegram server says - Bad Request: can't parse entities: Unsupported start tag "iostream" at byte offset 370
2024-09-19T15:09:26.843587+0300  ERROR  Ошибка при обновлении сообщения: Telegram server says - Bad Request: can't parse entities: Unsupported start tag "iostream" at byte offset 370
2024-09-19T15:09:26.843587+0300  ERROR  Ошибка при обновлении сообщения: Telegram server says - Bad Request: can't parse entities: Unsupported start tag "iostream" at byte offset 370
2024-09-19T15:09:26.843587+0300  ERROR  Ошибка при обновлении сообщения: Telegram server says - Bad Request: can't parse entities: Unsupported start tag "iostream" at byte offset 370
2024-09-19T15:09:26.843587+0300  ERROR  Ошибка при обновлении сообщения: Telegram server says - Bad Request: can't parse entities: Unsupported start tag "iostream" at byte offset 370
2024-09-19T15:10:45.375352+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:10:45.375352+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:10:45.375352+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:10:53.317981+0300  INFO  Ответ gpt получен
2024-09-19T15:10:53.317981+0300  INFO  Ответ gpt получен
2024-09-19T15:10:53.317981+0300  INFO  Ответ gpt получен
2024-09-19T15:13:02.046812+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:13:02.046812+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:13:02.046812+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:13:03.374125+0300  INFO  Ответ gpt получен
2024-09-19T15:13:03.374125+0300  INFO  Ответ gpt получен
2024-09-19T15:13:03.374125+0300  INFO  Ответ gpt получен
2024-09-19T15:13:11.450595+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:13:11.450595+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:13:11.450595+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:13:11.450595+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:13:11.450595+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:13:21.681361+0300  INFO  Ответ gpt получен
2024-09-19T15:13:21.681361+0300  INFO  Ответ gpt получен
2024-09-19T15:13:21.681361+0300  INFO  Ответ gpt получен
2024-09-19T15:13:21.681361+0300  INFO  Ответ gpt получен
2024-09-19T15:13:21.681361+0300  INFO  Ответ gpt получен
2024-09-19T15:16:32.536368+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:16:32.536368+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:16:32.536368+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:16:37.041377+0300  INFO  Ответ gpt получен
2024-09-19T15:16:37.041377+0300  INFO  Ответ gpt получен
2024-09-19T15:16:37.041377+0300  INFO  Ответ gpt получен
2024-09-19T15:16:57.057070+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:16:57.057070+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:16:57.057070+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:16:57.057070+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:16:57.057070+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:17:04.632408+0300  INFO  Ответ gpt получен
2024-09-19T15:17:04.632408+0300  INFO  Ответ gpt получен
2024-09-19T15:17:04.632408+0300  INFO  Ответ gpt получен
2024-09-19T15:17:04.632408+0300  INFO  Ответ gpt получен
2024-09-19T15:17:04.632408+0300  INFO  Ответ gpt получен
2024-09-19T15:19:24.597474+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:19:24.597474+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:19:24.597474+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:19:29.116369+0300  INFO  Ответ gpt получен
2024-09-19T15:19:29.116369+0300  INFO  Ответ gpt получен
2024-09-19T15:19:29.116369+0300  INFO  Ответ gpt получен
2024-09-19T15:28:03.713736+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:28:03.713736+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:28:03.713736+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:28:03.713736+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:28:03.713736+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:28:12.294600+0300  INFO  Ответ gpt получен
2024-09-19T15:28:12.294600+0300  INFO  Ответ gpt получен
2024-09-19T15:28:12.294600+0300  INFO  Ответ gpt получен
2024-09-19T15:28:12.294600+0300  INFO  Ответ gpt получен
2024-09-19T15:28:12.294600+0300  INFO  Ответ gpt получен
2024-09-19T15:38:02.783728+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:38:02.783728+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:38:02.783728+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:38:10.287271+0300  INFO  Ответ gpt получен
2024-09-19T15:38:10.287271+0300  INFO  Ответ gpt получен
2024-09-19T15:38:10.287271+0300  INFO  Ответ gpt получен
2024-09-19T15:40:35.810051+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:40:35.810051+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:40:35.810051+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:40:35.810051+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:40:35.810051+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:40:47.108571+0300  INFO  Ответ gpt получен
2024-09-19T15:40:47.108571+0300  INFO  Ответ gpt получен
2024-09-19T15:40:47.108571+0300  INFO  Ответ gpt получен
2024-09-19T15:40:47.108571+0300  INFO  Ответ gpt получен
2024-09-19T15:40:47.108571+0300  INFO  Ответ gpt получен
2024-09-19T15:44:05.420258+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:44:05.420258+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:44:05.420258+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:44:13.971548+0300  INFO  Ответ gpt получен
2024-09-19T15:44:13.971548+0300  INFO  Ответ gpt получен
2024-09-19T15:44:13.971548+0300  INFO  Ответ gpt получен
2024-09-19T15:50:39.267683+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:50:39.267683+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:50:39.267683+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:50:40.620290+0300  INFO  Ответ gpt получен
2024-09-19T15:50:40.620290+0300  INFO  Ответ gpt получен
2024-09-19T15:50:40.620290+0300  INFO  Ответ gpt получен
2024-09-19T15:53:19.401775+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:53:19.401775+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:53:19.401775+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:53:28.484525+0300  INFO  Ответ gpt получен
2024-09-19T15:53:28.484525+0300  INFO  Ответ gpt получен
2024-09-19T15:53:28.484525+0300  INFO  Ответ gpt получен
2024-09-19T15:54:23.834374+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:54:23.834374+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:54:23.834374+0300  INFO  API_OPEN_AI обработан
2024-09-19T15:54:25.236660+0300  INFO  Ответ gpt получен
2024-09-19T15:54:25.236660+0300  INFO  Ответ gpt получен
2024-09-19T15:54:25.236660+0300  INFO  Ответ gpt получен
2024-09-19T16:02:25.774833+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:02:25.774833+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:02:25.774833+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:02:27.604307+0300  INFO  Ответ gpt получен
2024-09-19T16:02:27.604307+0300  INFO  Ответ gpt получен
2024-09-19T16:02:27.604307+0300  INFO  Ответ gpt получен
2024-09-19T16:02:54.401339+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:02:54.401339+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:02:54.401339+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:02:54.401339+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:02:54.401339+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:02:55.599369+0300  INFO  Ответ gpt получен
2024-09-19T16:02:55.599369+0300  INFO  Ответ gpt получен
2024-09-19T16:02:55.599369+0300  INFO  Ответ gpt получен
2024-09-19T16:02:55.599369+0300  INFO  Ответ gpt получен
2024-09-19T16:02:55.599369+0300  INFO  Ответ gpt получен
2024-09-19T16:03:00.395370+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:00.395370+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:00.395370+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:00.395370+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:00.395370+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:00.395370+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:00.395370+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:01.813537+0300  INFO  Ответ gpt получен
2024-09-19T16:03:01.813537+0300  INFO  Ответ gpt получен
2024-09-19T16:03:01.813537+0300  INFO  Ответ gpt получен
2024-09-19T16:03:01.813537+0300  INFO  Ответ gpt получен
2024-09-19T16:03:01.813537+0300  INFO  Ответ gpt получен
2024-09-19T16:03:01.813537+0300  INFO  Ответ gpt получен
2024-09-19T16:03:01.813537+0300  INFO  Ответ gpt получен
2024-09-19T16:03:07.525776+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:07.525776+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:07.525776+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:07.525776+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:07.525776+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:07.525776+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:07.525776+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:07.525776+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:07.525776+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:08.661059+0300  INFO  Ответ gpt получен
2024-09-19T16:03:08.661059+0300  INFO  Ответ gpt получен
2024-09-19T16:03:08.661059+0300  INFO  Ответ gpt получен
2024-09-19T16:03:08.661059+0300  INFO  Ответ gpt получен
2024-09-19T16:03:08.661059+0300  INFO  Ответ gpt получен
2024-09-19T16:03:08.661059+0300  INFO  Ответ gpt получен
2024-09-19T16:03:08.661059+0300  INFO  Ответ gpt получен
2024-09-19T16:03:08.661059+0300  INFO  Ответ gpt получен
2024-09-19T16:03:08.661059+0300  INFO  Ответ gpt получен
2024-09-19T16:03:11.817500+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:11.817500+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:11.817500+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:11.817500+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:11.817500+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:11.817500+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:11.817500+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:11.817500+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:11.817500+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:11.817500+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:11.817500+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:13.133974+0300  INFO  Ответ gpt получен
2024-09-19T16:03:13.133974+0300  INFO  Ответ gpt получен
2024-09-19T16:03:13.133974+0300  INFO  Ответ gpt получен
2024-09-19T16:03:13.133974+0300  INFO  Ответ gpt получен
2024-09-19T16:03:13.133974+0300  INFO  Ответ gpt получен
2024-09-19T16:03:13.133974+0300  INFO  Ответ gpt получен
2024-09-19T16:03:13.133974+0300  INFO  Ответ gpt получен
2024-09-19T16:03:13.133974+0300  INFO  Ответ gpt получен
2024-09-19T16:03:13.133974+0300  INFO  Ответ gpt получен
2024-09-19T16:03:13.133974+0300  INFO  Ответ gpt получен
2024-09-19T16:03:13.133974+0300  INFO  Ответ gpt получен
2024-09-19T16:03:18.533948+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:18.533948+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:18.533948+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:18.533948+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:18.533948+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:18.533948+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:18.533948+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:18.533948+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:18.533948+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:18.533948+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:18.533948+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:18.533948+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:18.533948+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:03:20.033214+0300  INFO  Ответ gpt получен
2024-09-19T16:03:20.033214+0300  INFO  Ответ gpt получен
2024-09-19T16:03:20.033214+0300  INFO  Ответ gpt получен
2024-09-19T16:03:20.033214+0300  INFO  Ответ gpt получен
2024-09-19T16:03:20.033214+0300  INFO  Ответ gpt получен
2024-09-19T16:03:20.033214+0300  INFO  Ответ gpt получен
2024-09-19T16:03:20.033214+0300  INFO  Ответ gpt получен
2024-09-19T16:03:20.033214+0300  INFO  Ответ gpt получен
2024-09-19T16:03:20.033214+0300  INFO  Ответ gpt получен
2024-09-19T16:03:20.033214+0300  INFO  Ответ gpt получен
2024-09-19T16:03:20.033214+0300  INFO  Ответ gpt получен
2024-09-19T16:03:20.033214+0300  INFO  Ответ gpt получен
2024-09-19T16:03:20.033214+0300  INFO  Ответ gpt получен
2024-09-19T16:09:57.167334+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:09:57.167334+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:09:57.167334+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:09:57.167334+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:09:57.167334+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:09:57.167334+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:09:57.167334+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:09:57.167334+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:09:57.167334+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:09:57.167334+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:09:57.167334+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:09:57.167334+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:09:57.167334+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:09:57.167334+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:09:57.167334+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:10:19.948956+0300  INFO  Ответ gpt получен
2024-09-19T16:10:19.948956+0300  INFO  Ответ gpt получен
2024-09-19T16:10:19.948956+0300  INFO  Ответ gpt получен
2024-09-19T16:10:19.948956+0300  INFO  Ответ gpt получен
2024-09-19T16:10:19.948956+0300  INFO  Ответ gpt получен
2024-09-19T16:10:19.948956+0300  INFO  Ответ gpt получен
2024-09-19T16:10:19.948956+0300  INFO  Ответ gpt получен
2024-09-19T16:10:19.948956+0300  INFO  Ответ gpt получен
2024-09-19T16:10:19.948956+0300  INFO  Ответ gpt получен
2024-09-19T16:10:19.948956+0300  INFO  Ответ gpt получен
2024-09-19T16:10:19.948956+0300  INFO  Ответ gpt получен
2024-09-19T16:10:19.948956+0300  INFO  Ответ gpt получен
2024-09-19T16:10:19.948956+0300  INFO  Ответ gpt получен
2024-09-19T16:10:19.948956+0300  INFO  Ответ gpt получен
2024-09-19T16:10:19.948956+0300  INFO  Ответ gpt получен
2024-09-19T16:11:37.464460+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:11:37.464460+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:11:37.464460+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:11:37.464460+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:11:37.464460+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:11:37.464460+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:11:37.464460+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:11:37.464460+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:11:37.464460+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:11:37.464460+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:11:37.464460+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:11:37.464460+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:11:37.464460+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:11:37.464460+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:11:37.464460+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:11:37.464460+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:11:37.464460+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:11:47.926082+0300  INFO  Ответ gpt получен
2024-09-19T16:11:47.926082+0300  INFO  Ответ gpt получен
2024-09-19T16:11:47.926082+0300  INFO  Ответ gpt получен
2024-09-19T16:11:47.926082+0300  INFO  Ответ gpt получен
2024-09-19T16:11:47.926082+0300  INFO  Ответ gpt получен
2024-09-19T16:11:47.926082+0300  INFO  Ответ gpt получен
2024-09-19T16:11:47.926082+0300  INFO  Ответ gpt получен
2024-09-19T16:11:47.926082+0300  INFO  Ответ gpt получен
2024-09-19T16:11:47.926082+0300  INFO  Ответ gpt получен
2024-09-19T16:11:47.926082+0300  INFO  Ответ gpt получен
2024-09-19T16:11:47.926082+0300  INFO  Ответ gpt получен
2024-09-19T16:11:47.926082+0300  INFO  Ответ gpt получен
2024-09-19T16:11:47.926082+0300  INFO  Ответ gpt получен
2024-09-19T16:11:47.926082+0300  INFO  Ответ gpt получен
2024-09-19T16:11:47.926082+0300  INFO  Ответ gpt получен
2024-09-19T16:11:47.926082+0300  INFO  Ответ gpt получен
2024-09-19T16:11:47.926082+0300  INFO  Ответ gpt получен
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:22.406583+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:13:33.585220+0300  INFO  Ответ gpt получен
2024-09-19T16:14:23.617852+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:14:23.617852+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:14:23.617852+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:14:23.617852+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:14:25.304902+0300  INFO  Ответ gpt получен
2024-09-19T16:14:25.304902+0300  INFO  Ответ gpt получен
2024-09-19T16:14:25.304902+0300  INFO  Ответ gpt получен
2024-09-19T16:14:25.304902+0300  INFO  Ответ gpt получен
2024-09-19T16:14:31.719369+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:14:31.719369+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:14:31.719369+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:14:31.719369+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:14:31.719369+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:14:31.719369+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:14:41.297577+0300  INFO  Ответ gpt получен
2024-09-19T16:14:41.297577+0300  INFO  Ответ gpt получен
2024-09-19T16:14:41.297577+0300  INFO  Ответ gpt получен
2024-09-19T16:14:41.297577+0300  INFO  Ответ gpt получен
2024-09-19T16:14:41.297577+0300  INFO  Ответ gpt получен
2024-09-19T16:14:41.297577+0300  INFO  Ответ gpt получен
2024-09-19T16:16:18.172951+0300  ERROR  Ошибка при вводе команды /start: Telegram server says - Bad Request: can't parse entities: Character '!' is reserved and must be escaped with the preceding '\'
2024-09-19T16:16:18.172951+0300  ERROR  Ошибка при вводе команды /start: Telegram server says - Bad Request: can't parse entities: Character '!' is reserved and must be escaped with the preceding '\'
2024-09-19T16:18:42.422342+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:18:42.422342+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:18:42.422342+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:18:42.422342+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:18:57.052884+0300  INFO  Ответ gpt получен
2024-09-19T16:18:57.052884+0300  INFO  Ответ gpt получен
2024-09-19T16:18:57.052884+0300  INFO  Ответ gpt получен
2024-09-19T16:18:57.052884+0300  INFO  Ответ gpt получен
2024-09-19T16:22:51.509628+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:22:51.509628+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:22:51.509628+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:22:53.333044+0300  ERROR  Ошибка при обновлении сообщения: Telegram server says - Bad Request: can't parse entities: Character '-' is reserved and must be escaped with the preceding '\'
2024-09-19T16:22:53.333044+0300  ERROR  Ошибка при обновлении сообщения: Telegram server says - Bad Request: can't parse entities: Character '-' is reserved and must be escaped with the preceding '\'
2024-09-19T16:22:53.333044+0300  ERROR  Ошибка при обновлении сообщения: Telegram server says - Bad Request: can't parse entities: Character '-' is reserved and must be escaped with the preceding '\'
2024-09-19T16:23:30.101523+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:23:30.101523+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:23:30.101523+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:23:38.541718+0300  INFO  Ответ gpt получен
2024-09-19T16:23:38.541718+0300  INFO  Ответ gpt получен
2024-09-19T16:23:38.541718+0300  INFO  Ответ gpt получен
2024-09-19T16:24:25.802504+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:24:25.802504+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:24:25.802504+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:24:38.702955+0300  ERROR  Ошибка при обновлении сообщения: Telegram server says - Bad Request: can't parse entities: Character '-' is reserved and must be escaped with the preceding '\'
2024-09-19T16:24:38.702955+0300  ERROR  Ошибка при обновлении сообщения: Telegram server says - Bad Request: can't parse entities: Character '-' is reserved and must be escaped with the preceding '\'
2024-09-19T16:24:38.702955+0300  ERROR  Ошибка при обновлении сообщения: Telegram server says - Bad Request: can't parse entities: Character '-' is reserved and must be escaped with the preceding '\'
2024-09-19T16:25:03.511550+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:25:03.511550+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:25:03.511550+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:25:16.071540+0300  ERROR  Ошибка при обновлении сообщения: Telegram server says - Bad Request: can't parse entities: Character '-' is reserved and must be escaped with the preceding '\'
2024-09-19T16:25:16.071540+0300  ERROR  Ошибка при обновлении сообщения: Telegram server says - Bad Request: can't parse entities: Character '-' is reserved and must be escaped with the preceding '\'
2024-09-19T16:25:16.071540+0300  ERROR  Ошибка при обновлении сообщения: Telegram server says - Bad Request: can't parse entities: Character '-' is reserved and must be escaped with the preceding '\'
2024-09-19T16:26:09.941778+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:26:09.941778+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:26:09.941778+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:26:11.816289+0300  INFO  Ответ gpt получен
2024-09-19T16:26:11.816289+0300  INFO  Ответ gpt получен
2024-09-19T16:26:11.816289+0300  INFO  Ответ gpt получен
2024-09-19T16:26:20.858322+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:26:20.858322+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:26:20.858322+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:26:20.858322+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:26:20.858322+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:26:27.270282+0300  INFO  Ответ gpt получен
2024-09-19T16:26:27.270282+0300  INFO  Ответ gpt получен
2024-09-19T16:26:27.270282+0300  INFO  Ответ gpt получен
2024-09-19T16:26:27.270282+0300  INFO  Ответ gpt получен
2024-09-19T16:26:27.270282+0300  INFO  Ответ gpt получен
2024-09-19T16:26:31.051823+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:26:31.051823+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:26:31.051823+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:26:31.051823+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:26:31.051823+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:26:31.051823+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:26:31.051823+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:26:37.636256+0300  INFO  Ответ gpt получен
2024-09-19T16:26:37.636256+0300  INFO  Ответ gpt получен
2024-09-19T16:26:37.636256+0300  INFO  Ответ gpt получен
2024-09-19T16:26:37.636256+0300  INFO  Ответ gpt получен
2024-09-19T16:26:37.636256+0300  INFO  Ответ gpt получен
2024-09-19T16:26:37.636256+0300  INFO  Ответ gpt получен
2024-09-19T16:26:37.636256+0300  INFO  Ответ gpt получен
2024-09-19T16:27:04.007444+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:27:04.007444+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:27:04.007444+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:27:07.434618+0300  INFO  Ответ gpt получен
2024-09-19T16:27:07.434618+0300  INFO  Ответ gpt получен
2024-09-19T16:27:07.434618+0300  INFO  Ответ gpt получен
2024-09-19T16:27:16.864798+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:27:16.864798+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:27:16.864798+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:27:16.864798+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:27:16.864798+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:27:24.537406+0300  INFO  Ответ gpt получен
2024-09-19T16:27:24.537406+0300  INFO  Ответ gpt получен
2024-09-19T16:27:24.537406+0300  INFO  Ответ gpt получен
2024-09-19T16:27:24.537406+0300  INFO  Ответ gpt получен
2024-09-19T16:27:24.537406+0300  INFO  Ответ gpt получен
2024-09-19T16:28:01.328262+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:28:01.328262+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:28:01.328262+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:28:18.849395+0300  INFO  Ответ gpt получен
2024-09-19T16:28:18.849395+0300  INFO  Ответ gpt получен
2024-09-19T16:28:18.849395+0300  INFO  Ответ gpt получен
2024-09-19T16:29:11.169332+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:29:11.169332+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:29:11.169332+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:29:12.374784+0300  ERROR  Ошибка при обновлении сообщения: 
2024-09-19T16:29:12.374784+0300  ERROR  Ошибка при обновлении сообщения: 
2024-09-19T16:29:12.374784+0300  ERROR  Ошибка при обновлении сообщения: 
2024-09-19T16:30:36.816059+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:30:36.816059+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:30:36.816059+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:30:51.160990+0300  INFO  Ответ gpt получен
2024-09-19T16:30:51.160990+0300  INFO  Ответ gpt получен
2024-09-19T16:30:51.160990+0300  INFO  Ответ gpt получен
2024-09-19T16:34:05.005733+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:34:05.005733+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:34:05.005733+0300  INFO  API_OPEN_AI обработан
2024-09-19T16:34:16.544800+0300  INFO  Ответ gpt получен
2024-09-19T16:34:16.544800+0300  INFO  Ответ gpt получен
2024-09-19T16:34:16.544800+0300  INFO  Ответ gpt получен
2024-09-20T23:00:02.622345+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:00:02.622345+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:00:02.622345+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:00:02.622345+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:00:03.529138+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:00:03.529138+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:00:03.529138+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:00:03.529138+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:00:03.529138+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:00:03.529138+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:00:06.515016+0300  INFO  Ответ gpt получен
2024-09-20T23:00:06.515016+0300  INFO  Ответ gpt получен
2024-09-20T23:00:06.515016+0300  INFO  Ответ gpt получен
2024-09-20T23:00:06.515016+0300  INFO  Ответ gpt получен
2024-09-20T23:00:06.515016+0300  INFO  Ответ gpt получен
2024-09-20T23:00:06.515016+0300  INFO  Ответ gpt получен
2024-09-20T23:00:14.260043+0300  INFO  Ответ gpt получен
2024-09-20T23:00:14.260043+0300  INFO  Ответ gpt получен
2024-09-20T23:00:14.260043+0300  INFO  Ответ gpt получен
2024-09-20T23:00:14.260043+0300  INFO  Ответ gpt получен
2024-09-20T23:00:14.260043+0300  INFO  Ответ gpt получен
2024-09-20T23:00:14.260043+0300  INFO  Ответ gpt получен
2024-09-20T23:12:18.071982+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:12:18.071982+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:12:18.071982+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:12:18.071982+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:12:21.132026+0300  ERROR  Ошибка при обновлении сообщения: 'str' object has no attribute 'edit_text'
2024-09-20T23:12:21.132026+0300  ERROR  Ошибка при обновлении сообщения: 'str' object has no attribute 'edit_text'
2024-09-20T23:12:21.132026+0300  ERROR  Ошибка при обновлении сообщения: 'str' object has no attribute 'edit_text'
2024-09-20T23:12:21.132026+0300  ERROR  Ошибка при обновлении сообщения: 'str' object has no attribute 'edit_text'
2024-09-20T23:51:39.740227+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:51:39.740227+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:51:39.740227+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:51:39.740227+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:51:39.740227+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:51:40.801060+0300  INFO  Ответ gpt получен
2024-09-20T23:51:40.801060+0300  INFO  Ответ gpt получен
2024-09-20T23:51:40.801060+0300  INFO  Ответ gpt получен
2024-09-20T23:51:40.801060+0300  INFO  Ответ gpt получен
2024-09-20T23:51:40.801060+0300  INFO  Ответ gpt получен
2024-09-20T23:53:05.471902+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:53:05.471902+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:53:05.471902+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:53:05.471902+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:53:05.471902+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:53:12.563177+0300  INFO  Ответ gpt получен
2024-09-20T23:53:12.563177+0300  INFO  Ответ gpt получен
2024-09-20T23:53:12.563177+0300  INFO  Ответ gpt получен
2024-09-20T23:53:12.563177+0300  INFO  Ответ gpt получен
2024-09-20T23:53:12.563177+0300  INFO  Ответ gpt получен
2024-09-20T23:55:23.340334+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:55:23.340334+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:55:23.340334+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:55:23.340334+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:55:23.340334+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:55:25.554556+0300  INFO  Ответ gpt получен
2024-09-20T23:55:25.554556+0300  INFO  Ответ gpt получен
2024-09-20T23:55:25.554556+0300  INFO  Ответ gpt получен
2024-09-20T23:55:25.554556+0300  INFO  Ответ gpt получен
2024-09-20T23:55:25.554556+0300  INFO  Ответ gpt получен
2024-09-20T23:55:43.087769+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:55:43.087769+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:55:43.087769+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:55:43.087769+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:55:43.087769+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:55:43.087769+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:55:43.087769+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:55:43.776705+0300  INFO  Ответ gpt получен
2024-09-20T23:55:43.776705+0300  INFO  Ответ gpt получен
2024-09-20T23:55:43.776705+0300  INFO  Ответ gpt получен
2024-09-20T23:55:43.776705+0300  INFO  Ответ gpt получен
2024-09-20T23:55:43.776705+0300  INFO  Ответ gpt получен
2024-09-20T23:55:43.776705+0300  INFO  Ответ gpt получен
2024-09-20T23:55:43.776705+0300  INFO  Ответ gpt получен
2024-09-20T23:57:06.466957+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:57:06.466957+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:57:06.466957+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:57:06.466957+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:57:06.466957+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:57:08.496683+0300  INFO  Ответ gpt получен
2024-09-20T23:57:08.496683+0300  INFO  Ответ gpt получен
2024-09-20T23:57:08.496683+0300  INFO  Ответ gpt получен
2024-09-20T23:57:08.496683+0300  INFO  Ответ gpt получен
2024-09-20T23:57:08.496683+0300  INFO  Ответ gpt получен
2024-09-20T23:57:21.367977+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:57:21.367977+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:57:21.367977+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:57:21.367977+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:57:21.367977+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:57:21.367977+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:57:21.367977+0300  INFO  API_OPEN_AI обработан
2024-09-20T23:57:22.121166+0300  INFO  Ответ gpt получен
2024-09-20T23:57:22.121166+0300  INFO  Ответ gpt получен
2024-09-20T23:57:22.121166+0300  INFO  Ответ gpt получен
2024-09-20T23:57:22.121166+0300  INFO  Ответ gpt получен
2024-09-20T23:57:22.121166+0300  INFO  Ответ gpt получен
2024-09-20T23:57:22.121166+0300  INFO  Ответ gpt получен
2024-09-20T23:57:22.121166+0300  INFO  Ответ gpt получен
2024-09-21T00:09:54.524188+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:09:54.524188+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:09:54.524188+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:09:54.524188+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:09:54.524188+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:09:55.519371+0300  INFO  Ответ gpt получен
2024-09-21T00:09:55.519371+0300  INFO  Ответ gpt получен
2024-09-21T00:09:55.519371+0300  INFO  Ответ gpt получен
2024-09-21T00:09:55.519371+0300  INFO  Ответ gpt получен
2024-09-21T00:09:55.519371+0300  INFO  Ответ gpt получен
2024-09-21T00:45:12.280880+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (60110), thread 'MainThread' (140018621077312):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f588dfa0c20>
    │       └ <function run at 0x7f589134e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f588d45fb40>
           │      └ <function Runner.run at 0x7f58913efba0>
           └ <asyncio.runners.Runner object at 0x7f5891dff5f0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f58913ed800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f5891dff5f0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f58913ed760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f58913ef560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f5891339940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,)}
                     │    │           │    └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f588d4c9fa0>
                     │    └ <function Dispatcher.feed_update at 0x7f588df0ba60>
                     └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588d4cb0e0>
                     └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f588d4cb200>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f588d4cb2c0>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7f588d4c3f60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7f588d4e7060>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f588d5a6d80'>>, Update(update_id=414369616, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f588df0b060>
                 └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f588d4e6f20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588d4c9c70>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f588df0b100>
                 └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f588df0b060>
                     └ <Router '0x7f588da5d700'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f588d4e6fc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588deebdd0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f588df0b100>
                 └ <Router '0x7f588da5d700'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7f588df0a700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588deebdd0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7f588d4e40e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f588d4c2340>, Message(message_id=345, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4o-mini'
                     │   └ 'Напиши телеграмм бота на C++'
                     └ <function gpt at 0x7f588dcd0fe0>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:45:12.280880+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (60110), thread 'MainThread' (140018621077312):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f588dfa0c20>
    │       └ <function run at 0x7f589134e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f588d45fb40>
           │      └ <function Runner.run at 0x7f58913efba0>
           └ <asyncio.runners.Runner object at 0x7f5891dff5f0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f58913ed800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f5891dff5f0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f58913ed760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f58913ef560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f5891339940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,)}
                     │    │           │    └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f588d4c9fa0>
                     │    └ <function Dispatcher.feed_update at 0x7f588df0ba60>
                     └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588d4cb0e0>
                     └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f588d4cb200>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f588d4cb2c0>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7f588d4c3f60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7f588d4e7060>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f588d5a6d80'>>, Update(update_id=414369616, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f588df0b060>
                 └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f588d4e6f20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588d4c9c70>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f588df0b100>
                 └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f588df0b060>
                     └ <Router '0x7f588da5d700'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f588d4e6fc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588deebdd0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f588df0b100>
                 └ <Router '0x7f588da5d700'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7f588df0a700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588deebdd0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7f588d4e40e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f588d4c2340>, Message(message_id=345, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4o-mini'
                     │   └ 'Напиши телеграмм бота на C++'
                     └ <function gpt at 0x7f588dcd0fe0>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:45:12.280880+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (60110), thread 'MainThread' (140018621077312):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f588dfa0c20>
    │       └ <function run at 0x7f589134e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f588d45fb40>
           │      └ <function Runner.run at 0x7f58913efba0>
           └ <asyncio.runners.Runner object at 0x7f5891dff5f0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f58913ed800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f5891dff5f0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f58913ed760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f58913ef560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f5891339940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,)}
                     │    │           │    └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f588d4c9fa0>
                     │    └ <function Dispatcher.feed_update at 0x7f588df0ba60>
                     └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588d4cb0e0>
                     └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f588d4cb200>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f588d4cb2c0>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7f588d4c3f60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7f588d4e7060>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f588d5a6d80'>>, Update(update_id=414369616, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f588df0b060>
                 └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f588d4e6f20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588d4c9c70>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f588df0b100>
                 └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f588df0b060>
                     └ <Router '0x7f588da5d700'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f588d4e6fc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588deebdd0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f588df0b100>
                 └ <Router '0x7f588da5d700'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7f588df0a700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588deebdd0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7f588d4e40e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f588d4c2340>, Message(message_id=345, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4o-mini'
                     │   └ 'Напиши телеграмм бота на C++'
                     └ <function gpt at 0x7f588dcd0fe0>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:45:12.280880+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (60110), thread 'MainThread' (140018621077312):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f588dfa0c20>
    │       └ <function run at 0x7f589134e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f588d45fb40>
           │      └ <function Runner.run at 0x7f58913efba0>
           └ <asyncio.runners.Runner object at 0x7f5891dff5f0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f58913ed800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f5891dff5f0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f58913ed760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f58913ef560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f5891339940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,)}
                     │    │           │    └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f588d4c9fa0>
                     │    └ <function Dispatcher.feed_update at 0x7f588df0ba60>
                     └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588d4cb0e0>
                     └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f588d4cb200>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f588d4cb2c0>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7f588d4c3f60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7f588d4e7060>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f588d5a6d80'>>, Update(update_id=414369616, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f588df0b060>
                 └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f588d4e6f20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588d4c9c70>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f588df0b100>
                 └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f588df0b060>
                     └ <Router '0x7f588da5d700'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f588d4e6fc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588deebdd0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f588df0b100>
                 └ <Router '0x7f588da5d700'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7f588df0a700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588deebdd0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7f588d4e40e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f588d4c2340>, Message(message_id=345, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4o-mini'
                     │   └ 'Напиши телеграмм бота на C++'
                     └ <function gpt at 0x7f588dcd0fe0>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:45:12.280880+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (60110), thread 'MainThread' (140018621077312):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f588dfa0c20>
    │       └ <function run at 0x7f589134e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f588d45fb40>
           │      └ <function Runner.run at 0x7f58913efba0>
           └ <asyncio.runners.Runner object at 0x7f5891dff5f0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f58913ed800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f5891dff5f0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f58913ed760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f58913ef560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f5891339940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,)}
                     │    │           │    └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f588d4c9fa0>
                     │    └ <function Dispatcher.feed_update at 0x7f588df0ba60>
                     └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588d4cb0e0>
                     └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f588d4cb200>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f588d4cb2c0>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7f588d4c3f60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7f588d4e7060>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f588d5a6d80'>>, Update(update_id=414369616, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f588df0b060>
                 └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f588d4e6f20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588d4c9c70>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f588df0b100>
                 └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f588df0b060>
                     └ <Router '0x7f588da5d700'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f588d4e6fc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588deebdd0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f588df0b100>
                 └ <Router '0x7f588da5d700'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7f588df0a700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588deebdd0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7f588d4e40e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f588d4c2340>, Message(message_id=345, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4o-mini'
                     │   └ 'Напиши телеграмм бота на C++'
                     └ <function gpt at 0x7f588dcd0fe0>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:45:12.280880+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (60110), thread 'MainThread' (140018621077312):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f588dfa0c20>
    │       └ <function run at 0x7f589134e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f588d45fb40>
           │      └ <function Runner.run at 0x7f58913efba0>
           └ <asyncio.runners.Runner object at 0x7f5891dff5f0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f58913ed800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f5891dff5f0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f58913ed760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f58913ef560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f5891339940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,)}
                     │    │           │    └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f588d4c9fa0>
                     │    └ <function Dispatcher.feed_update at 0x7f588df0ba60>
                     └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588d4cb0e0>
                     └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f588d4cb200>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f588d4cb2c0>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7f588d4c3f60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369616, message=Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7f588d4e7060>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f588d5a6d80'>>, Update(update_id=414369616, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f588df0b060>
                 └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f588d4e6f20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588d4c9c70>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f588df0b100>
                 └ <Dispatcher '0x7f588d5a6d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f588df0b060>
                     └ <Router '0x7f588da5d700'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f588d4e6fc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f588df0a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588deebdd0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f588df0b100>
                 └ <Router '0x7f588da5d700'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7f588df0a700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f588deebdd0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f588d5a6d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f588d4c9fa0>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=345, date=datetime.datetime(2024, 9, 20, 21, 45, 12, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7f588d4e40e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f588d4c2340>, Message(message_id=345, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4o-mini'
                     │   └ 'Напиши телеграмм бота на C++'
                     └ <function gpt at 0x7f588dcd0fe0>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:45:12.301286+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:45:12.301286+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:45:12.301286+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:45:12.301286+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:45:12.301286+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:45:12.301286+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:46:49.032729+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (60810), thread 'MainThread' (140574034331456):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fd9def48c20>
    │       └ <function run at 0x7fd9e2b863e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fd9de707b40>
           │      └ <function Runner.run at 0x7fd9e2c27ba0>
           └ <asyncio.runners.Runner object at 0x7fd9def565a0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fd9e2c25800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fd9def565a0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fd9e2c25760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fd9e2c27560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fd9e2b71940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,)}
                     │    │           │    └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fd9de771e20>
                     │    └ <function Dispatcher.feed_update at 0x7fd9df19ba60>
                     └ <Dispatcher '0x7fd9de9ced80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fd9df19a5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fd9de773200>
                     └ <Dispatcher '0x7fd9de9ced80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fd9de773320>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fd9de7733e0>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7fd9de76bf60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7fd9de78ede0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fd9de9ced80'>>, Update(update_id=414369619, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fd9df19b060>
                 └ <Dispatcher '0x7fd9de9ced80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fd9de78ef20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fd9df19a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fd9de772270>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fd9df19b100>
                 └ <Dispatcher '0x7fd9de9ced80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fd9df19b060>
                     └ <Router '0x7fd9df1f3da0'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fd9de78efc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fd9df19a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fd9def56600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fd9df19b100>
                 └ <Router '0x7fd9df1f3da0'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7fd9df19a700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fd9def56600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7fd9de78fd80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fd9de76a340>, Message(message_id=352, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7fd9def61080>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:46:49.032729+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (60810), thread 'MainThread' (140574034331456):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fd9def48c20>
    │       └ <function run at 0x7fd9e2b863e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fd9de707b40>
           │      └ <function Runner.run at 0x7fd9e2c27ba0>
           └ <asyncio.runners.Runner object at 0x7fd9def565a0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fd9e2c25800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fd9def565a0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fd9e2c25760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fd9e2c27560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fd9e2b71940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,)}
                     │    │           │    └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fd9de771e20>
                     │    └ <function Dispatcher.feed_update at 0x7fd9df19ba60>
                     └ <Dispatcher '0x7fd9de9ced80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fd9df19a5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fd9de773200>
                     └ <Dispatcher '0x7fd9de9ced80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fd9de773320>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fd9de7733e0>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7fd9de76bf60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7fd9de78ede0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fd9de9ced80'>>, Update(update_id=414369619, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fd9df19b060>
                 └ <Dispatcher '0x7fd9de9ced80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fd9de78ef20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fd9df19a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fd9de772270>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fd9df19b100>
                 └ <Dispatcher '0x7fd9de9ced80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fd9df19b060>
                     └ <Router '0x7fd9df1f3da0'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fd9de78efc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fd9df19a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fd9def56600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fd9df19b100>
                 └ <Router '0x7fd9df1f3da0'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7fd9df19a700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fd9def56600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7fd9de78fd80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fd9de76a340>, Message(message_id=352, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7fd9def61080>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:46:49.032729+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (60810), thread 'MainThread' (140574034331456):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fd9def48c20>
    │       └ <function run at 0x7fd9e2b863e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fd9de707b40>
           │      └ <function Runner.run at 0x7fd9e2c27ba0>
           └ <asyncio.runners.Runner object at 0x7fd9def565a0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fd9e2c25800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fd9def565a0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fd9e2c25760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fd9e2c27560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fd9e2b71940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,)}
                     │    │           │    └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fd9de771e20>
                     │    └ <function Dispatcher.feed_update at 0x7fd9df19ba60>
                     └ <Dispatcher '0x7fd9de9ced80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fd9df19a5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fd9de773200>
                     └ <Dispatcher '0x7fd9de9ced80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fd9de773320>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fd9de7733e0>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7fd9de76bf60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7fd9de78ede0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fd9de9ced80'>>, Update(update_id=414369619, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fd9df19b060>
                 └ <Dispatcher '0x7fd9de9ced80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fd9de78ef20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fd9df19a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fd9de772270>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fd9df19b100>
                 └ <Dispatcher '0x7fd9de9ced80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fd9df19b060>
                     └ <Router '0x7fd9df1f3da0'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fd9de78efc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fd9df19a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fd9def56600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fd9df19b100>
                 └ <Router '0x7fd9df1f3da0'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7fd9df19a700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fd9def56600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7fd9de78fd80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fd9de76a340>, Message(message_id=352, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7fd9def61080>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:46:49.032729+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (60810), thread 'MainThread' (140574034331456):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fd9def48c20>
    │       └ <function run at 0x7fd9e2b863e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fd9de707b40>
           │      └ <function Runner.run at 0x7fd9e2c27ba0>
           └ <asyncio.runners.Runner object at 0x7fd9def565a0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fd9e2c25800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fd9def565a0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fd9e2c25760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fd9e2c27560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fd9e2b71940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,)}
                     │    │           │    └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fd9de771e20>
                     │    └ <function Dispatcher.feed_update at 0x7fd9df19ba60>
                     └ <Dispatcher '0x7fd9de9ced80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fd9df19a5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fd9de773200>
                     └ <Dispatcher '0x7fd9de9ced80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fd9de773320>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fd9de7733e0>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7fd9de76bf60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369619, message=Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7fd9de78ede0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fd9de9ced80'>>, Update(update_id=414369619, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fd9df19b060>
                 └ <Dispatcher '0x7fd9de9ced80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fd9de78ef20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fd9df19a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fd9de772270>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fd9df19b100>
                 └ <Dispatcher '0x7fd9de9ced80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fd9df19b060>
                     └ <Router '0x7fd9df1f3da0'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fd9de78efc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fd9df19a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fd9def56600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fd9df19b100>
                 └ <Router '0x7fd9df1f3da0'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7fd9df19a700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fd9def56600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fd9de9ced80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fd9de771e20>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=352, date=datetime.datetime(2024, 9, 20, 21, 46, 48, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7fd9de78fd80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fd9de76a340>, Message(message_id=352, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7fd9def61080>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:46:49.050529+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:46:49.050529+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:46:49.050529+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:46:49.050529+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:53:52.764634+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (63776), thread 'MainThread' (140485249771328):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fc533200c20>
    │       └ <function run at 0x7fc53674e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fc5329bfb40>
           │      └ <function Runner.run at 0x7fc5367efba0>
           └ <asyncio.runners.Runner object at 0x7fc5329f3c20>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fc5367ed800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fc5329f3c20>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fc5367ed760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fc5367ef560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fc536739940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,)}
                     │    │           │    └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fc532759e50>
                     │    └ <function Dispatcher.feed_update at 0x7fc533473a60>
                     └ <Dispatcher '0x7fc532e40b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fc5334725c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fc53275b170>
                     └ <Dispatcher '0x7fc532e40b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fc53275b290>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fc53275b350>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7fc532753f60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7fc532776e80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fc532e40b00'>>, Update(update_id=414369635, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fc533473060>
                 └ <Dispatcher '0x7fc532e40b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fc532776f20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fc5334725c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fc532759ca0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fc533473100>
                 └ <Dispatcher '0x7fc532e40b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fc533473060>
                     └ <Router '0x7fc5334076e0'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fc532776fc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fc5334725c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fc53293f5f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fc533473100>
                 └ <Router '0x7fc5334076e0'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7fc533472700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fc53293f5f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7fc532777060>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fc532752340>, Message(message_id=385, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7fc533218fe0>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:53:52.764634+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (63776), thread 'MainThread' (140485249771328):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fc533200c20>
    │       └ <function run at 0x7fc53674e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fc5329bfb40>
           │      └ <function Runner.run at 0x7fc5367efba0>
           └ <asyncio.runners.Runner object at 0x7fc5329f3c20>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fc5367ed800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fc5329f3c20>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fc5367ed760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fc5367ef560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fc536739940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,)}
                     │    │           │    └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fc532759e50>
                     │    └ <function Dispatcher.feed_update at 0x7fc533473a60>
                     └ <Dispatcher '0x7fc532e40b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fc5334725c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fc53275b170>
                     └ <Dispatcher '0x7fc532e40b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fc53275b290>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fc53275b350>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7fc532753f60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7fc532776e80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fc532e40b00'>>, Update(update_id=414369635, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fc533473060>
                 └ <Dispatcher '0x7fc532e40b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fc532776f20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fc5334725c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fc532759ca0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fc533473100>
                 └ <Dispatcher '0x7fc532e40b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fc533473060>
                     └ <Router '0x7fc5334076e0'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fc532776fc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fc5334725c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fc53293f5f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fc533473100>
                 └ <Router '0x7fc5334076e0'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7fc533472700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fc53293f5f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7fc532777060>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fc532752340>, Message(message_id=385, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7fc533218fe0>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:53:52.764634+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (63776), thread 'MainThread' (140485249771328):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fc533200c20>
    │       └ <function run at 0x7fc53674e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fc5329bfb40>
           │      └ <function Runner.run at 0x7fc5367efba0>
           └ <asyncio.runners.Runner object at 0x7fc5329f3c20>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fc5367ed800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fc5329f3c20>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fc5367ed760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fc5367ef560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fc536739940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,)}
                     │    │           │    └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fc532759e50>
                     │    └ <function Dispatcher.feed_update at 0x7fc533473a60>
                     └ <Dispatcher '0x7fc532e40b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fc5334725c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fc53275b170>
                     └ <Dispatcher '0x7fc532e40b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fc53275b290>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fc53275b350>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7fc532753f60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7fc532776e80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fc532e40b00'>>, Update(update_id=414369635, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fc533473060>
                 └ <Dispatcher '0x7fc532e40b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fc532776f20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fc5334725c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fc532759ca0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fc533473100>
                 └ <Dispatcher '0x7fc532e40b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fc533473060>
                     └ <Router '0x7fc5334076e0'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fc532776fc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fc5334725c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fc53293f5f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fc533473100>
                 └ <Router '0x7fc5334076e0'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7fc533472700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fc53293f5f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7fc532777060>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fc532752340>, Message(message_id=385, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7fc533218fe0>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:53:52.764634+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (63776), thread 'MainThread' (140485249771328):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fc533200c20>
    │       └ <function run at 0x7fc53674e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fc5329bfb40>
           │      └ <function Runner.run at 0x7fc5367efba0>
           └ <asyncio.runners.Runner object at 0x7fc5329f3c20>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fc5367ed800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fc5329f3c20>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fc5367ed760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fc5367ef560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fc536739940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,)}
                     │    │           │    └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fc532759e50>
                     │    └ <function Dispatcher.feed_update at 0x7fc533473a60>
                     └ <Dispatcher '0x7fc532e40b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fc5334725c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fc53275b170>
                     └ <Dispatcher '0x7fc532e40b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fc53275b290>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fc53275b350>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7fc532753f60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369635, message=Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7fc532776e80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fc532e40b00'>>, Update(update_id=414369635, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fc533473060>
                 └ <Dispatcher '0x7fc532e40b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fc532776f20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fc5334725c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fc532759ca0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fc533473100>
                 └ <Dispatcher '0x7fc532e40b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fc533473060>
                     └ <Router '0x7fc5334076e0'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fc532776fc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fc5334725c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fc53293f5f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fc533473100>
                 └ <Router '0x7fc5334076e0'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7fc533472700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fc53293f5f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fc532e40b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fc532759e50>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=385, date=datetime.datetime(2024, 9, 20, 21, 53, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7fc532777060>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fc532752340>, Message(message_id=385, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7fc533218fe0>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:53:52.781543+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:53:52.781543+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:53:52.781543+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:53:52.781543+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:54:27.470512+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (63993), thread 'MainThread' (140459970848576):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fbf506b0c20>
    │       └ <function run at 0x7fbf53b4e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fbf4fb87b40>
           │      └ <function Runner.run at 0x7fbf53befba0>
           └ <asyncio.runners.Runner object at 0x7fbf545ff3e0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fbf53bed800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fbf545ff3e0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fbf53bed760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fbf53bef560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fbf53b39940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,)}
                     │    │           │    └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fbf4fbedd90>
                     │    └ <function Dispatcher.feed_update at 0x7fbf5061ba60>
                     └ <Dispatcher '0x7fbf50056d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fbf5061a5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fbf4fbef2f0>
                     └ <Dispatcher '0x7fbf50056d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fbf4fbef410>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fbf4fbef4d0>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7fbf4fbebf60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7fbf4fc0ede0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fbf50056d80'>>, Update(update_id=414369638, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fbf5061b060>
                 └ <Dispatcher '0x7fbf50056d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fbf4fc0ef20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fbf5061a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fbf4fbee1e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fbf5061b100>
                 └ <Dispatcher '0x7fbf50056d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fbf5061b060>
                     └ <Router '0x7fbf4fd97710'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fbf4fc0efc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fbf5061a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fbf4fd96ed0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fbf5061b100>
                 └ <Router '0x7fbf4fd97710'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7fbf5061a700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fbf4fd96ed0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7fbf4fc0fd80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fbf4fbea340>, Message(message_id=392, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7fbf503e0f40>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:54:27.470512+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (63993), thread 'MainThread' (140459970848576):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fbf506b0c20>
    │       └ <function run at 0x7fbf53b4e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fbf4fb87b40>
           │      └ <function Runner.run at 0x7fbf53befba0>
           └ <asyncio.runners.Runner object at 0x7fbf545ff3e0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fbf53bed800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fbf545ff3e0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fbf53bed760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fbf53bef560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fbf53b39940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,)}
                     │    │           │    └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fbf4fbedd90>
                     │    └ <function Dispatcher.feed_update at 0x7fbf5061ba60>
                     └ <Dispatcher '0x7fbf50056d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fbf5061a5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fbf4fbef2f0>
                     └ <Dispatcher '0x7fbf50056d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fbf4fbef410>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fbf4fbef4d0>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7fbf4fbebf60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7fbf4fc0ede0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fbf50056d80'>>, Update(update_id=414369638, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fbf5061b060>
                 └ <Dispatcher '0x7fbf50056d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fbf4fc0ef20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fbf5061a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fbf4fbee1e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fbf5061b100>
                 └ <Dispatcher '0x7fbf50056d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fbf5061b060>
                     └ <Router '0x7fbf4fd97710'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fbf4fc0efc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fbf5061a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fbf4fd96ed0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fbf5061b100>
                 └ <Router '0x7fbf4fd97710'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7fbf5061a700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fbf4fd96ed0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7fbf4fc0fd80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fbf4fbea340>, Message(message_id=392, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7fbf503e0f40>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:54:27.470512+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (63993), thread 'MainThread' (140459970848576):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fbf506b0c20>
    │       └ <function run at 0x7fbf53b4e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fbf4fb87b40>
           │      └ <function Runner.run at 0x7fbf53befba0>
           └ <asyncio.runners.Runner object at 0x7fbf545ff3e0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fbf53bed800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fbf545ff3e0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fbf53bed760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fbf53bef560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fbf53b39940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,)}
                     │    │           │    └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fbf4fbedd90>
                     │    └ <function Dispatcher.feed_update at 0x7fbf5061ba60>
                     └ <Dispatcher '0x7fbf50056d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fbf5061a5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fbf4fbef2f0>
                     └ <Dispatcher '0x7fbf50056d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fbf4fbef410>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fbf4fbef4d0>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7fbf4fbebf60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7fbf4fc0ede0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fbf50056d80'>>, Update(update_id=414369638, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fbf5061b060>
                 └ <Dispatcher '0x7fbf50056d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fbf4fc0ef20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fbf5061a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fbf4fbee1e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fbf5061b100>
                 └ <Dispatcher '0x7fbf50056d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fbf5061b060>
                     └ <Router '0x7fbf4fd97710'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fbf4fc0efc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fbf5061a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fbf4fd96ed0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fbf5061b100>
                 └ <Router '0x7fbf4fd97710'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7fbf5061a700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fbf4fd96ed0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7fbf4fc0fd80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fbf4fbea340>, Message(message_id=392, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7fbf503e0f40>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:54:27.470512+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (63993), thread 'MainThread' (140459970848576):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fbf506b0c20>
    │       └ <function run at 0x7fbf53b4e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fbf4fb87b40>
           │      └ <function Runner.run at 0x7fbf53befba0>
           └ <asyncio.runners.Runner object at 0x7fbf545ff3e0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fbf53bed800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fbf545ff3e0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fbf53bed760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fbf53bef560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fbf53b39940>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,)}
                     │    │           │    └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fbf4fbedd90>
                     │    └ <function Dispatcher.feed_update at 0x7fbf5061ba60>
                     └ <Dispatcher '0x7fbf50056d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fbf5061a5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fbf4fbef2f0>
                     └ <Dispatcher '0x7fbf50056d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fbf4fbef410>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fbf4fbef4d0>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x7fbf4fbebf60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369638, message=Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x7fbf4fc0ede0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fbf50056d80'>>, Update(update_id=414369638, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fbf5061b060>
                 └ <Dispatcher '0x7fbf50056d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fbf4fc0ef20>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fbf5061a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fbf4fbee1e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fbf5061b100>
                 └ <Dispatcher '0x7fbf50056d80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fbf5061b060>
                     └ <Router '0x7fbf4fd97710'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fbf4fc0efc0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fbf5061a5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fbf4fd96ed0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fbf5061b100>
                 └ <Router '0x7fbf4fd97710'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x7fbf5061a700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fbf4fd96ed0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fbf50056d80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fbf4fbedd90>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=392, date=datetime.datetime(2024, 9, 20, 21, 54, 27, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x7fbf4fc0fd80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fbf4fbea340>, Message(message_id=392, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model=model)
                     │   │                 └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7fbf503e0f40>

TypeError: gpt() got an unexpected keyword argument 'model'
2024-09-21T00:54:27.487384+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:54:27.487384+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:54:27.487384+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:54:27.487384+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:57:50.099109+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:57:50.099109+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:57:50.099109+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:57:50.099109+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:57:50.099109+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:57:50.099109+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:57:51.578786+0300  INFO  Ответ gpt получен
2024-09-21T00:57:51.578786+0300  INFO  Ответ gpt получен
2024-09-21T00:57:51.578786+0300  INFO  Ответ gpt получен
2024-09-21T00:57:51.578786+0300  INFO  Ответ gpt получен
2024-09-21T00:57:51.578786+0300  INFO  Ответ gpt получен
2024-09-21T00:57:51.578786+0300  INFO  Ответ gpt получен
2024-09-21T00:58:00.121966+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:58:00.121966+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:58:00.121966+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:58:00.121966+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:58:00.121966+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:58:00.121966+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:58:00.121966+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:58:00.121966+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:58:00.121966+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:58:00.121966+0300  INFO  API_OPEN_AI обработан
2024-09-21T00:58:00.499488+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T00:58:00.499488+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T00:58:00.499488+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T00:58:00.499488+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T00:58:00.499488+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T00:58:00.499488+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T00:58:00.499488+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T00:58:00.499488+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T00:58:00.499488+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T00:58:00.499488+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T00:58:00.499767+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (65221), thread 'MainThread' (139806701483840):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f2736151940>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f272fdd4b90>
                     └ <openai.AsyncOpenAI object at 0x7f272f656600>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f272f656600>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f2736327ec0>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f2736327f60>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f2736324fe0>
          └ <openai.AsyncOpenAI object at 0x7f272f656600>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f2736804d60>
    │       └ <function run at 0x7f2739d4e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f2735fabb40>
           │      └ <function Runner.run at 0x7f2739defba0>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f2739ded800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f2739ded760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f2739def560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f2739d39940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,)}
                     │    │           │    └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f2735d45eb0>
                     │    └ <function Dispatcher.feed_update at 0x7f2736a5fa60>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2735d471a0>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f2735d472c0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f2735d47380>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function TelegramEventObserver.trigger at 0x7f2735d3eac0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function CallableObject.call at 0x7f2735d62f20>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f2736778b00'>>, Update(update_id=414369646, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f2736a5f060>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d600e0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2736336d80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f2736a5f060>
                     └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d62de0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │        └ <function TelegramEventObserver.trigger at 0x7f2736a5e700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 └ <function CallableObject.call at 0x7f2735d62d40>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f2735d3e340>, Message(message_id=410, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f2736804fe0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T00:58:00.499767+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (65221), thread 'MainThread' (139806701483840):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f2736151940>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f272fdd4b90>
                     └ <openai.AsyncOpenAI object at 0x7f272f656600>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f272f656600>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f2736327ec0>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f2736327f60>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f2736324fe0>
          └ <openai.AsyncOpenAI object at 0x7f272f656600>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f2736804d60>
    │       └ <function run at 0x7f2739d4e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f2735fabb40>
           │      └ <function Runner.run at 0x7f2739defba0>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f2739ded800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f2739ded760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f2739def560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f2739d39940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,)}
                     │    │           │    └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f2735d45eb0>
                     │    └ <function Dispatcher.feed_update at 0x7f2736a5fa60>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2735d471a0>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f2735d472c0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f2735d47380>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function TelegramEventObserver.trigger at 0x7f2735d3eac0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function CallableObject.call at 0x7f2735d62f20>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f2736778b00'>>, Update(update_id=414369646, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f2736a5f060>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d600e0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2736336d80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f2736a5f060>
                     └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d62de0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │        └ <function TelegramEventObserver.trigger at 0x7f2736a5e700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 └ <function CallableObject.call at 0x7f2735d62d40>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f2735d3e340>, Message(message_id=410, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f2736804fe0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T00:58:00.499767+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (65221), thread 'MainThread' (139806701483840):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f2736151940>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f272fdd4b90>
                     └ <openai.AsyncOpenAI object at 0x7f272f656600>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f272f656600>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f2736327ec0>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f2736327f60>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f2736324fe0>
          └ <openai.AsyncOpenAI object at 0x7f272f656600>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f2736804d60>
    │       └ <function run at 0x7f2739d4e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f2735fabb40>
           │      └ <function Runner.run at 0x7f2739defba0>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f2739ded800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f2739ded760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f2739def560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f2739d39940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,)}
                     │    │           │    └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f2735d45eb0>
                     │    └ <function Dispatcher.feed_update at 0x7f2736a5fa60>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2735d471a0>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f2735d472c0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f2735d47380>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function TelegramEventObserver.trigger at 0x7f2735d3eac0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function CallableObject.call at 0x7f2735d62f20>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f2736778b00'>>, Update(update_id=414369646, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f2736a5f060>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d600e0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2736336d80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f2736a5f060>
                     └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d62de0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │        └ <function TelegramEventObserver.trigger at 0x7f2736a5e700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 └ <function CallableObject.call at 0x7f2735d62d40>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f2735d3e340>, Message(message_id=410, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f2736804fe0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T00:58:00.499767+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (65221), thread 'MainThread' (139806701483840):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f2736151940>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f272fdd4b90>
                     └ <openai.AsyncOpenAI object at 0x7f272f656600>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f272f656600>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f2736327ec0>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f2736327f60>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f2736324fe0>
          └ <openai.AsyncOpenAI object at 0x7f272f656600>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f2736804d60>
    │       └ <function run at 0x7f2739d4e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f2735fabb40>
           │      └ <function Runner.run at 0x7f2739defba0>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f2739ded800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f2739ded760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f2739def560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f2739d39940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,)}
                     │    │           │    └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f2735d45eb0>
                     │    └ <function Dispatcher.feed_update at 0x7f2736a5fa60>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2735d471a0>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f2735d472c0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f2735d47380>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function TelegramEventObserver.trigger at 0x7f2735d3eac0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function CallableObject.call at 0x7f2735d62f20>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f2736778b00'>>, Update(update_id=414369646, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f2736a5f060>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d600e0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2736336d80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f2736a5f060>
                     └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d62de0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │        └ <function TelegramEventObserver.trigger at 0x7f2736a5e700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 └ <function CallableObject.call at 0x7f2735d62d40>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f2735d3e340>, Message(message_id=410, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f2736804fe0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T00:58:00.499767+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (65221), thread 'MainThread' (139806701483840):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f2736151940>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f272fdd4b90>
                     └ <openai.AsyncOpenAI object at 0x7f272f656600>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f272f656600>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f2736327ec0>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f2736327f60>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f2736324fe0>
          └ <openai.AsyncOpenAI object at 0x7f272f656600>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f2736804d60>
    │       └ <function run at 0x7f2739d4e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f2735fabb40>
           │      └ <function Runner.run at 0x7f2739defba0>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f2739ded800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f2739ded760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f2739def560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f2739d39940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,)}
                     │    │           │    └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f2735d45eb0>
                     │    └ <function Dispatcher.feed_update at 0x7f2736a5fa60>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2735d471a0>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f2735d472c0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f2735d47380>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function TelegramEventObserver.trigger at 0x7f2735d3eac0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function CallableObject.call at 0x7f2735d62f20>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f2736778b00'>>, Update(update_id=414369646, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f2736a5f060>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d600e0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2736336d80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f2736a5f060>
                     └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d62de0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │        └ <function TelegramEventObserver.trigger at 0x7f2736a5e700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 └ <function CallableObject.call at 0x7f2735d62d40>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f2735d3e340>, Message(message_id=410, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f2736804fe0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T00:58:00.499767+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (65221), thread 'MainThread' (139806701483840):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f2736151940>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f272fdd4b90>
                     └ <openai.AsyncOpenAI object at 0x7f272f656600>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f272f656600>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f2736327ec0>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f2736327f60>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f2736324fe0>
          └ <openai.AsyncOpenAI object at 0x7f272f656600>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f2736804d60>
    │       └ <function run at 0x7f2739d4e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f2735fabb40>
           │      └ <function Runner.run at 0x7f2739defba0>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f2739ded800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f2739ded760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f2739def560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f2739d39940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,)}
                     │    │           │    └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f2735d45eb0>
                     │    └ <function Dispatcher.feed_update at 0x7f2736a5fa60>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2735d471a0>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f2735d472c0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f2735d47380>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function TelegramEventObserver.trigger at 0x7f2735d3eac0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function CallableObject.call at 0x7f2735d62f20>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f2736778b00'>>, Update(update_id=414369646, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f2736a5f060>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d600e0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2736336d80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f2736a5f060>
                     └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d62de0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │        └ <function TelegramEventObserver.trigger at 0x7f2736a5e700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 └ <function CallableObject.call at 0x7f2735d62d40>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f2735d3e340>, Message(message_id=410, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f2736804fe0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T00:58:00.499767+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (65221), thread 'MainThread' (139806701483840):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f2736151940>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f272fdd4b90>
                     └ <openai.AsyncOpenAI object at 0x7f272f656600>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f272f656600>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f2736327ec0>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f2736327f60>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f2736324fe0>
          └ <openai.AsyncOpenAI object at 0x7f272f656600>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f2736804d60>
    │       └ <function run at 0x7f2739d4e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f2735fabb40>
           │      └ <function Runner.run at 0x7f2739defba0>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f2739ded800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f2739ded760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f2739def560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f2739d39940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,)}
                     │    │           │    └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f2735d45eb0>
                     │    └ <function Dispatcher.feed_update at 0x7f2736a5fa60>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2735d471a0>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f2735d472c0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f2735d47380>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function TelegramEventObserver.trigger at 0x7f2735d3eac0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function CallableObject.call at 0x7f2735d62f20>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f2736778b00'>>, Update(update_id=414369646, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f2736a5f060>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d600e0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2736336d80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f2736a5f060>
                     └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d62de0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │        └ <function TelegramEventObserver.trigger at 0x7f2736a5e700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 └ <function CallableObject.call at 0x7f2735d62d40>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f2735d3e340>, Message(message_id=410, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f2736804fe0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T00:58:00.499767+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (65221), thread 'MainThread' (139806701483840):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f2736151940>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f272fdd4b90>
                     └ <openai.AsyncOpenAI object at 0x7f272f656600>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f272f656600>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f2736327ec0>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f2736327f60>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f2736324fe0>
          └ <openai.AsyncOpenAI object at 0x7f272f656600>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f2736804d60>
    │       └ <function run at 0x7f2739d4e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f2735fabb40>
           │      └ <function Runner.run at 0x7f2739defba0>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f2739ded800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f2739ded760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f2739def560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f2739d39940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,)}
                     │    │           │    └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f2735d45eb0>
                     │    └ <function Dispatcher.feed_update at 0x7f2736a5fa60>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2735d471a0>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f2735d472c0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f2735d47380>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function TelegramEventObserver.trigger at 0x7f2735d3eac0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function CallableObject.call at 0x7f2735d62f20>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f2736778b00'>>, Update(update_id=414369646, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f2736a5f060>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d600e0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2736336d80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f2736a5f060>
                     └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d62de0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │        └ <function TelegramEventObserver.trigger at 0x7f2736a5e700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 └ <function CallableObject.call at 0x7f2735d62d40>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f2735d3e340>, Message(message_id=410, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f2736804fe0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T00:58:00.499767+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (65221), thread 'MainThread' (139806701483840):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f2736151940>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f272fdd4b90>
                     └ <openai.AsyncOpenAI object at 0x7f272f656600>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f272f656600>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f2736327ec0>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f2736327f60>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f2736324fe0>
          └ <openai.AsyncOpenAI object at 0x7f272f656600>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f2736804d60>
    │       └ <function run at 0x7f2739d4e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f2735fabb40>
           │      └ <function Runner.run at 0x7f2739defba0>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f2739ded800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f2739ded760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f2739def560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f2739d39940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,)}
                     │    │           │    └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f2735d45eb0>
                     │    └ <function Dispatcher.feed_update at 0x7f2736a5fa60>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2735d471a0>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f2735d472c0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f2735d47380>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function TelegramEventObserver.trigger at 0x7f2735d3eac0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function CallableObject.call at 0x7f2735d62f20>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f2736778b00'>>, Update(update_id=414369646, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f2736a5f060>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d600e0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2736336d80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f2736a5f060>
                     └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d62de0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │        └ <function TelegramEventObserver.trigger at 0x7f2736a5e700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 └ <function CallableObject.call at 0x7f2735d62d40>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f2735d3e340>, Message(message_id=410, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f2736804fe0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T00:58:00.499767+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (65221), thread 'MainThread' (139806701483840):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f2736151940>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f272fdd4b90>
                     └ <openai.AsyncOpenAI object at 0x7f272f656600>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f272f656600>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f272fdd5130>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f2736327ec0>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f2736327f60>
                 └ <openai.AsyncOpenAI object at 0x7f272f656600>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f2736324fe0>
          └ <openai.AsyncOpenAI object at 0x7f272f656600>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f2736804d60>
    │       └ <function run at 0x7f2739d4e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f2735fabb40>
           │      └ <function Runner.run at 0x7f2739defba0>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f2739ded800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f273642fce0>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f2739ded760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f2739def560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f2739d39940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f2734d8a4d0>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,)}
                     │    │           │    └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f2735d45eb0>
                     │    └ <function Dispatcher.feed_update at 0x7f2736a5fa60>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2735d471a0>
                     └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f2735d472c0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f2735d47380>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function TelegramEventObserver.trigger at 0x7f2735d3eac0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369646, message=Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), ...
                 └ <function CallableObject.call at 0x7f2735d62f20>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f2736778b00'>>, Update(update_id=414369646, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f2736a5f060>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d600e0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f2736336d80>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Dispatcher '0x7f2736778b00'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f2736a5f060>
                     └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f2735d62de0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f2736a5e5c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f2736a5f100>
                 └ <Router '0x7f27361af530'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                     │        └ <function TelegramEventObserver.trigger at 0x7f2736a5e700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f273614a9f0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f2736778b00'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f2735d45eb0>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=410, date=datetime.datetime(2024, 9, 20, 21, 58, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='privat...
                 └ <function CallableObject.call at 0x7f2735d62d40>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f2735d3e340>, Message(message_id=410, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f2736804fe0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T00:58:00.530752+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:58:00.530752+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:58:00.530752+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:58:00.530752+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:58:00.530752+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:58:00.530752+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:58:00.530752+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:58:00.530752+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:58:00.530752+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T00:58:00.530752+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T01:01:34.260818+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:01:34.260818+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:01:34.260818+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:01:34.260818+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:01:34.260818+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:01:35.125206+0300  INFO  Ответ gpt получен
2024-09-21T01:01:35.125206+0300  INFO  Ответ gpt получен
2024-09-21T01:01:35.125206+0300  INFO  Ответ gpt получен
2024-09-21T01:01:35.125206+0300  INFO  Ответ gpt получен
2024-09-21T01:01:35.125206+0300  INFO  Ответ gpt получен
2024-09-21T01:01:41.765788+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:01:41.765788+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:01:41.765788+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:01:41.765788+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:01:41.765788+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:01:41.765788+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:01:41.765788+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:01:41.765788+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:01:41.765788+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:01:42.107540+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T01:01:42.107540+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T01:01:42.107540+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T01:01:42.107540+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T01:01:42.107540+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T01:01:42.107540+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T01:01:42.107540+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T01:01:42.107540+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T01:01:42.107540+0300  INFO  Ошибка при обработке запроса: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2024-09-21T01:01:42.107829+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (66809), thread 'MainThread' (140111119214400):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f6e16c498a0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f6e149d01a0>
                     └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f6e172f2000>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f6e16e1fe20>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f6e16e1fec0>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f6e16e1cf40>
          └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f6e175ccc20>
    │       └ <function run at 0x7f6e1af2e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f6e16aa3b40>
           │      └ <function Runner.run at 0x7f6e1afcfba0>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f6e1afcd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f6e1afcd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f6e1afcf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f6e1af19940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,)}
                     │    │           │    └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f6e16b09e20>
                     │    └ <function Dispatcher.feed_update at 0x7f6e17537a60>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0b3b0>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f6e16b0b4d0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f6e16b0b590>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7f6e150137e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7f6e15013a60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f6e16b09f70'>>, Update(update_id=414369652, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f6e17537060>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e16b2aca0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0a360>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f6e17537060>
                     └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e150139c0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7f6e17536700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7f6e16b284a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f6e16b062a0>, Message(message_id=424, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 83, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f6e172fcf40>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T01:01:42.107829+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (66809), thread 'MainThread' (140111119214400):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f6e16c498a0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f6e149d01a0>
                     └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f6e172f2000>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f6e16e1fe20>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f6e16e1fec0>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f6e16e1cf40>
          └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f6e175ccc20>
    │       └ <function run at 0x7f6e1af2e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f6e16aa3b40>
           │      └ <function Runner.run at 0x7f6e1afcfba0>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f6e1afcd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f6e1afcd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f6e1afcf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f6e1af19940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,)}
                     │    │           │    └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f6e16b09e20>
                     │    └ <function Dispatcher.feed_update at 0x7f6e17537a60>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0b3b0>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f6e16b0b4d0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f6e16b0b590>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7f6e150137e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7f6e15013a60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f6e16b09f70'>>, Update(update_id=414369652, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f6e17537060>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e16b2aca0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0a360>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f6e17537060>
                     └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e150139c0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7f6e17536700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7f6e16b284a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f6e16b062a0>, Message(message_id=424, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 83, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f6e172fcf40>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T01:01:42.107829+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (66809), thread 'MainThread' (140111119214400):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f6e16c498a0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f6e149d01a0>
                     └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f6e172f2000>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f6e16e1fe20>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f6e16e1fec0>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f6e16e1cf40>
          └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f6e175ccc20>
    │       └ <function run at 0x7f6e1af2e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f6e16aa3b40>
           │      └ <function Runner.run at 0x7f6e1afcfba0>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f6e1afcd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f6e1afcd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f6e1afcf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f6e1af19940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,)}
                     │    │           │    └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f6e16b09e20>
                     │    └ <function Dispatcher.feed_update at 0x7f6e17537a60>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0b3b0>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f6e16b0b4d0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f6e16b0b590>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7f6e150137e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7f6e15013a60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f6e16b09f70'>>, Update(update_id=414369652, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f6e17537060>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e16b2aca0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0a360>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f6e17537060>
                     └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e150139c0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7f6e17536700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7f6e16b284a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f6e16b062a0>, Message(message_id=424, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 83, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f6e172fcf40>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T01:01:42.107829+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (66809), thread 'MainThread' (140111119214400):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f6e16c498a0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f6e149d01a0>
                     └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f6e172f2000>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f6e16e1fe20>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f6e16e1fec0>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f6e16e1cf40>
          └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f6e175ccc20>
    │       └ <function run at 0x7f6e1af2e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f6e16aa3b40>
           │      └ <function Runner.run at 0x7f6e1afcfba0>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f6e1afcd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f6e1afcd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f6e1afcf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f6e1af19940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,)}
                     │    │           │    └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f6e16b09e20>
                     │    └ <function Dispatcher.feed_update at 0x7f6e17537a60>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0b3b0>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f6e16b0b4d0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f6e16b0b590>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7f6e150137e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7f6e15013a60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f6e16b09f70'>>, Update(update_id=414369652, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f6e17537060>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e16b2aca0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0a360>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f6e17537060>
                     └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e150139c0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7f6e17536700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7f6e16b284a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f6e16b062a0>, Message(message_id=424, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 83, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f6e172fcf40>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T01:01:42.107829+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (66809), thread 'MainThread' (140111119214400):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f6e16c498a0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f6e149d01a0>
                     └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f6e172f2000>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f6e16e1fe20>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f6e16e1fec0>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f6e16e1cf40>
          └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f6e175ccc20>
    │       └ <function run at 0x7f6e1af2e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f6e16aa3b40>
           │      └ <function Runner.run at 0x7f6e1afcfba0>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f6e1afcd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f6e1afcd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f6e1afcf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f6e1af19940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,)}
                     │    │           │    └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f6e16b09e20>
                     │    └ <function Dispatcher.feed_update at 0x7f6e17537a60>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0b3b0>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f6e16b0b4d0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f6e16b0b590>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7f6e150137e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7f6e15013a60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f6e16b09f70'>>, Update(update_id=414369652, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f6e17537060>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e16b2aca0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0a360>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f6e17537060>
                     └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e150139c0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7f6e17536700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7f6e16b284a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f6e16b062a0>, Message(message_id=424, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 83, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f6e172fcf40>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T01:01:42.107829+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (66809), thread 'MainThread' (140111119214400):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f6e16c498a0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f6e149d01a0>
                     └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f6e172f2000>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f6e16e1fe20>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f6e16e1fec0>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f6e16e1cf40>
          └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f6e175ccc20>
    │       └ <function run at 0x7f6e1af2e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f6e16aa3b40>
           │      └ <function Runner.run at 0x7f6e1afcfba0>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f6e1afcd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f6e1afcd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f6e1afcf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f6e1af19940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,)}
                     │    │           │    └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f6e16b09e20>
                     │    └ <function Dispatcher.feed_update at 0x7f6e17537a60>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0b3b0>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f6e16b0b4d0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f6e16b0b590>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7f6e150137e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7f6e15013a60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f6e16b09f70'>>, Update(update_id=414369652, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f6e17537060>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e16b2aca0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0a360>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f6e17537060>
                     └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e150139c0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7f6e17536700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7f6e16b284a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f6e16b062a0>, Message(message_id=424, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 83, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f6e172fcf40>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T01:01:42.107829+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (66809), thread 'MainThread' (140111119214400):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f6e16c498a0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f6e149d01a0>
                     └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f6e172f2000>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f6e16e1fe20>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f6e16e1fec0>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f6e16e1cf40>
          └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f6e175ccc20>
    │       └ <function run at 0x7f6e1af2e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f6e16aa3b40>
           │      └ <function Runner.run at 0x7f6e1afcfba0>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f6e1afcd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f6e1afcd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f6e1afcf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f6e1af19940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,)}
                     │    │           │    └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f6e16b09e20>
                     │    └ <function Dispatcher.feed_update at 0x7f6e17537a60>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0b3b0>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f6e16b0b4d0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f6e16b0b590>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7f6e150137e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7f6e15013a60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f6e16b09f70'>>, Update(update_id=414369652, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f6e17537060>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e16b2aca0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0a360>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f6e17537060>
                     └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e150139c0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7f6e17536700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7f6e16b284a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f6e16b062a0>, Message(message_id=424, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 83, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f6e172fcf40>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T01:01:42.107829+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (66809), thread 'MainThread' (140111119214400):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f6e16c498a0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f6e149d01a0>
                     └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f6e172f2000>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f6e16e1fe20>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f6e16e1fec0>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f6e16e1cf40>
          └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f6e175ccc20>
    │       └ <function run at 0x7f6e1af2e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f6e16aa3b40>
           │      └ <function Runner.run at 0x7f6e1afcfba0>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f6e1afcd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f6e1afcd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f6e1afcf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f6e1af19940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,)}
                     │    │           │    └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f6e16b09e20>
                     │    └ <function Dispatcher.feed_update at 0x7f6e17537a60>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0b3b0>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f6e16b0b4d0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f6e16b0b590>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7f6e150137e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7f6e15013a60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f6e16b09f70'>>, Update(update_id=414369652, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f6e17537060>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e16b2aca0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0a360>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f6e17537060>
                     └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e150139c0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7f6e17536700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7f6e16b284a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f6e16b062a0>, Message(message_id=424, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 83, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f6e172fcf40>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T01:01:42.107829+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (66809), thread 'MainThread' (140111119214400):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x7f6e16c498a0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x7f6e149d01a0>
                     └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x7f6e172f2000>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x7f6e1444fbc0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x7f6e16e1fe20>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x7f6e16e1fec0>
                 └ <openai.AsyncOpenAI object at 0x7f6e172f2000>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1611, in _request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x7f6e16e1cf40>
          └ <openai.AsyncOpenAI object at 0x7f6e172f2000>

openai.NotFoundError: Error code: 404 - {'error': {'message': 'The model `gpt-4-o` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7f6e175ccc20>
    │       └ <function run at 0x7f6e1af2e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7f6e16aa3b40>
           │      └ <function Runner.run at 0x7f6e1afcfba0>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f6e1afcd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f6e16c84710>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f6e1afcd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f6e1afcf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f6e1af19940>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x7f6e149bce80>()>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,)}
                     │    │           │    └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7f6e16b09e20>
                     │    └ <function Dispatcher.feed_update at 0x7f6e17537a60>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0b3b0>
                     └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7f6e16b0b4d0>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7f6e16b0b590>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7f6e150137e0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369652, message=Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7f6e15013a60>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7f6e16b09f70'>>, Update(update_id=414369652, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7f6e17537060>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e16b2aca0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16b0a360>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Dispatcher '0x7f6e16b09f70'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7f6e17537060>
                     └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7f6e150139c0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7f6e175365c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7f6e17537100>
                 └ <Router '0x7f6e1758c920'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7f6e17536700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7f6e16cb1970>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7f6e16b09f70'>, 'bots': (<aiogram.client.bot.Bot object at 0x7f6e16b09e20>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=424, date=datetime.datetime(2024, 9, 20, 22, 1, 41, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7f6e16b284a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7f6e16b062a0>, Message(message_id=424, date=datetime.datetime(2024, 9, 20...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 83, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4-o'
                     │   └ 'Привет!'
                     └ <function gpt at 0x7f6e172fcf40>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/generators.py", line 36, in gpt
    raise Exception

Exception
2024-09-21T01:01:42.142181+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T01:01:42.142181+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T01:01:42.142181+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T01:01:42.142181+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T01:01:42.142181+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T01:01:42.142181+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T01:01:42.142181+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T01:01:42.142181+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T01:01:42.142181+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-21T01:02:28.666438+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:02:28.666438+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:02:28.666438+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:02:28.666438+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:02:29.783662+0300  INFO  Ответ gpt получен
2024-09-21T01:02:29.783662+0300  INFO  Ответ gpt получен
2024-09-21T01:02:29.783662+0300  INFO  Ответ gpt получен
2024-09-21T01:02:29.783662+0300  INFO  Ответ gpt получен
2024-09-21T01:02:36.029159+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:02:36.029159+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:02:36.029159+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:02:36.029159+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:02:36.029159+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:02:36.029159+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:02:36.029159+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:02:36.029159+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:02:36.814375+0300  INFO  Ответ gpt получен
2024-09-21T01:02:36.814375+0300  INFO  Ответ gpt получен
2024-09-21T01:02:36.814375+0300  INFO  Ответ gpt получен
2024-09-21T01:02:36.814375+0300  INFO  Ответ gpt получен
2024-09-21T01:02:36.814375+0300  INFO  Ответ gpt получен
2024-09-21T01:02:36.814375+0300  INFO  Ответ gpt получен
2024-09-21T01:02:36.814375+0300  INFO  Ответ gpt получен
2024-09-21T01:02:36.814375+0300  INFO  Ответ gpt получен
2024-09-21T01:04:04.020371+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:04:04.020371+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:04:04.020371+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:04:04.020371+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:04:04.020371+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:04:04.020371+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:04:04.020371+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:04:04.020371+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:04:04.020371+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:04:04.020371+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:04:04.020371+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:04:04.020371+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:04:04.020371+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:04:07.844812+0300  INFO  Ответ gpt получен
2024-09-21T01:04:07.844812+0300  INFO  Ответ gpt получен
2024-09-21T01:04:07.844812+0300  INFO  Ответ gpt получен
2024-09-21T01:04:07.844812+0300  INFO  Ответ gpt получен
2024-09-21T01:04:07.844812+0300  INFO  Ответ gpt получен
2024-09-21T01:04:07.844812+0300  INFO  Ответ gpt получен
2024-09-21T01:04:07.844812+0300  INFO  Ответ gpt получен
2024-09-21T01:04:07.844812+0300  INFO  Ответ gpt получен
2024-09-21T01:04:07.844812+0300  INFO  Ответ gpt получен
2024-09-21T01:04:07.844812+0300  INFO  Ответ gpt получен
2024-09-21T01:04:07.844812+0300  INFO  Ответ gpt получен
2024-09-21T01:04:07.844812+0300  INFO  Ответ gpt получен
2024-09-21T01:04:07.844812+0300  INFO  Ответ gpt получен
2024-09-21T01:05:14.396803+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:05:14.396803+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:05:14.396803+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:05:14.396803+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:05:14.396803+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:05:14.396803+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:05:14.396803+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:05:14.396803+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:05:14.396803+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:05:14.396803+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:05:14.396803+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:05:14.396803+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:05:14.396803+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:05:14.396803+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:05:14.396803+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:05:14.396803+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:05:14.396803+0300  INFO  API_OPEN_AI обработан
2024-09-21T01:05:16.868984+0300  INFO  Ответ gpt получен
2024-09-21T01:05:16.868984+0300  INFO  Ответ gpt получен
2024-09-21T01:05:16.868984+0300  INFO  Ответ gpt получен
2024-09-21T01:05:16.868984+0300  INFO  Ответ gpt получен
2024-09-21T01:05:16.868984+0300  INFO  Ответ gpt получен
2024-09-21T01:05:16.868984+0300  INFO  Ответ gpt получен
2024-09-21T01:05:16.868984+0300  INFO  Ответ gpt получен
2024-09-21T01:05:16.868984+0300  INFO  Ответ gpt получен
2024-09-21T01:05:16.868984+0300  INFO  Ответ gpt получен
2024-09-21T01:05:16.868984+0300  INFO  Ответ gpt получен
2024-09-21T01:05:16.868984+0300  INFO  Ответ gpt получен
2024-09-21T01:05:16.868984+0300  INFO  Ответ gpt получен
2024-09-21T01:05:16.868984+0300  INFO  Ответ gpt получен
2024-09-21T01:05:16.868984+0300  INFO  Ответ gpt получен
2024-09-21T01:05:16.868984+0300  INFO  Ответ gpt получен
2024-09-21T01:05:16.868984+0300  INFO  Ответ gpt получен
2024-09-21T01:05:16.868984+0300  INFO  Ответ gpt получен
2024-09-21T03:17:27.426053+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:27.426053+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:27.426053+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:27.426053+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:27.426053+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:33.445061+0300  INFO  Ответ gpt получен
2024-09-21T03:17:33.445061+0300  INFO  Ответ gpt получен
2024-09-21T03:17:33.445061+0300  INFO  Ответ gpt получен
2024-09-21T03:17:33.445061+0300  INFO  Ответ gpt получен
2024-09-21T03:17:33.445061+0300  INFO  Ответ gpt получен
2024-09-21T03:17:54.994163+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:54.994163+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:54.994163+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:54.994163+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:54.994163+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:54.994163+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:54.994163+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:55.548673+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:55.548673+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:55.548673+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:55.548673+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:55.548673+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:55.548673+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:55.548673+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:55.548673+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:55.548673+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:17:56.385775+0300  INFO  Ответ gpt получен
2024-09-21T03:17:56.385775+0300  INFO  Ответ gpt получен
2024-09-21T03:17:56.385775+0300  INFO  Ответ gpt получен
2024-09-21T03:17:56.385775+0300  INFO  Ответ gpt получен
2024-09-21T03:17:56.385775+0300  INFO  Ответ gpt получен
2024-09-21T03:17:56.385775+0300  INFO  Ответ gpt получен
2024-09-21T03:17:56.385775+0300  INFO  Ответ gpt получен
2024-09-21T03:17:56.385775+0300  INFO  Ответ gpt получен
2024-09-21T03:17:56.385775+0300  INFO  Ответ gpt получен
2024-09-21T03:18:00.174993+0300  INFO  Ответ gpt получен
2024-09-21T03:18:00.174993+0300  INFO  Ответ gpt получен
2024-09-21T03:18:00.174993+0300  INFO  Ответ gpt получен
2024-09-21T03:18:00.174993+0300  INFO  Ответ gpt получен
2024-09-21T03:18:00.174993+0300  INFO  Ответ gpt получен
2024-09-21T03:18:00.174993+0300  INFO  Ответ gpt получен
2024-09-21T03:18:00.174993+0300  INFO  Ответ gpt получен
2024-09-21T03:18:00.174993+0300  INFO  Ответ gpt получен
2024-09-21T03:18:00.174993+0300  INFO  Ответ gpt получен
2024-09-21T03:20:21.064880+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:20:21.064880+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:20:21.064880+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:20:21.064880+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:20:21.064880+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:20:26.988675+0300  INFO  Ответ gpt получен
2024-09-21T03:20:26.988675+0300  INFO  Ответ gpt получен
2024-09-21T03:20:26.988675+0300  INFO  Ответ gpt получен
2024-09-21T03:20:26.988675+0300  INFO  Ответ gpt получен
2024-09-21T03:20:26.988675+0300  INFO  Ответ gpt получен
2024-09-21T03:22:01.571205+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:22:01.571205+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:22:01.571205+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:22:01.571205+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:22:01.571205+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:22:02.444451+0300  INFO  Ответ gpt получен
2024-09-21T03:22:02.444451+0300  INFO  Ответ gpt получен
2024-09-21T03:22:02.444451+0300  INFO  Ответ gpt получен
2024-09-21T03:22:02.444451+0300  INFO  Ответ gpt получен
2024-09-21T03:22:02.444451+0300  INFO  Ответ gpt получен
2024-09-21T03:22:54.605668+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:22:54.605668+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:22:54.605668+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:22:54.605668+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:22:54.605668+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:23:03.680406+0300  INFO  Ответ gpt получен
2024-09-21T03:23:03.680406+0300  INFO  Ответ gpt получен
2024-09-21T03:23:03.680406+0300  INFO  Ответ gpt получен
2024-09-21T03:23:03.680406+0300  INFO  Ответ gpt получен
2024-09-21T03:23:03.680406+0300  INFO  Ответ gpt получен
2024-09-21T03:29:02.023903+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:29:02.023903+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:29:02.023903+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:29:02.023903+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:29:02.023903+0300  INFO  API_OPEN_AI обработан
2024-09-21T03:29:07.374213+0300  ERROR  Ошибка при обновлении сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...ь...', selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-21T03:29:07.374213+0300  ERROR  Ошибка при обновлении сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...ь...', selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-21T03:29:07.374213+0300  ERROR  Ошибка при обновлении сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...ь...', selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-21T03:29:07.374213+0300  ERROR  Ошибка при обновлении сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...ь...', selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-21T03:29:07.374213+0300  ERROR  Ошибка при обновлении сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...ь...', selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-21T03:53:21.105810+0300  ERROR  Ошибка подключения к базе данных: 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)
2024-09-21T03:53:21.105810+0300  ERROR  Ошибка подключения к базе данных: 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)
2024-09-21T03:53:21.105810+0300  ERROR  Ошибка подключения к базе данных: 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)
2024-09-21T03:53:21.105810+0300  ERROR  Ошибка подключения к базе данных: 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)
2024-09-21T03:53:21.106917+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (129960), thread 'MainThread' (140381703538496):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fad17dd8c20>
    │       └ <function run at 0x7fad1b73e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fad17162440>
           │      └ <function Runner.run at 0x7fad1b7dfba0>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fad1b7dd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fad1b7dd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fad1b7df560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fad1b729940>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,)}
                     │    │           │    └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fad16535340>
                     │    └ <function Dispatcher.feed_update at 0x7fad17d43a60>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165367e0>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fad16536900>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fad16536960>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7fad1654c720>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7fad1654c860>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fad1749ed80'>>, Update(update_id=414369692, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fad17d43060>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e7a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165356a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fad17d43060>
                     └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e840>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7fad17d42700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7fad1654f6a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fad1652e980>, Message(message_id=516, date=datetime.datetime(2024, 9, 21...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 77, in process_generation
    if not check_subscription_status(telegram_id):
           │                         └ 857805093
           └ <function check_subscription_status at 0x7fad1652cae0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/database/check_subscription_status.py", line 34, in check_subscription_status
    if connection.is_connected():

UnboundLocalError: cannot access local variable 'connection' where it is not associated with a value
2024-09-21T03:53:21.106917+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (129960), thread 'MainThread' (140381703538496):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fad17dd8c20>
    │       └ <function run at 0x7fad1b73e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fad17162440>
           │      └ <function Runner.run at 0x7fad1b7dfba0>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fad1b7dd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fad1b7dd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fad1b7df560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fad1b729940>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,)}
                     │    │           │    └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fad16535340>
                     │    └ <function Dispatcher.feed_update at 0x7fad17d43a60>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165367e0>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fad16536900>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fad16536960>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7fad1654c720>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7fad1654c860>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fad1749ed80'>>, Update(update_id=414369692, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fad17d43060>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e7a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165356a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fad17d43060>
                     └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e840>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7fad17d42700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7fad1654f6a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fad1652e980>, Message(message_id=516, date=datetime.datetime(2024, 9, 21...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 77, in process_generation
    if not check_subscription_status(telegram_id):
           │                         └ 857805093
           └ <function check_subscription_status at 0x7fad1652cae0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/database/check_subscription_status.py", line 34, in check_subscription_status
    if connection.is_connected():

UnboundLocalError: cannot access local variable 'connection' where it is not associated with a value
2024-09-21T03:53:21.106917+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (129960), thread 'MainThread' (140381703538496):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fad17dd8c20>
    │       └ <function run at 0x7fad1b73e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fad17162440>
           │      └ <function Runner.run at 0x7fad1b7dfba0>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fad1b7dd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fad1b7dd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fad1b7df560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fad1b729940>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,)}
                     │    │           │    └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fad16535340>
                     │    └ <function Dispatcher.feed_update at 0x7fad17d43a60>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165367e0>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fad16536900>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fad16536960>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7fad1654c720>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7fad1654c860>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fad1749ed80'>>, Update(update_id=414369692, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fad17d43060>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e7a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165356a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fad17d43060>
                     └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e840>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7fad17d42700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7fad1654f6a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fad1652e980>, Message(message_id=516, date=datetime.datetime(2024, 9, 21...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 77, in process_generation
    if not check_subscription_status(telegram_id):
           │                         └ 857805093
           └ <function check_subscription_status at 0x7fad1652cae0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/database/check_subscription_status.py", line 34, in check_subscription_status
    if connection.is_connected():

UnboundLocalError: cannot access local variable 'connection' where it is not associated with a value
2024-09-21T03:53:21.106917+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (129960), thread 'MainThread' (140381703538496):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fad17dd8c20>
    │       └ <function run at 0x7fad1b73e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fad17162440>
           │      └ <function Runner.run at 0x7fad1b7dfba0>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fad1b7dd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fad1b7dd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fad1b7df560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fad1b729940>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,)}
                     │    │           │    └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fad16535340>
                     │    └ <function Dispatcher.feed_update at 0x7fad17d43a60>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165367e0>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fad16536900>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fad16536960>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7fad1654c720>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369692, message=Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7fad1654c860>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fad1749ed80'>>, Update(update_id=414369692, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fad17d43060>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e7a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165356a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fad17d43060>
                     └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e840>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7fad17d42700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=516, date=datetime.datetime(2024, 9, 21, 0, 53, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7fad1654f6a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fad1652e980>, Message(message_id=516, date=datetime.datetime(2024, 9, 21...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 77, in process_generation
    if not check_subscription_status(telegram_id):
           │                         └ 857805093
           └ <function check_subscription_status at 0x7fad1652cae0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/database/check_subscription_status.py", line 34, in check_subscription_status
    if connection.is_connected():

UnboundLocalError: cannot access local variable 'connection' where it is not associated with a value
2024-09-21T03:53:26.598441+0300  ERROR  Ошибка подключения к базе данных: 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)
2024-09-21T03:53:26.598441+0300  ERROR  Ошибка подключения к базе данных: 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)
2024-09-21T03:53:26.598441+0300  ERROR  Ошибка подключения к базе данных: 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)
2024-09-21T03:53:26.598441+0300  ERROR  Ошибка подключения к базе данных: 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)
2024-09-21T03:53:26.598441+0300  ERROR  Ошибка подключения к базе данных: 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)
2024-09-21T03:53:26.598980+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (129960), thread 'MainThread' (140381703538496):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fad17dd8c20>
    │       └ <function run at 0x7fad1b73e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fad17162440>
           │      └ <function Runner.run at 0x7fad1b7dfba0>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fad1b7dd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fad1b7dd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fad1b7df560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fad1b729940>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,)}
                     │    │           │    └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fad16535340>
                     │    └ <function Dispatcher.feed_update at 0x7fad17d43a60>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165367e0>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fad16536900>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fad16536960>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7fad1654c860>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7fad1654c720>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fad1749ed80'>>, Update(update_id=414369693, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fad17d43060>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e7a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165356a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fad17d43060>
                     └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e840>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7fad17d42700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7fad1654f880>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fad1652e980>, Message(message_id=518, date=datetime.datetime(2024, 9, 21...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 77, in process_generation
    if not check_subscription_status(telegram_id):
           │                         └ 857805093
           └ <function check_subscription_status at 0x7fad1652cae0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/database/check_subscription_status.py", line 34, in check_subscription_status
    if connection.is_connected():

UnboundLocalError: cannot access local variable 'connection' where it is not associated with a value
2024-09-21T03:53:26.598980+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (129960), thread 'MainThread' (140381703538496):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fad17dd8c20>
    │       └ <function run at 0x7fad1b73e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fad17162440>
           │      └ <function Runner.run at 0x7fad1b7dfba0>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fad1b7dd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fad1b7dd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fad1b7df560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fad1b729940>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,)}
                     │    │           │    └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fad16535340>
                     │    └ <function Dispatcher.feed_update at 0x7fad17d43a60>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165367e0>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fad16536900>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fad16536960>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7fad1654c860>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7fad1654c720>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fad1749ed80'>>, Update(update_id=414369693, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fad17d43060>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e7a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165356a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fad17d43060>
                     └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e840>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7fad17d42700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7fad1654f880>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fad1652e980>, Message(message_id=518, date=datetime.datetime(2024, 9, 21...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 77, in process_generation
    if not check_subscription_status(telegram_id):
           │                         └ 857805093
           └ <function check_subscription_status at 0x7fad1652cae0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/database/check_subscription_status.py", line 34, in check_subscription_status
    if connection.is_connected():

UnboundLocalError: cannot access local variable 'connection' where it is not associated with a value
2024-09-21T03:53:26.598980+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (129960), thread 'MainThread' (140381703538496):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fad17dd8c20>
    │       └ <function run at 0x7fad1b73e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fad17162440>
           │      └ <function Runner.run at 0x7fad1b7dfba0>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fad1b7dd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fad1b7dd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fad1b7df560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fad1b729940>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,)}
                     │    │           │    └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fad16535340>
                     │    └ <function Dispatcher.feed_update at 0x7fad17d43a60>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165367e0>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fad16536900>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fad16536960>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7fad1654c860>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7fad1654c720>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fad1749ed80'>>, Update(update_id=414369693, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fad17d43060>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e7a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165356a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fad17d43060>
                     └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e840>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7fad17d42700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7fad1654f880>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fad1652e980>, Message(message_id=518, date=datetime.datetime(2024, 9, 21...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 77, in process_generation
    if not check_subscription_status(telegram_id):
           │                         └ 857805093
           └ <function check_subscription_status at 0x7fad1652cae0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/database/check_subscription_status.py", line 34, in check_subscription_status
    if connection.is_connected():

UnboundLocalError: cannot access local variable 'connection' where it is not associated with a value
2024-09-21T03:53:26.598980+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (129960), thread 'MainThread' (140381703538496):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fad17dd8c20>
    │       └ <function run at 0x7fad1b73e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fad17162440>
           │      └ <function Runner.run at 0x7fad1b7dfba0>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fad1b7dd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fad1b7dd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fad1b7df560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fad1b729940>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,)}
                     │    │           │    └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fad16535340>
                     │    └ <function Dispatcher.feed_update at 0x7fad17d43a60>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165367e0>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fad16536900>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fad16536960>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7fad1654c860>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7fad1654c720>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fad1749ed80'>>, Update(update_id=414369693, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fad17d43060>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e7a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165356a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fad17d43060>
                     └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e840>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7fad17d42700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7fad1654f880>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fad1652e980>, Message(message_id=518, date=datetime.datetime(2024, 9, 21...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 77, in process_generation
    if not check_subscription_status(telegram_id):
           │                         └ 857805093
           └ <function check_subscription_status at 0x7fad1652cae0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/database/check_subscription_status.py", line 34, in check_subscription_status
    if connection.is_connected():

UnboundLocalError: cannot access local variable 'connection' where it is not associated with a value
2024-09-21T03:53:26.598980+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (129960), thread 'MainThread' (140381703538496):
Traceback (most recent call last):

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x7fad17dd8c20>
    │       └ <function run at 0x7fad1b73e3e0>
    └ <module 'asyncio' from '/usr/lib64/python3.12/asyncio/__init__.py'>

  File "/usr/lib64/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x7fad17162440>
           │      └ <function Runner.run at 0x7fad1b7dfba0>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fad1b7dd800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fad1bdff410>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fad1b7dd760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fad1b7df560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib64/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fad1b729940>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/usr/lib64/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,)}
                     │    │           │    └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x7fad16535340>
                     │    └ <function Dispatcher.feed_update at 0x7fad17d43a60>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165367e0>
                     └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x7fad16536900>, functools.par...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x7fad16536960>, <function TelegramEventObserver.tri...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │       └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x7fad1654c860>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Update(update_id=414369693, message=Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x7fad1654c720>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x7fad1749ed80'>>, Update(update_id=414369693, mess...
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │    │                           │                  └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x7fad17d43060>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e7a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad165356a0>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Dispatcher '0x7fad1749ed80'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │      │                           │                  └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x7fad17d43060>
                     └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │        │                     │               └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x7fad1654e840>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x7fad17d425c0>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x7fad17d43100>
                 └ <Router '0x7fad17d78170'>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                     │        │       └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x7fad17d42700>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x7fad1749e480>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x7fad1749ed80'>, 'bots': (<aiogram.client.bot.Bot object at 0x7fad16535340>,), 'bot': <aiogram.c...
                 │             └ Message(message_id=518, date=datetime.datetime(2024, 9, 21, 0, 53, 26, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x7fad1654f880>
  File "/home/alexandervolzhanin/.cache/pypoetry/virtualenvs/chat-gpt-BzapIua5-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x7fad1652e980>, Message(message_id=518, date=datetime.datetime(2024, 9, 21...

> File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/handlers.py", line 77, in process_generation
    if not check_subscription_status(telegram_id):
           │                         └ 857805093
           └ <function check_subscription_status at 0x7fad1652cae0>

  File "/home/alexandervolzhanin/pet-project/CHATGPT_BOT/app/database/check_subscription_status.py", line 34, in check_subscription_status
    if connection.is_connected():

UnboundLocalError: cannot access local variable 'connection' where it is not associated with a value
2024-09-21T04:04:50.958802+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:04:50.958802+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:04:50.958802+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:04:51.031882+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:04:51.031882+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:04:51.031882+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:04:51.031882+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:04:52.147600+0300  INFO  Ответ gpt получен
2024-09-21T04:04:52.147600+0300  INFO  Ответ gpt получен
2024-09-21T04:04:52.147600+0300  INFO  Ответ gpt получен
2024-09-21T04:04:52.147600+0300  INFO  Ответ gpt получен
2024-09-21T04:05:32.424269+0300  ERROR  Ошибка подключения к базе данных: 1146 (42S02): Table 'chatgpt_telegram_bot.user_payments' doesn't exist
2024-09-21T04:05:32.424269+0300  ERROR  Ошибка подключения к базе данных: 1146 (42S02): Table 'chatgpt_telegram_bot.user_payments' doesn't exist
2024-09-21T04:05:32.424269+0300  ERROR  Ошибка подключения к базе данных: 1146 (42S02): Table 'chatgpt_telegram_bot.user_payments' doesn't exist
2024-09-21T04:05:32.424269+0300  ERROR  Ошибка подключения к базе данных: 1146 (42S02): Table 'chatgpt_telegram_bot.user_payments' doesn't exist
2024-09-21T04:05:32.425074+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:05:32.425074+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:05:32.425074+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:05:32.425074+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:05:36.582558+0300  ERROR  Ошибка подключения к базе данных: 1146 (42S02): Table 'chatgpt_telegram_bot.user_payments' doesn't exist
2024-09-21T04:05:36.582558+0300  ERROR  Ошибка подключения к базе данных: 1146 (42S02): Table 'chatgpt_telegram_bot.user_payments' doesn't exist
2024-09-21T04:05:36.582558+0300  ERROR  Ошибка подключения к базе данных: 1146 (42S02): Table 'chatgpt_telegram_bot.user_payments' doesn't exist
2024-09-21T04:05:36.582558+0300  ERROR  Ошибка подключения к базе данных: 1146 (42S02): Table 'chatgpt_telegram_bot.user_payments' doesn't exist
2024-09-21T04:05:36.582558+0300  ERROR  Ошибка подключения к базе данных: 1146 (42S02): Table 'chatgpt_telegram_bot.user_payments' doesn't exist
2024-09-21T04:05:36.583554+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:05:36.583554+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:05:36.583554+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:05:36.583554+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:05:36.583554+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:10:36.437583+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:10:36.437583+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:10:36.437583+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:10:36.437583+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:10:39.180488+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:10:39.180488+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:10:39.180488+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:10:39.180488+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:10:39.180488+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:10:49.110132+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:10:49.110132+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:10:49.110132+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:10:49.110132+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:10:49.110132+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:10:49.110132+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:10:49.110132+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:10:49.110132+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:11:53.371230+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:11:53.371230+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:11:53.371230+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:11:53.371230+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:11:53.371230+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:11:53.371230+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:11:53.371230+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:11:53.371230+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:11:53.371230+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:12:15.440849+0300  INFO  Запись успешно обновлена/вставлена в таблицу user_payments
2024-09-21T04:12:15.441851+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:22:24.288092+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:22:24.288092+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:22:24.288092+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:22:24.288092+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:22:24.364585+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:22:24.364585+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:22:24.364585+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:22:24.364585+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:22:24.364585+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:22:25.453369+0300  INFO  Ответ gpt получен
2024-09-21T04:22:25.453369+0300  INFO  Ответ gpt получен
2024-09-21T04:22:25.453369+0300  INFO  Ответ gpt получен
2024-09-21T04:22:25.453369+0300  INFO  Ответ gpt получен
2024-09-21T04:22:25.453369+0300  INFO  Ответ gpt получен
2024-09-21T04:24:25.938160+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:24:25.938160+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:24:25.938160+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:24:25.938160+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:24:25.938160+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:24:25.938160+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:24:25.938160+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:24:25.938160+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:24:46.482208+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:24:46.482208+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:24:46.482208+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:24:46.482208+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:24:46.482208+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:24:46.482208+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:24:46.482208+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:24:46.482208+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:24:46.482208+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:06.990653+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:06.990653+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:06.990653+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:06.990653+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:06.990653+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:06.990653+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:06.990653+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:06.990653+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:06.990653+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:06.990653+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:20.351956+0300  INFO  Запись успешно обновлена/вставлена в таблицу user_payments
2024-09-21T04:25:20.351956+0300  INFO  Запись успешно обновлена/вставлена в таблицу user_payments
2024-09-21T04:25:20.351956+0300  INFO  Запись успешно обновлена/вставлена в таблицу user_payments
2024-09-21T04:25:20.351956+0300  INFO  Запись успешно обновлена/вставлена в таблицу user_payments
2024-09-21T04:25:20.351956+0300  INFO  Запись успешно обновлена/вставлена в таблицу user_payments
2024-09-21T04:25:20.351956+0300  INFO  Запись успешно обновлена/вставлена в таблицу user_payments
2024-09-21T04:25:20.351956+0300  INFO  Запись успешно обновлена/вставлена в таблицу user_payments
2024-09-21T04:25:20.351956+0300  INFO  Запись успешно обновлена/вставлена в таблицу user_payments
2024-09-21T04:25:20.351956+0300  INFO  Запись успешно обновлена/вставлена в таблицу user_payments
2024-09-21T04:25:20.351956+0300  INFO  Запись успешно обновлена/вставлена в таблицу user_payments
2024-09-21T04:25:20.352707+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:20.352707+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:20.352707+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:20.352707+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:20.352707+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:20.352707+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:20.352707+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:20.352707+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:20.352707+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:20.352707+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:23.902744+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:23.902744+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:23.902744+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:23.902744+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:23.902744+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:23.902744+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:23.902744+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:23.902744+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:23.902744+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:23.902744+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:23.902744+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:33.937142+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:33.937142+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:33.937142+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:33.937142+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:33.937142+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:33.937142+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:33.937142+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:33.937142+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:33.937142+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:33.937142+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:33.937142+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:33.937142+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:34.966955+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:34.966955+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:34.966955+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:34.966955+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:34.966955+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:34.966955+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:34.966955+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:34.966955+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:34.966955+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:34.966955+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:34.966955+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:34.966955+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:25:34.966955+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:24.908670+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:24.908670+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:24.908670+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:24.908670+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:24.908670+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:24.908670+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:24.908670+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:24.908670+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:24.908670+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:24.908670+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:24.908670+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:24.908670+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:24.908670+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:24.908670+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:25.581048+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:25.581048+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:25.581048+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:25.581048+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:25.581048+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:25.581048+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:25.581048+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:25.581048+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:25.581048+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:25.581048+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:25.581048+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:25.581048+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:25.581048+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:25.581048+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:26:25.581048+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.258083+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.258083+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.258083+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.258083+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.258083+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.258083+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.258083+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.258083+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.258083+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.258083+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.258083+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.258083+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.258083+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.258083+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.258083+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.258083+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.258083+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:23.336646+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:28:24.398861+0300  INFO  Ответ gpt получен
2024-09-21T04:29:42.916693+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:29:42.916693+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:29:42.916693+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:29:43.138298+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:29:43.138298+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:29:43.138298+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:29:43.138298+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:29:44.435656+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-21T04:29:44.435656+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-21T04:29:44.435656+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-21T04:29:44.435656+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-21T04:32:00.940730+0300  INFO  Запись успешно обновлена/вставлена в таблицу user_payments
2024-09-21T04:32:00.941598+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:32:15.568823+0300  INFO  Запись успешно обновлена/вставлена в таблицу user_payments
2024-09-21T04:32:15.569318+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:32:24.390489+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:32:24.390489+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:32:24.390489+0300  INFO  Соединение с MySQL закрыто
2024-09-21T04:32:24.475581+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:32:24.475581+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:32:24.475581+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:32:24.475581+0300  INFO  API_OPEN_AI обработан
2024-09-21T04:32:25.335669+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-21T04:32:25.335669+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-21T04:32:25.335669+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-21T04:32:25.335669+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T13:37:27.458018+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:37:27.458018+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:37:27.458018+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:37:27.458018+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:37:27.458018+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:37:29.014059+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T13:37:29.014059+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T13:37:29.014059+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T13:37:29.014059+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T13:37:29.014059+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T13:39:37.427306+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:39:37.427306+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:39:37.427306+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:39:37.427306+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:39:37.427306+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:39:38.467449+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:39:38.467449+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:39:38.467449+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:39:38.467449+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:39:38.467449+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:39:38.690064+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T13:39:38.690064+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T13:39:38.690064+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T13:39:38.690064+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T13:39:38.690064+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T13:52:18.647452+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:52:18.647452+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:52:18.647452+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:52:18.647452+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:52:19.676893+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:52:19.676893+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:52:19.676893+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:52:19.676893+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:52:20.108020+0300  INFO  Ответ gpt получен
2024-09-23T13:52:20.108020+0300  INFO  Ответ gpt получен
2024-09-23T13:52:20.108020+0300  INFO  Ответ gpt получен
2024-09-23T13:52:20.108020+0300  INFO  Ответ gpt получен
2024-09-23T13:53:46.340869+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:53:46.340869+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:53:46.340869+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:53:46.340869+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:53:46.340869+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:53:46.340869+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:54:13.733273+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T13:54:13.733273+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T13:54:13.733273+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T13:54:13.733273+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T13:54:13.733273+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T13:54:13.733273+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T13:54:14.293479+0300  INFO  Ответ gpt получен
2024-09-23T13:54:14.293479+0300  INFO  Ответ gpt получен
2024-09-23T13:54:14.293479+0300  INFO  Ответ gpt получен
2024-09-23T13:54:14.293479+0300  INFO  Ответ gpt получен
2024-09-23T13:54:14.293479+0300  INFO  Ответ gpt получен
2024-09-23T13:54:14.293479+0300  INFO  Ответ gpt получен
2024-09-23T13:55:28.342985+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:55:28.342985+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:55:28.342985+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:55:28.342985+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:55:28.342985+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:55:29.817274+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:55:29.817274+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:55:29.817274+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:55:29.817274+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:55:29.817274+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:55:30.307692+0300  INFO  Ответ gpt получен
2024-09-23T13:55:30.307692+0300  INFO  Ответ gpt получен
2024-09-23T13:55:30.307692+0300  INFO  Ответ gpt получен
2024-09-23T13:55:30.307692+0300  INFO  Ответ gpt получен
2024-09-23T13:55:30.307692+0300  INFO  Ответ gpt получен
2024-09-23T13:56:29.302859+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:56:29.302859+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:56:29.302859+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:56:29.302859+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:56:29.302859+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:56:30.137055+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:56:30.137055+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:56:30.137055+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:56:30.137055+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:56:30.137055+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:56:30.341087+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T13:56:30.341087+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T13:56:30.341087+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T13:56:30.341087+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T13:56:30.341087+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T13:57:43.839566+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:57:43.839566+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:57:43.839566+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:57:43.839566+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:57:43.839566+0300  INFO  API_OPEN_AI обработан
2024-09-23T13:57:44.681086+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:57:44.681086+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:57:44.681086+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:57:44.681086+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:57:44.681086+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T13:57:44.682736+0300  ERROR  Ошибка при отправке сообщения: 'Router' object has no attribute 'edit_message_text'
2024-09-23T13:57:44.682736+0300  ERROR  Ошибка при отправке сообщения: 'Router' object has no attribute 'edit_message_text'
2024-09-23T13:57:44.682736+0300  ERROR  Ошибка при отправке сообщения: 'Router' object has no attribute 'edit_message_text'
2024-09-23T13:57:44.682736+0300  ERROR  Ошибка при отправке сообщения: 'Router' object has no attribute 'edit_message_text'
2024-09-23T13:57:44.682736+0300  ERROR  Ошибка при отправке сообщения: 'Router' object has no attribute 'edit_message_text'
2024-09-23T14:00:34.943117+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:00:34.943117+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:00:34.943117+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:00:34.943117+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:00:36.506799+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:00:36.506799+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:00:36.506799+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:00:36.506799+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:00:36.719510+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T14:00:36.719510+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T14:00:36.719510+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T14:00:36.719510+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T14:01:08.929857+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:01:08.929857+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:01:08.929857+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:01:08.929857+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:01:09.989406+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:01:09.989406+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:01:09.989406+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:01:09.989406+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:01:10.201915+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T14:01:10.201915+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T14:01:10.201915+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T14:01:10.201915+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T14:03:59.409846+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:03:59.409846+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:03:59.409846+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:03:59.409846+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:04:00.309618+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:04:00.309618+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:04:00.309618+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:04:00.309618+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:04:00.508166+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T14:04:00.508166+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T14:04:00.508166+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T14:04:00.508166+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T14:06:45.722394+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:06:45.722394+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:06:45.722394+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:06:45.722394+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:06:45.722394+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:06:46.597715+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:06:46.597715+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:06:46.597715+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:06:46.597715+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:06:46.597715+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:06:46.798818+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T14:06:46.798818+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T14:06:46.798818+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T14:06:46.798818+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T14:06:46.798818+0300  ERROR  Ошибка при отправке сообщения: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-09-23T14:12:53.496028+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:12:53.496028+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:12:53.496028+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:12:53.496028+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:12:53.496028+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:12:54.754070+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:12:54.754070+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:12:54.754070+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:12:54.754070+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:12:54.754070+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:12:55.075849+0300  INFO  Ответ gpt получен
2024-09-23T14:12:55.075849+0300  INFO  Ответ gpt получен
2024-09-23T14:12:55.075849+0300  INFO  Ответ gpt получен
2024-09-23T14:12:55.075849+0300  INFO  Ответ gpt получен
2024-09-23T14:12:55.075849+0300  INFO  Ответ gpt получен
2024-09-23T14:13:51.618207+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:13:51.618207+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:13:51.618207+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:13:51.618207+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:13:54.001041+0300  INFO  Ошибка при обработке запроса: Connection error.
2024-09-23T14:13:54.001041+0300  INFO  Ошибка при обработке запроса: Connection error.
2024-09-23T14:13:54.001041+0300  INFO  Ошибка при обработке запроса: Connection error.
2024-09-23T14:13:54.001041+0300  INFO  Ошибка при обработке запроса: Connection error.
2024-09-23T14:13:54.002667+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (32365), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x10708b6a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x1079f36e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x1070a4900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x10708aac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x10708ab60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x107088c20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1079f3980>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x1070a6520>
                 │    └ <httpcore.AnyIOBackend object at 0x107ae0c80>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1079f3980>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106f45bc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107aa4220>
    └ <contextlib._GeneratorContextManager object at 0x107c577a0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x1070b1e40>
                     │    └ <httpx.AsyncClient object at 0x1079f2d50>
                     └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x1070b1ee0>
                     └ <httpx.AsyncClient object at 0x1079f2d50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x1070b1f80>
                     └ <httpx.AsyncClient object at 0x1079f2d50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x1070b2020>
                     └ <httpx.AsyncClient object at 0x1079f2d50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x1070a6f20>
                     └ <httpx.AsyncHTTPTransport object at 0x1079f36e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106f1c860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x108110d40>
    └ <contextlib._GeneratorContextManager object at 0x107c57110>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1075511c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1079f3950>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1079f3680>
                     └ <openai.AsyncOpenAI object at 0x10726dfd0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10726dfd0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1079f3950>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x107347880>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x107347920>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1073479c0>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x107347920>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1073479c0>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x107347920>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x1029ba3e0>
    │       └ <function run at 0x1030253a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1077b8f40>
           │      └ <function Runner.run at 0x1030a1760>
           └ <asyncio.runners.Runner object at 0x10770b350>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x103097240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10770b350>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1030971a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1030a0fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102fde2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,)}
                     │    │           │    └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x10795ff20>
                     │    └ <function Dispatcher.feed_update at 0x106d976a0>
                     └ <Dispatcher '0x10795ff50'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106d96200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1079910a0>
                     └ <Dispatcher '0x10795ff50'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x1079911c0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x107991280>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x106981f80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x107987ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10795ff50'>>, Update(update_id=414369779, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106d96ca0>
                 └ <Dispatcher '0x10795ff50'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10799e7a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106d96200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10795fef0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106d96d40>
                 └ <Dispatcher '0x10795ff50'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106d96ca0>
                     └ <Router '0x106e3e6f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10799e480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106d96200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106e3e720>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106d96d40>
                 └ <Router '0x106e3e6f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106d96340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106e3e720>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x10799f2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107985a80>, Message(message_id=705, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o'
                     │   └ 'Напиши калькулятор на Assembler'
                     └ <function gpt at 0x106e48b80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 37, in gpt
    raise Exception

Exception
2024-09-23T14:13:54.002667+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (32365), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x10708b6a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x1079f36e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x1070a4900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x10708aac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x10708ab60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x107088c20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1079f3980>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x1070a6520>
                 │    └ <httpcore.AnyIOBackend object at 0x107ae0c80>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1079f3980>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106f45bc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107aa4220>
    └ <contextlib._GeneratorContextManager object at 0x107c577a0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x1070b1e40>
                     │    └ <httpx.AsyncClient object at 0x1079f2d50>
                     └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x1070b1ee0>
                     └ <httpx.AsyncClient object at 0x1079f2d50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x1070b1f80>
                     └ <httpx.AsyncClient object at 0x1079f2d50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x1070b2020>
                     └ <httpx.AsyncClient object at 0x1079f2d50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x1070a6f20>
                     └ <httpx.AsyncHTTPTransport object at 0x1079f36e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106f1c860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x108110d40>
    └ <contextlib._GeneratorContextManager object at 0x107c57110>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1075511c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1079f3950>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1079f3680>
                     └ <openai.AsyncOpenAI object at 0x10726dfd0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10726dfd0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1079f3950>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x107347880>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x107347920>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1073479c0>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x107347920>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1073479c0>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x107347920>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x1029ba3e0>
    │       └ <function run at 0x1030253a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1077b8f40>
           │      └ <function Runner.run at 0x1030a1760>
           └ <asyncio.runners.Runner object at 0x10770b350>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x103097240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10770b350>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1030971a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1030a0fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102fde2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,)}
                     │    │           │    └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x10795ff20>
                     │    └ <function Dispatcher.feed_update at 0x106d976a0>
                     └ <Dispatcher '0x10795ff50'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106d96200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1079910a0>
                     └ <Dispatcher '0x10795ff50'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x1079911c0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x107991280>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x106981f80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x107987ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10795ff50'>>, Update(update_id=414369779, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106d96ca0>
                 └ <Dispatcher '0x10795ff50'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10799e7a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106d96200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10795fef0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106d96d40>
                 └ <Dispatcher '0x10795ff50'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106d96ca0>
                     └ <Router '0x106e3e6f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10799e480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106d96200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106e3e720>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106d96d40>
                 └ <Router '0x106e3e6f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106d96340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106e3e720>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x10799f2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107985a80>, Message(message_id=705, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o'
                     │   └ 'Напиши калькулятор на Assembler'
                     └ <function gpt at 0x106e48b80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 37, in gpt
    raise Exception

Exception
2024-09-23T14:13:54.002667+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (32365), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x10708b6a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x1079f36e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x1070a4900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x10708aac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x10708ab60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x107088c20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1079f3980>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x1070a6520>
                 │    └ <httpcore.AnyIOBackend object at 0x107ae0c80>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1079f3980>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106f45bc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107aa4220>
    └ <contextlib._GeneratorContextManager object at 0x107c577a0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x1070b1e40>
                     │    └ <httpx.AsyncClient object at 0x1079f2d50>
                     └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x1070b1ee0>
                     └ <httpx.AsyncClient object at 0x1079f2d50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x1070b1f80>
                     └ <httpx.AsyncClient object at 0x1079f2d50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x1070b2020>
                     └ <httpx.AsyncClient object at 0x1079f2d50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x1070a6f20>
                     └ <httpx.AsyncHTTPTransport object at 0x1079f36e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106f1c860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x108110d40>
    └ <contextlib._GeneratorContextManager object at 0x107c57110>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1075511c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1079f3950>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1079f3680>
                     └ <openai.AsyncOpenAI object at 0x10726dfd0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10726dfd0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1079f3950>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x107347880>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x107347920>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1073479c0>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x107347920>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1073479c0>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x107347920>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x1029ba3e0>
    │       └ <function run at 0x1030253a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1077b8f40>
           │      └ <function Runner.run at 0x1030a1760>
           └ <asyncio.runners.Runner object at 0x10770b350>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x103097240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10770b350>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1030971a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1030a0fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102fde2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,)}
                     │    │           │    └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x10795ff20>
                     │    └ <function Dispatcher.feed_update at 0x106d976a0>
                     └ <Dispatcher '0x10795ff50'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106d96200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1079910a0>
                     └ <Dispatcher '0x10795ff50'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x1079911c0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x107991280>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x106981f80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x107987ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10795ff50'>>, Update(update_id=414369779, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106d96ca0>
                 └ <Dispatcher '0x10795ff50'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10799e7a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106d96200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10795fef0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106d96d40>
                 └ <Dispatcher '0x10795ff50'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106d96ca0>
                     └ <Router '0x106e3e6f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10799e480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106d96200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106e3e720>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106d96d40>
                 └ <Router '0x106e3e6f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106d96340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106e3e720>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x10799f2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107985a80>, Message(message_id=705, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o'
                     │   └ 'Напиши калькулятор на Assembler'
                     └ <function gpt at 0x106e48b80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 37, in gpt
    raise Exception

Exception
2024-09-23T14:13:54.002667+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (32365), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x10708b6a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x1079f36e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x1070a4900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x10708aac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x10708ab60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x107088c20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1079f3980>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x1070a6520>
                 │    └ <httpcore.AnyIOBackend object at 0x107ae0c80>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1079f3980>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106f45bc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107aa4220>
    └ <contextlib._GeneratorContextManager object at 0x107c577a0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x1070b1e40>
                     │    └ <httpx.AsyncClient object at 0x1079f2d50>
                     └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x1070b1ee0>
                     └ <httpx.AsyncClient object at 0x1079f2d50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x1070b1f80>
                     └ <httpx.AsyncClient object at 0x1079f2d50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x1070b2020>
                     └ <httpx.AsyncClient object at 0x1079f2d50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x1070a6f20>
                     └ <httpx.AsyncHTTPTransport object at 0x1079f36e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106f1c860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x108110d40>
    └ <contextlib._GeneratorContextManager object at 0x107c57110>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1075511c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1079f3950>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1079f3680>
                     └ <openai.AsyncOpenAI object at 0x10726dfd0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10726dfd0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1079f3950>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x107347880>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x107347920>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1073479c0>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x107347920>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1073479c0>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x107347920>
                 └ <openai.AsyncOpenAI object at 0x10726dfd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x1029ba3e0>
    │       └ <function run at 0x1030253a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1077b8f40>
           │      └ <function Runner.run at 0x1030a1760>
           └ <asyncio.runners.Runner object at 0x10770b350>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x103097240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10770b350>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1030971a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1030a0fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102fde2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,)}
                     │    │           │    └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x10795ff20>
                     │    └ <function Dispatcher.feed_update at 0x106d976a0>
                     └ <Dispatcher '0x10795ff50'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106d96200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1079910a0>
                     └ <Dispatcher '0x10795ff50'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x1079911c0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x107991280>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x106981f80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369779, message=Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x107987ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10795ff50'>>, Update(update_id=414369779, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106d96ca0>
                 └ <Dispatcher '0x10795ff50'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10799e7a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106d96200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10795fef0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106d96d40>
                 └ <Dispatcher '0x10795ff50'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106d96ca0>
                     └ <Router '0x106e3e6f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10799e480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106d96200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106e3e720>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106d96d40>
                 └ <Router '0x106e3e6f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106d96340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106e3e720>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10795ff50'>, 'bots': (<aiogram.client.bot.Bot object at 0x10795ff20>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=705, date=datetime.datetime(2024, 9, 23, 11, 13, 51, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x10799f2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107985a80>, Message(message_id=705, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o'
                     │   └ 'Напиши калькулятор на Assembler'
                     └ <function gpt at 0x106e48b80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 37, in gpt
    raise Exception

Exception
2024-09-23T14:13:54.078839+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:13:54.078839+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:13:54.078839+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:13:54.078839+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:15:38.529201+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:15:38.529201+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:15:38.529201+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:15:38.529201+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:15:41.275328+0300  INFO  Ошибка при обработке запроса: Connection error.
2024-09-23T14:15:41.275328+0300  INFO  Ошибка при обработке запроса: Connection error.
2024-09-23T14:15:41.275328+0300  INFO  Ошибка при обработке запроса: Connection error.
2024-09-23T14:15:41.275328+0300  INFO  Ошибка при обработке запроса: Connection error.
2024-09-23T14:15:41.276886+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (32417), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x1095f3740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x109f5b5f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x10960c9a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x1095f2b60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x1095f2c00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x1095f0cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x109f5b8f0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x10960e5c0>
                 │    └ <httpcore.AnyIOBackend object at 0x10a1bd730>
                 └ <httpcore._backends.auto.AutoBackend object at 0x109f5b8f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x1094adc60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x10a008040>
    └ <contextlib._GeneratorContextManager object at 0x10a1bf0e0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x109619ee0>
                     │    └ <httpx.AsyncClient object at 0x109f03620>
                     └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x109619f80>
                     └ <httpx.AsyncClient object at 0x109f03620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x10961a020>
                     └ <httpx.AsyncClient object at 0x109f03620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x10961a0c0>
                     └ <httpx.AsyncClient object at 0x109f03620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x10960efc0>
                     └ <httpx.AsyncHTTPTransport object at 0x109f5b5f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x109484900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x10a4f8d40>
    └ <contextlib._GeneratorContextManager object at 0x10a1becc0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x109ab9260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x109a9e780>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x109f5ba10>
                     └ <openai.AsyncOpenAI object at 0x109c8b800>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109c8b800>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x109a9e780>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x1098b3920>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1098b39c0>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1098b3a60>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1098b39c0>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1098b3a60>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1098b39c0>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x104f223e0>
    │       └ <function run at 0x10558d3a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x109d20f40>
           │      └ <function Runner.run at 0x105609760>
           └ <asyncio.runners.Runner object at 0x1055eb920>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1055ff240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1055eb920>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1055ff1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105608fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1055462a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,)}
                     │    │           │    └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x109ec7b00>
                     │    └ <function Dispatcher.feed_update at 0x1092ff6a0>
                     └ <Dispatcher '0x109ec7dd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x1092fe200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109f00fb0>
                     └ <Dispatcher '0x109ec7dd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x109f010d0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x109f01190>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x108ee9f80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x109eefba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x109ec7dd0'>>, Update(update_id=414369783, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x1092feca0>
                 └ <Dispatcher '0x109ec7dd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x109f067a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1092fe200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109ec7a10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1092fed40>
                 └ <Dispatcher '0x109ec7dd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x1092feca0>
                     └ <Router '0x109c76420'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x109f06480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1092fe200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109ccec00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1092fed40>
                 └ <Router '0x109c76420'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x1092fe340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109ccec00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x109f07100>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x109eeda80>, Message(message_id=714, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x1093b0c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 37, in gpt
    raise Exception

Exception
2024-09-23T14:15:41.276886+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (32417), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x1095f3740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x109f5b5f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x10960c9a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x1095f2b60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x1095f2c00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x1095f0cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x109f5b8f0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x10960e5c0>
                 │    └ <httpcore.AnyIOBackend object at 0x10a1bd730>
                 └ <httpcore._backends.auto.AutoBackend object at 0x109f5b8f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x1094adc60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x10a008040>
    └ <contextlib._GeneratorContextManager object at 0x10a1bf0e0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x109619ee0>
                     │    └ <httpx.AsyncClient object at 0x109f03620>
                     └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x109619f80>
                     └ <httpx.AsyncClient object at 0x109f03620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x10961a020>
                     └ <httpx.AsyncClient object at 0x109f03620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x10961a0c0>
                     └ <httpx.AsyncClient object at 0x109f03620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x10960efc0>
                     └ <httpx.AsyncHTTPTransport object at 0x109f5b5f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x109484900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x10a4f8d40>
    └ <contextlib._GeneratorContextManager object at 0x10a1becc0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x109ab9260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x109a9e780>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x109f5ba10>
                     └ <openai.AsyncOpenAI object at 0x109c8b800>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109c8b800>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x109a9e780>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x1098b3920>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1098b39c0>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1098b3a60>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1098b39c0>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1098b3a60>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1098b39c0>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x104f223e0>
    │       └ <function run at 0x10558d3a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x109d20f40>
           │      └ <function Runner.run at 0x105609760>
           └ <asyncio.runners.Runner object at 0x1055eb920>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1055ff240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1055eb920>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1055ff1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105608fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1055462a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,)}
                     │    │           │    └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x109ec7b00>
                     │    └ <function Dispatcher.feed_update at 0x1092ff6a0>
                     └ <Dispatcher '0x109ec7dd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x1092fe200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109f00fb0>
                     └ <Dispatcher '0x109ec7dd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x109f010d0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x109f01190>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x108ee9f80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x109eefba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x109ec7dd0'>>, Update(update_id=414369783, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x1092feca0>
                 └ <Dispatcher '0x109ec7dd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x109f067a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1092fe200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109ec7a10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1092fed40>
                 └ <Dispatcher '0x109ec7dd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x1092feca0>
                     └ <Router '0x109c76420'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x109f06480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1092fe200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109ccec00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1092fed40>
                 └ <Router '0x109c76420'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x1092fe340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109ccec00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x109f07100>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x109eeda80>, Message(message_id=714, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x1093b0c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 37, in gpt
    raise Exception

Exception
2024-09-23T14:15:41.276886+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (32417), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x1095f3740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x109f5b5f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x10960c9a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x1095f2b60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x1095f2c00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x1095f0cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x109f5b8f0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x10960e5c0>
                 │    └ <httpcore.AnyIOBackend object at 0x10a1bd730>
                 └ <httpcore._backends.auto.AutoBackend object at 0x109f5b8f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x1094adc60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x10a008040>
    └ <contextlib._GeneratorContextManager object at 0x10a1bf0e0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x109619ee0>
                     │    └ <httpx.AsyncClient object at 0x109f03620>
                     └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x109619f80>
                     └ <httpx.AsyncClient object at 0x109f03620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x10961a020>
                     └ <httpx.AsyncClient object at 0x109f03620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x10961a0c0>
                     └ <httpx.AsyncClient object at 0x109f03620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x10960efc0>
                     └ <httpx.AsyncHTTPTransport object at 0x109f5b5f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x109484900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x10a4f8d40>
    └ <contextlib._GeneratorContextManager object at 0x10a1becc0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x109ab9260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x109a9e780>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x109f5ba10>
                     └ <openai.AsyncOpenAI object at 0x109c8b800>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109c8b800>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x109a9e780>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x1098b3920>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1098b39c0>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1098b3a60>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1098b39c0>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1098b3a60>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1098b39c0>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x104f223e0>
    │       └ <function run at 0x10558d3a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x109d20f40>
           │      └ <function Runner.run at 0x105609760>
           └ <asyncio.runners.Runner object at 0x1055eb920>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1055ff240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1055eb920>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1055ff1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105608fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1055462a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,)}
                     │    │           │    └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x109ec7b00>
                     │    └ <function Dispatcher.feed_update at 0x1092ff6a0>
                     └ <Dispatcher '0x109ec7dd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x1092fe200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109f00fb0>
                     └ <Dispatcher '0x109ec7dd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x109f010d0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x109f01190>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x108ee9f80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x109eefba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x109ec7dd0'>>, Update(update_id=414369783, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x1092feca0>
                 └ <Dispatcher '0x109ec7dd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x109f067a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1092fe200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109ec7a10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1092fed40>
                 └ <Dispatcher '0x109ec7dd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x1092feca0>
                     └ <Router '0x109c76420'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x109f06480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1092fe200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109ccec00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1092fed40>
                 └ <Router '0x109c76420'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x1092fe340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109ccec00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x109f07100>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x109eeda80>, Message(message_id=714, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x1093b0c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 37, in gpt
    raise Exception

Exception
2024-09-23T14:15:41.276886+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (32417), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x1095f3740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x109f5b5f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x10960c9a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x1095f2b60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x1095f2c00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x1095f0cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x109f5b8f0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x10960e5c0>
                 │    └ <httpcore.AnyIOBackend object at 0x10a1bd730>
                 └ <httpcore._backends.auto.AutoBackend object at 0x109f5b8f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x1094adc60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x10a008040>
    └ <contextlib._GeneratorContextManager object at 0x10a1bf0e0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x109619ee0>
                     │    └ <httpx.AsyncClient object at 0x109f03620>
                     └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x109619f80>
                     └ <httpx.AsyncClient object at 0x109f03620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x10961a020>
                     └ <httpx.AsyncClient object at 0x109f03620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x10961a0c0>
                     └ <httpx.AsyncClient object at 0x109f03620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x10960efc0>
                     └ <httpx.AsyncHTTPTransport object at 0x109f5b5f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x109484900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x10a4f8d40>
    └ <contextlib._GeneratorContextManager object at 0x10a1becc0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 26, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x109ab9260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x109a9e780>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x109f5ba10>
                     └ <openai.AsyncOpenAI object at 0x109c8b800>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109c8b800>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x109a9e780>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x1098b3920>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1098b39c0>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1098b3a60>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1098b39c0>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1098b3a60>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1098b39c0>
                 └ <openai.AsyncOpenAI object at 0x109c8b800>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x104f223e0>
    │       └ <function run at 0x10558d3a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x109d20f40>
           │      └ <function Runner.run at 0x105609760>
           └ <asyncio.runners.Runner object at 0x1055eb920>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1055ff240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1055eb920>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1055ff1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105608fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1055462a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,)}
                     │    │           │    └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x109ec7b00>
                     │    └ <function Dispatcher.feed_update at 0x1092ff6a0>
                     └ <Dispatcher '0x109ec7dd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x1092fe200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109f00fb0>
                     └ <Dispatcher '0x109ec7dd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x109f010d0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x109f01190>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x108ee9f80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369783, message=Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x109eefba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x109ec7dd0'>>, Update(update_id=414369783, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x1092feca0>
                 └ <Dispatcher '0x109ec7dd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x109f067a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1092fe200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109ec7a10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1092fed40>
                 └ <Dispatcher '0x109ec7dd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x1092feca0>
                     └ <Router '0x109c76420'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x109f06480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1092fe200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109ccec00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1092fed40>
                 └ <Router '0x109c76420'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x1092fe340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109ccec00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x109ec7dd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x109ec7b00>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=714, date=datetime.datetime(2024, 9, 23, 11, 15, 38, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x109f07100>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x109eeda80>, Message(message_id=714, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x1093b0c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 37, in gpt
    raise Exception

Exception
2024-09-23T14:15:41.343544+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:15:41.343544+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:15:41.343544+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:15:41.343544+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:19:36.294599+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:19:36.294599+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:19:36.294599+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:19:36.294599+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:19:36.294599+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:19:39.978171+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:19:39.978171+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:19:39.978171+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:19:39.978171+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:19:39.978171+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:19:39.979248+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (32546), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x104f87740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x1058efd10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x104fa09a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x104f86b60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x104f86c00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x104f84cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x105928050>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x104fa25c0>
                 │    └ <httpcore.AnyIOBackend object at 0x105b51df0>
                 └ <httpcore._backends.auto.AutoBackend object at 0x105928050>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x104e41c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x105aa8130>
    └ <contextlib._GeneratorContextManager object at 0x105b53800>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x104fadee0>
                     │    └ <httpx.AsyncClient object at 0x1058ef830>
                     └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x104fadf80>
                     └ <httpx.AsyncClient object at 0x1058ef830>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x104fae020>
                     └ <httpx.AsyncClient object at 0x1058ef830>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x104fae0c0>
                     └ <httpx.AsyncClient object at 0x1058ef830>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x104fa2fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x1058efd10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x104e18900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x106810e40>
    └ <contextlib._GeneratorContextManager object at 0x105b53410>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x10544d260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1059295b0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1058efce0>
                     └ <openai.AsyncOpenAI object at 0x1053d6870>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x1053d6870>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1059295b0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x105243920>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1052439c0>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x105243a60>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1052439c0>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x105243a60>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1052439c0>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x1008b63e0>
    │       └ <function run at 0x100f213a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1056b4f40>
           │      └ <function Runner.run at 0x100f9d760>
           └ <asyncio.runners.Runner object at 0x104d524e0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x100f93240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104d524e0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x100f931a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x100f9cfe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x100eda2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,)}
                     │    │           │    └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x105604d40>
                     │    └ <function Dispatcher.feed_update at 0x104c936a0>
                     └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x104c92200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10588d0a0>
                     └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x10588d1c0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x10588d280>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x10587e480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x10587fba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10561fe30'>>, Update(update_id=414369786, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x104c92ca0>
                 └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10589a480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104c92200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10585bc50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104c92d40>
                 └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x104c92ca0>
                     └ <Router '0x1055de600'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10589a520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104c92200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x104d3a840>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104c92d40>
                 └ <Router '0x1055de600'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x104c92340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x104d3a840>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x10589b2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x10587da80>, Message(message_id=721, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o'
                     │   └ 'Ghbdtn!'
                     └ <function gpt at 0x104d44c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:19:39.979248+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (32546), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x104f87740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x1058efd10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x104fa09a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x104f86b60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x104f86c00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x104f84cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x105928050>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x104fa25c0>
                 │    └ <httpcore.AnyIOBackend object at 0x105b51df0>
                 └ <httpcore._backends.auto.AutoBackend object at 0x105928050>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x104e41c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x105aa8130>
    └ <contextlib._GeneratorContextManager object at 0x105b53800>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x104fadee0>
                     │    └ <httpx.AsyncClient object at 0x1058ef830>
                     └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x104fadf80>
                     └ <httpx.AsyncClient object at 0x1058ef830>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x104fae020>
                     └ <httpx.AsyncClient object at 0x1058ef830>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x104fae0c0>
                     └ <httpx.AsyncClient object at 0x1058ef830>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x104fa2fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x1058efd10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x104e18900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x106810e40>
    └ <contextlib._GeneratorContextManager object at 0x105b53410>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x10544d260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1059295b0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1058efce0>
                     └ <openai.AsyncOpenAI object at 0x1053d6870>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x1053d6870>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1059295b0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x105243920>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1052439c0>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x105243a60>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1052439c0>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x105243a60>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1052439c0>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x1008b63e0>
    │       └ <function run at 0x100f213a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1056b4f40>
           │      └ <function Runner.run at 0x100f9d760>
           └ <asyncio.runners.Runner object at 0x104d524e0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x100f93240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104d524e0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x100f931a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x100f9cfe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x100eda2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,)}
                     │    │           │    └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x105604d40>
                     │    └ <function Dispatcher.feed_update at 0x104c936a0>
                     └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x104c92200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10588d0a0>
                     └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x10588d1c0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x10588d280>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x10587e480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x10587fba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10561fe30'>>, Update(update_id=414369786, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x104c92ca0>
                 └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10589a480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104c92200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10585bc50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104c92d40>
                 └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x104c92ca0>
                     └ <Router '0x1055de600'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10589a520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104c92200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x104d3a840>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104c92d40>
                 └ <Router '0x1055de600'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x104c92340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x104d3a840>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x10589b2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x10587da80>, Message(message_id=721, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o'
                     │   └ 'Ghbdtn!'
                     └ <function gpt at 0x104d44c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:19:39.979248+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (32546), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x104f87740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x1058efd10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x104fa09a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x104f86b60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x104f86c00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x104f84cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x105928050>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x104fa25c0>
                 │    └ <httpcore.AnyIOBackend object at 0x105b51df0>
                 └ <httpcore._backends.auto.AutoBackend object at 0x105928050>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x104e41c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x105aa8130>
    └ <contextlib._GeneratorContextManager object at 0x105b53800>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x104fadee0>
                     │    └ <httpx.AsyncClient object at 0x1058ef830>
                     └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x104fadf80>
                     └ <httpx.AsyncClient object at 0x1058ef830>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x104fae020>
                     └ <httpx.AsyncClient object at 0x1058ef830>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x104fae0c0>
                     └ <httpx.AsyncClient object at 0x1058ef830>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x104fa2fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x1058efd10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x104e18900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x106810e40>
    └ <contextlib._GeneratorContextManager object at 0x105b53410>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x10544d260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1059295b0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1058efce0>
                     └ <openai.AsyncOpenAI object at 0x1053d6870>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x1053d6870>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1059295b0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x105243920>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1052439c0>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x105243a60>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1052439c0>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x105243a60>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1052439c0>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x1008b63e0>
    │       └ <function run at 0x100f213a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1056b4f40>
           │      └ <function Runner.run at 0x100f9d760>
           └ <asyncio.runners.Runner object at 0x104d524e0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x100f93240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104d524e0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x100f931a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x100f9cfe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x100eda2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,)}
                     │    │           │    └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x105604d40>
                     │    └ <function Dispatcher.feed_update at 0x104c936a0>
                     └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x104c92200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10588d0a0>
                     └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x10588d1c0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x10588d280>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x10587e480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x10587fba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10561fe30'>>, Update(update_id=414369786, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x104c92ca0>
                 └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10589a480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104c92200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10585bc50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104c92d40>
                 └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x104c92ca0>
                     └ <Router '0x1055de600'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10589a520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104c92200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x104d3a840>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104c92d40>
                 └ <Router '0x1055de600'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x104c92340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x104d3a840>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x10589b2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x10587da80>, Message(message_id=721, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o'
                     │   └ 'Ghbdtn!'
                     └ <function gpt at 0x104d44c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:19:39.979248+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (32546), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x104f87740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x1058efd10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x104fa09a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x104f86b60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x104f86c00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x104f84cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x105928050>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x104fa25c0>
                 │    └ <httpcore.AnyIOBackend object at 0x105b51df0>
                 └ <httpcore._backends.auto.AutoBackend object at 0x105928050>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x104e41c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x105aa8130>
    └ <contextlib._GeneratorContextManager object at 0x105b53800>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x104fadee0>
                     │    └ <httpx.AsyncClient object at 0x1058ef830>
                     └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x104fadf80>
                     └ <httpx.AsyncClient object at 0x1058ef830>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x104fae020>
                     └ <httpx.AsyncClient object at 0x1058ef830>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x104fae0c0>
                     └ <httpx.AsyncClient object at 0x1058ef830>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x104fa2fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x1058efd10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x104e18900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x106810e40>
    └ <contextlib._GeneratorContextManager object at 0x105b53410>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x10544d260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1059295b0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1058efce0>
                     └ <openai.AsyncOpenAI object at 0x1053d6870>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x1053d6870>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1059295b0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x105243920>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1052439c0>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x105243a60>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1052439c0>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x105243a60>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1052439c0>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x1008b63e0>
    │       └ <function run at 0x100f213a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1056b4f40>
           │      └ <function Runner.run at 0x100f9d760>
           └ <asyncio.runners.Runner object at 0x104d524e0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x100f93240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104d524e0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x100f931a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x100f9cfe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x100eda2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,)}
                     │    │           │    └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x105604d40>
                     │    └ <function Dispatcher.feed_update at 0x104c936a0>
                     └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x104c92200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10588d0a0>
                     └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x10588d1c0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x10588d280>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x10587e480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x10587fba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10561fe30'>>, Update(update_id=414369786, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x104c92ca0>
                 └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10589a480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104c92200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10585bc50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104c92d40>
                 └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x104c92ca0>
                     └ <Router '0x1055de600'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10589a520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104c92200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x104d3a840>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104c92d40>
                 └ <Router '0x1055de600'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x104c92340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x104d3a840>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x10589b2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x10587da80>, Message(message_id=721, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o'
                     │   └ 'Ghbdtn!'
                     └ <function gpt at 0x104d44c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:19:39.979248+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (32546), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x104f87740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x1058efd10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x104fa09a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x104f86b60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x104f86c00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x104f84cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x105928050>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x104fa25c0>
                 │    └ <httpcore.AnyIOBackend object at 0x105b51df0>
                 └ <httpcore._backends.auto.AutoBackend object at 0x105928050>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x104e41c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x105aa8130>
    └ <contextlib._GeneratorContextManager object at 0x105b53800>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x104fadee0>
                     │    └ <httpx.AsyncClient object at 0x1058ef830>
                     └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x104fadf80>
                     └ <httpx.AsyncClient object at 0x1058ef830>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x104fae020>
                     └ <httpx.AsyncClient object at 0x1058ef830>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x104fae0c0>
                     └ <httpx.AsyncClient object at 0x1058ef830>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x104fa2fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x1058efd10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x104e18900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x106810e40>
    └ <contextlib._GeneratorContextManager object at 0x105b53410>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x10544d260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1059295b0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1058efce0>
                     └ <openai.AsyncOpenAI object at 0x1053d6870>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x1053d6870>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1059295b0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x105243920>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1052439c0>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x105243a60>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1052439c0>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x105243a60>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1052439c0>
                 └ <openai.AsyncOpenAI object at 0x1053d6870>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x1008b63e0>
    │       └ <function run at 0x100f213a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1056b4f40>
           │      └ <function Runner.run at 0x100f9d760>
           └ <asyncio.runners.Runner object at 0x104d524e0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x100f93240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104d524e0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x100f931a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x100f9cfe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x100eda2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,)}
                     │    │           │    └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x105604d40>
                     │    └ <function Dispatcher.feed_update at 0x104c936a0>
                     └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x104c92200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10588d0a0>
                     └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x10588d1c0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x10588d280>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x10587e480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369786, message=Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x10587fba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10561fe30'>>, Update(update_id=414369786, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x104c92ca0>
                 └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10589a480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104c92200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10585bc50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104c92d40>
                 └ <Dispatcher '0x10561fe30'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x104c92ca0>
                     └ <Router '0x1055de600'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10589a520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104c92200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x104d3a840>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104c92d40>
                 └ <Router '0x1055de600'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x104c92340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x104d3a840>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10561fe30'>, 'bots': (<aiogram.client.bot.Bot object at 0x105604d40>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=721, date=datetime.datetime(2024, 9, 23, 11, 19, 36, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x10589b2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x10587da80>, Message(message_id=721, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o'
                     │   └ 'Ghbdtn!'
                     └ <function gpt at 0x104d44c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:19:40.044041+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:19:40.044041+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:19:40.044041+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:19:40.044041+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:19:40.044041+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:23:28.783696+0300  INFO  API_OPEN_AI клиент создан
2024-09-23T14:23:28.783696+0300  INFO  API_OPEN_AI клиент создан
2024-09-23T14:23:28.783696+0300  INFO  API_OPEN_AI клиент создан
2024-09-23T14:23:28.783696+0300  INFO  API_OPEN_AI клиент создан
2024-09-23T14:23:28.783696+0300  INFO  API_OPEN_AI клиент создан
2024-09-23T14:23:28.785647+0300  INFO  Отправка запроса к GPT с моделью gpt-4o-mini: Привет!
2024-09-23T14:23:28.785647+0300  INFO  Отправка запроса к GPT с моделью gpt-4o-mini: Привет!
2024-09-23T14:23:28.785647+0300  INFO  Отправка запроса к GPT с моделью gpt-4o-mini: Привет!
2024-09-23T14:23:28.785647+0300  INFO  Отправка запроса к GPT с моделью gpt-4o-mini: Привет!
2024-09-23T14:23:28.785647+0300  INFO  Отправка запроса к GPT с моделью gpt-4o-mini: Привет!
2024-09-23T14:23:31.484677+0300  ERROR  Ошибка при обработке запроса к GPT: Connection error.
2024-09-23T14:23:31.484677+0300  ERROR  Ошибка при обработке запроса к GPT: Connection error.
2024-09-23T14:23:31.484677+0300  ERROR  Ошибка при обработке запроса к GPT: Connection error.
2024-09-23T14:23:31.484677+0300  ERROR  Ошибка при обработке запроса к GPT: Connection error.
2024-09-23T14:23:31.484677+0300  ERROR  Ошибка при обработке запроса к GPT: Connection error.
2024-09-23T14:23:31.486196+0300  ERROR  Ошибка при генерации ответа gpt: Connection error.
2024-09-23T14:23:31.486196+0300  ERROR  Ошибка при генерации ответа gpt: Connection error.
2024-09-23T14:23:31.486196+0300  ERROR  Ошибка при генерации ответа gpt: Connection error.
2024-09-23T14:23:31.486196+0300  ERROR  Ошибка при генерации ответа gpt: Connection error.
2024-09-23T14:23:31.486196+0300  ERROR  Ошибка при генерации ответа gpt: Connection error.
2024-09-23T14:25:05.476988+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:25:05.476988+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:25:05.476988+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:25:05.476988+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:25:05.476988+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:25:08.231492+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:25:08.231492+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:25:08.231492+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:25:08.231492+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:25:08.231492+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:25:08.233288+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33550), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x108bcb740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x109533cb0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x108be49a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x108bcab60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x108bcac00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x108bc8cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1094d96d0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x108be65c0>
                 │    └ <httpcore.AnyIOBackend object at 0x109dfdee0>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1094d96d0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x108a85c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x109d54040>
    └ <contextlib._GeneratorContextManager object at 0x109dff980>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x108bf1ee0>
                     │    └ <httpx.AsyncClient object at 0x1095333e0>
                     └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x108bf1f80>
                     └ <httpx.AsyncClient object at 0x1095333e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x108bf2020>
                     └ <httpx.AsyncClient object at 0x1095333e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x108bf20c0>
                     └ <httpx.AsyncClient object at 0x1095333e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x108be6fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x109533cb0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x108a5c900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x109f10e40>
    └ <contextlib._GeneratorContextManager object at 0x109dff560>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x109091260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1094d93d0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x109533ec0>
                     └ <openai.AsyncOpenAI object at 0x109785010>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109785010>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1094d93d0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x108e8b920>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x108e8b9c0>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x108e8ba60>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x108e8b9c0>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x108e8ba60>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x108e8b9c0>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x1044fa3e0>
    │       └ <function run at 0x104b653a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1092f8f40>
           │      └ <function Runner.run at 0x104be1760>
           └ <asyncio.runners.Runner object at 0x108dae6f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x104bd7240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x108dae6f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x104bd71a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x104be0fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x104b1e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,)}
                     │    │           │    └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x10949fd70>
                     │    └ <function Dispatcher.feed_update at 0x1088d76a0>
                     └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x1088d6200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1094d8f50>
                     └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x1094d9070>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x1094d9130>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x1094c6480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x1094c7ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10949fdd0'>>, Update(update_id=414369792, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x1088d6ca0>
                 └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1094de480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1088d6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10949fda0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1088d6d40>
                 └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x1088d6ca0>
                     └ <Router '0x1088566c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1094de520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1088d6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109286c30>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1088d6d40>
                 └ <Router '0x1088566c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x1088d6340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109286c30>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x1094df2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x1094c5a80>, Message(message_id=735, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x108988c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:25:08.233288+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33550), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x108bcb740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x109533cb0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x108be49a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x108bcab60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x108bcac00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x108bc8cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1094d96d0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x108be65c0>
                 │    └ <httpcore.AnyIOBackend object at 0x109dfdee0>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1094d96d0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x108a85c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x109d54040>
    └ <contextlib._GeneratorContextManager object at 0x109dff980>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x108bf1ee0>
                     │    └ <httpx.AsyncClient object at 0x1095333e0>
                     └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x108bf1f80>
                     └ <httpx.AsyncClient object at 0x1095333e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x108bf2020>
                     └ <httpx.AsyncClient object at 0x1095333e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x108bf20c0>
                     └ <httpx.AsyncClient object at 0x1095333e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x108be6fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x109533cb0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x108a5c900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x109f10e40>
    └ <contextlib._GeneratorContextManager object at 0x109dff560>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x109091260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1094d93d0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x109533ec0>
                     └ <openai.AsyncOpenAI object at 0x109785010>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109785010>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1094d93d0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x108e8b920>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x108e8b9c0>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x108e8ba60>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x108e8b9c0>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x108e8ba60>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x108e8b9c0>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x1044fa3e0>
    │       └ <function run at 0x104b653a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1092f8f40>
           │      └ <function Runner.run at 0x104be1760>
           └ <asyncio.runners.Runner object at 0x108dae6f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x104bd7240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x108dae6f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x104bd71a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x104be0fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x104b1e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,)}
                     │    │           │    └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x10949fd70>
                     │    └ <function Dispatcher.feed_update at 0x1088d76a0>
                     └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x1088d6200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1094d8f50>
                     └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x1094d9070>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x1094d9130>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x1094c6480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x1094c7ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10949fdd0'>>, Update(update_id=414369792, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x1088d6ca0>
                 └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1094de480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1088d6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10949fda0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1088d6d40>
                 └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x1088d6ca0>
                     └ <Router '0x1088566c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1094de520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1088d6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109286c30>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1088d6d40>
                 └ <Router '0x1088566c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x1088d6340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109286c30>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x1094df2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x1094c5a80>, Message(message_id=735, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x108988c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:25:08.233288+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33550), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x108bcb740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x109533cb0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x108be49a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x108bcab60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x108bcac00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x108bc8cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1094d96d0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x108be65c0>
                 │    └ <httpcore.AnyIOBackend object at 0x109dfdee0>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1094d96d0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x108a85c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x109d54040>
    └ <contextlib._GeneratorContextManager object at 0x109dff980>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x108bf1ee0>
                     │    └ <httpx.AsyncClient object at 0x1095333e0>
                     └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x108bf1f80>
                     └ <httpx.AsyncClient object at 0x1095333e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x108bf2020>
                     └ <httpx.AsyncClient object at 0x1095333e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x108bf20c0>
                     └ <httpx.AsyncClient object at 0x1095333e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x108be6fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x109533cb0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x108a5c900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x109f10e40>
    └ <contextlib._GeneratorContextManager object at 0x109dff560>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x109091260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1094d93d0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x109533ec0>
                     └ <openai.AsyncOpenAI object at 0x109785010>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109785010>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1094d93d0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x108e8b920>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x108e8b9c0>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x108e8ba60>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x108e8b9c0>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x108e8ba60>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x108e8b9c0>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x1044fa3e0>
    │       └ <function run at 0x104b653a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1092f8f40>
           │      └ <function Runner.run at 0x104be1760>
           └ <asyncio.runners.Runner object at 0x108dae6f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x104bd7240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x108dae6f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x104bd71a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x104be0fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x104b1e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,)}
                     │    │           │    └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x10949fd70>
                     │    └ <function Dispatcher.feed_update at 0x1088d76a0>
                     └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x1088d6200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1094d8f50>
                     └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x1094d9070>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x1094d9130>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x1094c6480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x1094c7ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10949fdd0'>>, Update(update_id=414369792, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x1088d6ca0>
                 └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1094de480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1088d6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10949fda0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1088d6d40>
                 └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x1088d6ca0>
                     └ <Router '0x1088566c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1094de520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1088d6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109286c30>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1088d6d40>
                 └ <Router '0x1088566c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x1088d6340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109286c30>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x1094df2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x1094c5a80>, Message(message_id=735, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x108988c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:25:08.233288+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33550), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x108bcb740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x109533cb0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x108be49a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x108bcab60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x108bcac00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x108bc8cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1094d96d0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x108be65c0>
                 │    └ <httpcore.AnyIOBackend object at 0x109dfdee0>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1094d96d0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x108a85c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x109d54040>
    └ <contextlib._GeneratorContextManager object at 0x109dff980>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x108bf1ee0>
                     │    └ <httpx.AsyncClient object at 0x1095333e0>
                     └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x108bf1f80>
                     └ <httpx.AsyncClient object at 0x1095333e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x108bf2020>
                     └ <httpx.AsyncClient object at 0x1095333e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x108bf20c0>
                     └ <httpx.AsyncClient object at 0x1095333e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x108be6fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x109533cb0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x108a5c900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x109f10e40>
    └ <contextlib._GeneratorContextManager object at 0x109dff560>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x109091260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1094d93d0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x109533ec0>
                     └ <openai.AsyncOpenAI object at 0x109785010>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109785010>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1094d93d0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x108e8b920>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x108e8b9c0>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x108e8ba60>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x108e8b9c0>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x108e8ba60>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x108e8b9c0>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x1044fa3e0>
    │       └ <function run at 0x104b653a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1092f8f40>
           │      └ <function Runner.run at 0x104be1760>
           └ <asyncio.runners.Runner object at 0x108dae6f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x104bd7240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x108dae6f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x104bd71a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x104be0fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x104b1e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,)}
                     │    │           │    └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x10949fd70>
                     │    └ <function Dispatcher.feed_update at 0x1088d76a0>
                     └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x1088d6200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1094d8f50>
                     └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x1094d9070>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x1094d9130>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x1094c6480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x1094c7ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10949fdd0'>>, Update(update_id=414369792, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x1088d6ca0>
                 └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1094de480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1088d6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10949fda0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1088d6d40>
                 └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x1088d6ca0>
                     └ <Router '0x1088566c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1094de520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1088d6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109286c30>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1088d6d40>
                 └ <Router '0x1088566c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x1088d6340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109286c30>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x1094df2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x1094c5a80>, Message(message_id=735, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x108988c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:25:08.233288+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33550), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x108bcb740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x109533cb0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x108be49a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x108bcab60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x108bcac00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x108bc8cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1094d96d0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x108be65c0>
                 │    └ <httpcore.AnyIOBackend object at 0x109dfdee0>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1094d96d0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x108a85c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x109d54040>
    └ <contextlib._GeneratorContextManager object at 0x109dff980>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x108bf1ee0>
                     │    └ <httpx.AsyncClient object at 0x1095333e0>
                     └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x108bf1f80>
                     └ <httpx.AsyncClient object at 0x1095333e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x108bf2020>
                     └ <httpx.AsyncClient object at 0x1095333e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x108bf20c0>
                     └ <httpx.AsyncClient object at 0x1095333e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x108be6fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x109533cb0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x108a5c900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x109f10e40>
    └ <contextlib._GeneratorContextManager object at 0x109dff560>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x109091260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1094d93d0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x109533ec0>
                     └ <openai.AsyncOpenAI object at 0x109785010>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109785010>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1094d93d0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x108e8b920>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x108e8b9c0>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x108e8ba60>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x108e8b9c0>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x108e8ba60>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x108e8b9c0>
                 └ <openai.AsyncOpenAI object at 0x109785010>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x1044fa3e0>
    │       └ <function run at 0x104b653a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1092f8f40>
           │      └ <function Runner.run at 0x104be1760>
           └ <asyncio.runners.Runner object at 0x108dae6f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x104bd7240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x108dae6f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x104bd71a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x104be0fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x104b1e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,)}
                     │    │           │    └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                     │    │           └ <aiogram.client.bot.Bot object at 0x10949fd70>
                     │    └ <function Dispatcher.feed_update at 0x1088d76a0>
                     └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x1088d6200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1094d8f50>
                     └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x1094d9070>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x1094d9130>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ <function TelegramEventObserver.trigger at 0x1094c6480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369792, message=Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)...
                 └ <function CallableObject.call at 0x1094c7ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10949fdd0'>>, Update(update_id=414369792, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x1088d6ca0>
                 └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1094de480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1088d6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10949fda0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1088d6d40>
                 └ <Dispatcher '0x10949fdd0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x1088d6ca0>
                     └ <Router '0x1088566c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1094de520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x1088d6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109286c30>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x1088d6d40>
                 └ <Router '0x1088566c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                     │        └ <function TelegramEventObserver.trigger at 0x1088d6340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x109286c30>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10949fdd0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10949fd70>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=735, date=datetime.datetime(2024, 9, 23, 11, 25, 5, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pri...
                 └ <function CallableObject.call at 0x1094df2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x1094c5a80>, Message(message_id=735, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x108988c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:25:08.300306+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:25:08.300306+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:25:08.300306+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:25:08.300306+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:25:08.300306+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:28:20.745522+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:28:20.745522+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:28:20.745522+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:28:20.745522+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:28:23.471808+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:28:23.471808+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:28:23.471808+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:28:23.471808+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:28:23.473262+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33735), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x1051136a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x105aabc50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x10512c900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x105112ac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x105112b60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x105110c20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x105aab2c0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x10512e520>
                 │    └ <httpcore.AnyIOBackend object at 0x1062fdcd0>
                 └ <httpcore._backends.auto.AutoBackend object at 0x105aab2c0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x104fcdbc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x106258220>
    └ <contextlib._GeneratorContextManager object at 0x1062ff590>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x105139e40>
                     │    └ <httpx.AsyncClient object at 0x105aaa5a0>
                     └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x105139ee0>
                     └ <httpx.AsyncClient object at 0x105aaa5a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x105139f80>
                     └ <httpx.AsyncClient object at 0x105aaa5a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x10513a020>
                     └ <httpx.AsyncClient object at 0x105aaa5a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x10512ef20>
                     └ <httpx.AsyncHTTPTransport object at 0x105aabc50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x104fa4860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x106514940>
    └ <contextlib._GeneratorContextManager object at 0x1062ff050>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1055d91c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x105a23020>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1059e7110>
                     └ <openai.AsyncOpenAI object at 0x105c86000>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x105c86000>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x105a23020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x1053d3880>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1053d3920>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1053d39c0>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1053d3920>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1053d39c0>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1053d3920>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x100a423e0>
    │       └ <function run at 0x1010ad3a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x105840f40>
           │      └ <function Runner.run at 0x101129760>
           └ <asyncio.runners.Runner object at 0x104ec66f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10111f240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104ec66f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10111f1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101128fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1010662a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,)}
                     │    │           │    └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x1059e7e30>
                     │    └ <function Dispatcher.feed_update at 0x104e1f6a0>
                     └ <Dispatcher '0x1059e7e90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x104e1e200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x105a210a0>
                     └ <Dispatcher '0x1059e7e90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x105a211c0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x105a21280>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x105a0f600>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x105a0f6a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x1059e7e90'>>, Update(update_id=414369796, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x104e1eca0>
                 └ <Dispatcher '0x1059e7e90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x105a0e480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104e1e200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1059e7ec0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104e1ed40>
                 └ <Dispatcher '0x1059e7e90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x104e1eca0>
                     └ <Router '0x104d9c2c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x105a26700>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104e1e200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10549f230>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104e1ed40>
                 └ <Router '0x104d9c2c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x104e1e340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10549f230>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x105a27380>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x105a0da80>, Message(message_id=744, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'asd'
                     └ <function gpt at 0x104ed0b80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:28:23.473262+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33735), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x1051136a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x105aabc50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x10512c900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x105112ac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x105112b60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x105110c20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x105aab2c0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x10512e520>
                 │    └ <httpcore.AnyIOBackend object at 0x1062fdcd0>
                 └ <httpcore._backends.auto.AutoBackend object at 0x105aab2c0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x104fcdbc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x106258220>
    └ <contextlib._GeneratorContextManager object at 0x1062ff590>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x105139e40>
                     │    └ <httpx.AsyncClient object at 0x105aaa5a0>
                     └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x105139ee0>
                     └ <httpx.AsyncClient object at 0x105aaa5a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x105139f80>
                     └ <httpx.AsyncClient object at 0x105aaa5a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x10513a020>
                     └ <httpx.AsyncClient object at 0x105aaa5a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x10512ef20>
                     └ <httpx.AsyncHTTPTransport object at 0x105aabc50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x104fa4860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x106514940>
    └ <contextlib._GeneratorContextManager object at 0x1062ff050>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1055d91c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x105a23020>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1059e7110>
                     └ <openai.AsyncOpenAI object at 0x105c86000>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x105c86000>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x105a23020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x1053d3880>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1053d3920>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1053d39c0>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1053d3920>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1053d39c0>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1053d3920>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x100a423e0>
    │       └ <function run at 0x1010ad3a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x105840f40>
           │      └ <function Runner.run at 0x101129760>
           └ <asyncio.runners.Runner object at 0x104ec66f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10111f240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104ec66f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10111f1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101128fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1010662a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,)}
                     │    │           │    └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x1059e7e30>
                     │    └ <function Dispatcher.feed_update at 0x104e1f6a0>
                     └ <Dispatcher '0x1059e7e90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x104e1e200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x105a210a0>
                     └ <Dispatcher '0x1059e7e90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x105a211c0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x105a21280>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x105a0f600>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x105a0f6a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x1059e7e90'>>, Update(update_id=414369796, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x104e1eca0>
                 └ <Dispatcher '0x1059e7e90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x105a0e480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104e1e200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1059e7ec0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104e1ed40>
                 └ <Dispatcher '0x1059e7e90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x104e1eca0>
                     └ <Router '0x104d9c2c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x105a26700>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104e1e200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10549f230>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104e1ed40>
                 └ <Router '0x104d9c2c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x104e1e340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10549f230>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x105a27380>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x105a0da80>, Message(message_id=744, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'asd'
                     └ <function gpt at 0x104ed0b80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:28:23.473262+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33735), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x1051136a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x105aabc50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x10512c900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x105112ac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x105112b60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x105110c20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x105aab2c0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x10512e520>
                 │    └ <httpcore.AnyIOBackend object at 0x1062fdcd0>
                 └ <httpcore._backends.auto.AutoBackend object at 0x105aab2c0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x104fcdbc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x106258220>
    └ <contextlib._GeneratorContextManager object at 0x1062ff590>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x105139e40>
                     │    └ <httpx.AsyncClient object at 0x105aaa5a0>
                     └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x105139ee0>
                     └ <httpx.AsyncClient object at 0x105aaa5a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x105139f80>
                     └ <httpx.AsyncClient object at 0x105aaa5a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x10513a020>
                     └ <httpx.AsyncClient object at 0x105aaa5a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x10512ef20>
                     └ <httpx.AsyncHTTPTransport object at 0x105aabc50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x104fa4860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x106514940>
    └ <contextlib._GeneratorContextManager object at 0x1062ff050>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1055d91c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x105a23020>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1059e7110>
                     └ <openai.AsyncOpenAI object at 0x105c86000>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x105c86000>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x105a23020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x1053d3880>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1053d3920>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1053d39c0>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1053d3920>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1053d39c0>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1053d3920>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x100a423e0>
    │       └ <function run at 0x1010ad3a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x105840f40>
           │      └ <function Runner.run at 0x101129760>
           └ <asyncio.runners.Runner object at 0x104ec66f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10111f240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104ec66f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10111f1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101128fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1010662a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,)}
                     │    │           │    └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x1059e7e30>
                     │    └ <function Dispatcher.feed_update at 0x104e1f6a0>
                     └ <Dispatcher '0x1059e7e90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x104e1e200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x105a210a0>
                     └ <Dispatcher '0x1059e7e90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x105a211c0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x105a21280>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x105a0f600>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x105a0f6a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x1059e7e90'>>, Update(update_id=414369796, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x104e1eca0>
                 └ <Dispatcher '0x1059e7e90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x105a0e480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104e1e200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1059e7ec0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104e1ed40>
                 └ <Dispatcher '0x1059e7e90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x104e1eca0>
                     └ <Router '0x104d9c2c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x105a26700>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104e1e200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10549f230>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104e1ed40>
                 └ <Router '0x104d9c2c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x104e1e340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10549f230>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x105a27380>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x105a0da80>, Message(message_id=744, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'asd'
                     └ <function gpt at 0x104ed0b80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:28:23.473262+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33735), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x1051136a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x105aabc50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x10512c900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x105112ac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x105112b60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x105110c20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x105aab2c0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x10512e520>
                 │    └ <httpcore.AnyIOBackend object at 0x1062fdcd0>
                 └ <httpcore._backends.auto.AutoBackend object at 0x105aab2c0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x104fcdbc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x106258220>
    └ <contextlib._GeneratorContextManager object at 0x1062ff590>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x105139e40>
                     │    └ <httpx.AsyncClient object at 0x105aaa5a0>
                     └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x105139ee0>
                     └ <httpx.AsyncClient object at 0x105aaa5a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x105139f80>
                     └ <httpx.AsyncClient object at 0x105aaa5a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x10513a020>
                     └ <httpx.AsyncClient object at 0x105aaa5a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x10512ef20>
                     └ <httpx.AsyncHTTPTransport object at 0x105aabc50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x104fa4860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x106514940>
    └ <contextlib._GeneratorContextManager object at 0x1062ff050>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1055d91c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x105a23020>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1059e7110>
                     └ <openai.AsyncOpenAI object at 0x105c86000>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x105c86000>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x105a23020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x1053d3880>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1053d3920>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1053d39c0>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1053d3920>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x1053d39c0>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1053d3920>
                 └ <openai.AsyncOpenAI object at 0x105c86000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 29, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x100a423e0>
    │       └ <function run at 0x1010ad3a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x105840f40>
           │      └ <function Runner.run at 0x101129760>
           └ <asyncio.runners.Runner object at 0x104ec66f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10111f240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104ec66f0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10111f1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101128fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1010662a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,)}
                     │    │           │    └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x1059e7e30>
                     │    └ <function Dispatcher.feed_update at 0x104e1f6a0>
                     └ <Dispatcher '0x1059e7e90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x104e1e200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x105a210a0>
                     └ <Dispatcher '0x1059e7e90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x105a211c0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x105a21280>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x105a0f600>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369796, message=Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x105a0f6a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x1059e7e90'>>, Update(update_id=414369796, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x104e1eca0>
                 └ <Dispatcher '0x1059e7e90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x105a0e480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104e1e200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1059e7ec0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104e1ed40>
                 └ <Dispatcher '0x1059e7e90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x104e1eca0>
                     └ <Router '0x104d9c2c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x105a26700>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x104e1e200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10549f230>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x104e1ed40>
                 └ <Router '0x104d9c2c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x104e1e340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10549f230>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1059e7e90'>, 'bots': (<aiogram.client.bot.Bot object at 0x1059e7e30>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=744, date=datetime.datetime(2024, 9, 23, 11, 28, 20, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x105a27380>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x105a0da80>, Message(message_id=744, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 87, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'asd'
                     └ <function gpt at 0x104ed0b80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:28:23.533473+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:28:23.533473+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:28:23.533473+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:28:23.533473+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:32:32.671578+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:32:32.671578+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:32:32.671578+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:32:32.671578+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:32:32.671578+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:32:35.262634+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:32:35.262634+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:32:35.262634+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:32:35.262634+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:32:35.262634+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:32:35.264337+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33852), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x106edb740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x107843da0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x106ef49a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x106edab60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x106edac00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x106ed8cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1078900e0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x106ef65c0>
                 │    └ <httpcore.AnyIOBackend object at 0x107f01670>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1078900e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106d95c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x1078f4310>
    └ <contextlib._GeneratorContextManager object at 0x107f03890>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x106f01ee0>
                     │    └ <httpx.AsyncClient object at 0x107843290>
                     └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x106f01f80>
                     └ <httpx.AsyncClient object at 0x107843290>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x106f02020>
                     └ <httpx.AsyncClient object at 0x107843290>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x106f020c0>
                     └ <httpx.AsyncClient object at 0x107843290>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x106ef6fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x107843da0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106d6c900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x107f1cb40>
    └ <contextlib._GeneratorContextManager object at 0x107f034d0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 32, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1073a1260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x107842c30>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x10732bbc0>
                     └ <openai.AsyncOpenAI object at 0x107842ea0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x107842ea0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x107842c30>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10719b920>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10719b9c0>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10719ba60>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10719b9c0>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10719ba60>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10719b9c0>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10280a3e0>
    │       └ <function run at 0x102e753a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x107608f40>
           │      └ <function Runner.run at 0x102ef1760>
           └ <asyncio.runners.Runner object at 0x1071e9160>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x102ee7240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1071e9160>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102ee71a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102ef0fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102e2a2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,)}
                     │    │           │    └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x1077afa70>
                     │    └ <function Dispatcher.feed_update at 0x106be76a0>
                     └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106be6200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1077e8ce0>
                     └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x1077e8e00>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x1077e8ec0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x1077d3ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x1077d3600>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x1070c13a0'>>, Update(update_id=414369800, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106be6ca0>
                 └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1077d2480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106be6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1077af860>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106be6d40>
                 └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106be6ca0>
                     └ <Router '0x106c5ff80'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1077ee480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106be6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10755e000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106be6d40>
                 └ <Router '0x106c5ff80'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106be6340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10755e000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x1077ee8e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x1077d1a80>, Message(message_id=753, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'ПРивет!'
                     └ <function gpt at 0x106c98c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 43, in gpt
    raise Exception

Exception
2024-09-23T14:32:35.264337+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33852), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x106edb740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x107843da0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x106ef49a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x106edab60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x106edac00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x106ed8cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1078900e0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x106ef65c0>
                 │    └ <httpcore.AnyIOBackend object at 0x107f01670>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1078900e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106d95c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x1078f4310>
    └ <contextlib._GeneratorContextManager object at 0x107f03890>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x106f01ee0>
                     │    └ <httpx.AsyncClient object at 0x107843290>
                     └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x106f01f80>
                     └ <httpx.AsyncClient object at 0x107843290>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x106f02020>
                     └ <httpx.AsyncClient object at 0x107843290>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x106f020c0>
                     └ <httpx.AsyncClient object at 0x107843290>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x106ef6fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x107843da0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106d6c900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x107f1cb40>
    └ <contextlib._GeneratorContextManager object at 0x107f034d0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 32, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1073a1260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x107842c30>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x10732bbc0>
                     └ <openai.AsyncOpenAI object at 0x107842ea0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x107842ea0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x107842c30>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10719b920>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10719b9c0>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10719ba60>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10719b9c0>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10719ba60>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10719b9c0>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10280a3e0>
    │       └ <function run at 0x102e753a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x107608f40>
           │      └ <function Runner.run at 0x102ef1760>
           └ <asyncio.runners.Runner object at 0x1071e9160>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x102ee7240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1071e9160>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102ee71a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102ef0fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102e2a2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,)}
                     │    │           │    └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x1077afa70>
                     │    └ <function Dispatcher.feed_update at 0x106be76a0>
                     └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106be6200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1077e8ce0>
                     └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x1077e8e00>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x1077e8ec0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x1077d3ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x1077d3600>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x1070c13a0'>>, Update(update_id=414369800, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106be6ca0>
                 └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1077d2480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106be6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1077af860>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106be6d40>
                 └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106be6ca0>
                     └ <Router '0x106c5ff80'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1077ee480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106be6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10755e000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106be6d40>
                 └ <Router '0x106c5ff80'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106be6340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10755e000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x1077ee8e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x1077d1a80>, Message(message_id=753, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'ПРивет!'
                     └ <function gpt at 0x106c98c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 43, in gpt
    raise Exception

Exception
2024-09-23T14:32:35.264337+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33852), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x106edb740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x107843da0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x106ef49a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x106edab60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x106edac00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x106ed8cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1078900e0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x106ef65c0>
                 │    └ <httpcore.AnyIOBackend object at 0x107f01670>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1078900e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106d95c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x1078f4310>
    └ <contextlib._GeneratorContextManager object at 0x107f03890>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x106f01ee0>
                     │    └ <httpx.AsyncClient object at 0x107843290>
                     └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x106f01f80>
                     └ <httpx.AsyncClient object at 0x107843290>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x106f02020>
                     └ <httpx.AsyncClient object at 0x107843290>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x106f020c0>
                     └ <httpx.AsyncClient object at 0x107843290>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x106ef6fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x107843da0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106d6c900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x107f1cb40>
    └ <contextlib._GeneratorContextManager object at 0x107f034d0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 32, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1073a1260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x107842c30>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x10732bbc0>
                     └ <openai.AsyncOpenAI object at 0x107842ea0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x107842ea0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x107842c30>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10719b920>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10719b9c0>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10719ba60>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10719b9c0>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10719ba60>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10719b9c0>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10280a3e0>
    │       └ <function run at 0x102e753a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x107608f40>
           │      └ <function Runner.run at 0x102ef1760>
           └ <asyncio.runners.Runner object at 0x1071e9160>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x102ee7240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1071e9160>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102ee71a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102ef0fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102e2a2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,)}
                     │    │           │    └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x1077afa70>
                     │    └ <function Dispatcher.feed_update at 0x106be76a0>
                     └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106be6200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1077e8ce0>
                     └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x1077e8e00>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x1077e8ec0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x1077d3ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x1077d3600>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x1070c13a0'>>, Update(update_id=414369800, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106be6ca0>
                 └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1077d2480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106be6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1077af860>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106be6d40>
                 └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106be6ca0>
                     └ <Router '0x106c5ff80'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1077ee480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106be6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10755e000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106be6d40>
                 └ <Router '0x106c5ff80'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106be6340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10755e000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x1077ee8e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x1077d1a80>, Message(message_id=753, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'ПРивет!'
                     └ <function gpt at 0x106c98c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 43, in gpt
    raise Exception

Exception
2024-09-23T14:32:35.264337+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33852), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x106edb740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x107843da0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x106ef49a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x106edab60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x106edac00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x106ed8cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1078900e0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x106ef65c0>
                 │    └ <httpcore.AnyIOBackend object at 0x107f01670>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1078900e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106d95c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x1078f4310>
    └ <contextlib._GeneratorContextManager object at 0x107f03890>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x106f01ee0>
                     │    └ <httpx.AsyncClient object at 0x107843290>
                     └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x106f01f80>
                     └ <httpx.AsyncClient object at 0x107843290>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x106f02020>
                     └ <httpx.AsyncClient object at 0x107843290>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x106f020c0>
                     └ <httpx.AsyncClient object at 0x107843290>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x106ef6fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x107843da0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106d6c900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x107f1cb40>
    └ <contextlib._GeneratorContextManager object at 0x107f034d0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 32, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1073a1260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x107842c30>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x10732bbc0>
                     └ <openai.AsyncOpenAI object at 0x107842ea0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x107842ea0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x107842c30>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10719b920>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10719b9c0>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10719ba60>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10719b9c0>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10719ba60>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10719b9c0>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10280a3e0>
    │       └ <function run at 0x102e753a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x107608f40>
           │      └ <function Runner.run at 0x102ef1760>
           └ <asyncio.runners.Runner object at 0x1071e9160>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x102ee7240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1071e9160>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102ee71a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102ef0fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102e2a2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,)}
                     │    │           │    └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x1077afa70>
                     │    └ <function Dispatcher.feed_update at 0x106be76a0>
                     └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106be6200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1077e8ce0>
                     └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x1077e8e00>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x1077e8ec0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x1077d3ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x1077d3600>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x1070c13a0'>>, Update(update_id=414369800, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106be6ca0>
                 └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1077d2480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106be6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1077af860>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106be6d40>
                 └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106be6ca0>
                     └ <Router '0x106c5ff80'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1077ee480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106be6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10755e000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106be6d40>
                 └ <Router '0x106c5ff80'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106be6340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10755e000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x1077ee8e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x1077d1a80>, Message(message_id=753, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'ПРивет!'
                     └ <function gpt at 0x106c98c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 43, in gpt
    raise Exception

Exception
2024-09-23T14:32:35.264337+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33852), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x106edb740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x107843da0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x106ef49a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x106edab60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x106edac00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x106ed8cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1078900e0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x106ef65c0>
                 │    └ <httpcore.AnyIOBackend object at 0x107f01670>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1078900e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106d95c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x1078f4310>
    └ <contextlib._GeneratorContextManager object at 0x107f03890>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x106f01ee0>
                     │    └ <httpx.AsyncClient object at 0x107843290>
                     └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x106f01f80>
                     └ <httpx.AsyncClient object at 0x107843290>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x106f02020>
                     └ <httpx.AsyncClient object at 0x107843290>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x106f020c0>
                     └ <httpx.AsyncClient object at 0x107843290>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x106ef6fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x107843da0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106d6c900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x107f1cb40>
    └ <contextlib._GeneratorContextManager object at 0x107f034d0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 32, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1073a1260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x107842c30>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x10732bbc0>
                     └ <openai.AsyncOpenAI object at 0x107842ea0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x107842ea0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x107842c30>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10719b920>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10719b9c0>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10719ba60>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10719b9c0>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10719ba60>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10719b9c0>
                 └ <openai.AsyncOpenAI object at 0x107842ea0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10280a3e0>
    │       └ <function run at 0x102e753a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x107608f40>
           │      └ <function Runner.run at 0x102ef1760>
           └ <asyncio.runners.Runner object at 0x1071e9160>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x102ee7240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1071e9160>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102ee71a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102ef0fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102e2a2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,)}
                     │    │           │    └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x1077afa70>
                     │    └ <function Dispatcher.feed_update at 0x106be76a0>
                     └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106be6200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1077e8ce0>
                     └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x1077e8e00>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x1077e8ec0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x1077d3ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369800, message=Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x1077d3600>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x1070c13a0'>>, Update(update_id=414369800, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106be6ca0>
                 └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1077d2480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106be6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1077af860>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106be6d40>
                 └ <Dispatcher '0x1070c13a0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106be6ca0>
                     └ <Router '0x106c5ff80'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x1077ee480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106be6200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10755e000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106be6d40>
                 └ <Router '0x106c5ff80'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106be6340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10755e000>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1070c13a0'>, 'bots': (<aiogram.client.bot.Bot object at 0x1077afa70>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=753, date=datetime.datetime(2024, 9, 23, 11, 32, 32, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x1077ee8e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x1077d1a80>, Message(message_id=753, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'ПРивет!'
                     └ <function gpt at 0x106c98c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 43, in gpt
    raise Exception

Exception
2024-09-23T14:32:35.345187+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:32:35.345187+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:32:35.345187+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:32:35.345187+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:32:35.345187+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:33:18.827817+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:33:18.827817+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:33:18.827817+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:33:18.827817+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:33:21.382192+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:33:21.382192+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:33:21.382192+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:33:21.382192+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:33:21.383310+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33883), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x106c6b740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x107603500>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x106c849a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x106c6ab60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x106c6ac00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x106c68cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1076037a0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x106c865c0>
                 │    └ <httpcore.AnyIOBackend object at 0x107b65640>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1076037a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106b25c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107680040>
    └ <contextlib._GeneratorContextManager object at 0x107b66f60>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x106c91ee0>
                     │    └ <httpx.AsyncClient object at 0x107603380>
                     └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x106c91f80>
                     └ <httpx.AsyncClient object at 0x107603380>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x106c92020>
                     └ <httpx.AsyncClient object at 0x107603380>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x106c920c0>
                     └ <httpx.AsyncClient object at 0x107603380>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x106c86fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x107603500>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106afc900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x107b74d40>
    └ <contextlib._GeneratorContextManager object at 0x107b66b40>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 32, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x107131260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076bd3a0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1076bd400>
                     └ <openai.AsyncOpenAI object at 0x106f7bbc0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x106f7bbc0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076bd3a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x106f2b920>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x106f2b9c0>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x106f2ba60>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x106f2b9c0>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x106f2ba60>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x106f2b9c0>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10259a3e0>
    │       └ <function run at 0x102c053a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x107398f40>
           │      └ <function Runner.run at 0x102c81760>
           └ <asyncio.runners.Runner object at 0x10713c710>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x102c77240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10713c710>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102c771a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102c80fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102bba2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,)}
                     │    │           │    └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x10753fbc0>
                     │    └ <function Dispatcher.feed_update at 0x1069776a0>
                     └ <Dispatcher '0x10753edb0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106976200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107578da0>
                     └ <Dispatcher '0x10753edb0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x107578ec0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x107578f80>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x106561f80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x107563ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10753edb0'>>, Update(update_id=414369803, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106976ca0>
                 └ <Dispatcher '0x10753edb0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10757e7a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106976200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10753fb90>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106976d40>
                 └ <Dispatcher '0x10753edb0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106976ca0>
                     └ <Router '0x106a1e540'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10757e480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106976200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a1e570>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106976d40>
                 └ <Router '0x106a1e540'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106976340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a1e570>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x10757f100>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107561a80>, Message(message_id=760, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'фыв'
                     └ <function gpt at 0x106a28c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 43, in gpt
    raise Exception

Exception
2024-09-23T14:33:21.383310+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33883), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x106c6b740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x107603500>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x106c849a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x106c6ab60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x106c6ac00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x106c68cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1076037a0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x106c865c0>
                 │    └ <httpcore.AnyIOBackend object at 0x107b65640>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1076037a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106b25c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107680040>
    └ <contextlib._GeneratorContextManager object at 0x107b66f60>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x106c91ee0>
                     │    └ <httpx.AsyncClient object at 0x107603380>
                     └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x106c91f80>
                     └ <httpx.AsyncClient object at 0x107603380>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x106c92020>
                     └ <httpx.AsyncClient object at 0x107603380>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x106c920c0>
                     └ <httpx.AsyncClient object at 0x107603380>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x106c86fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x107603500>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106afc900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x107b74d40>
    └ <contextlib._GeneratorContextManager object at 0x107b66b40>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 32, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x107131260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076bd3a0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1076bd400>
                     └ <openai.AsyncOpenAI object at 0x106f7bbc0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x106f7bbc0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076bd3a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x106f2b920>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x106f2b9c0>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x106f2ba60>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x106f2b9c0>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x106f2ba60>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x106f2b9c0>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10259a3e0>
    │       └ <function run at 0x102c053a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x107398f40>
           │      └ <function Runner.run at 0x102c81760>
           └ <asyncio.runners.Runner object at 0x10713c710>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x102c77240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10713c710>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102c771a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102c80fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102bba2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,)}
                     │    │           │    └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x10753fbc0>
                     │    └ <function Dispatcher.feed_update at 0x1069776a0>
                     └ <Dispatcher '0x10753edb0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106976200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107578da0>
                     └ <Dispatcher '0x10753edb0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x107578ec0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x107578f80>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x106561f80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x107563ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10753edb0'>>, Update(update_id=414369803, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106976ca0>
                 └ <Dispatcher '0x10753edb0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10757e7a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106976200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10753fb90>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106976d40>
                 └ <Dispatcher '0x10753edb0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106976ca0>
                     └ <Router '0x106a1e540'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10757e480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106976200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a1e570>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106976d40>
                 └ <Router '0x106a1e540'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106976340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a1e570>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x10757f100>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107561a80>, Message(message_id=760, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'фыв'
                     └ <function gpt at 0x106a28c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 43, in gpt
    raise Exception

Exception
2024-09-23T14:33:21.383310+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33883), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x106c6b740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x107603500>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x106c849a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x106c6ab60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x106c6ac00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x106c68cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1076037a0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x106c865c0>
                 │    └ <httpcore.AnyIOBackend object at 0x107b65640>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1076037a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106b25c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107680040>
    └ <contextlib._GeneratorContextManager object at 0x107b66f60>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x106c91ee0>
                     │    └ <httpx.AsyncClient object at 0x107603380>
                     └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x106c91f80>
                     └ <httpx.AsyncClient object at 0x107603380>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x106c92020>
                     └ <httpx.AsyncClient object at 0x107603380>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x106c920c0>
                     └ <httpx.AsyncClient object at 0x107603380>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x106c86fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x107603500>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106afc900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x107b74d40>
    └ <contextlib._GeneratorContextManager object at 0x107b66b40>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 32, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x107131260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076bd3a0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1076bd400>
                     └ <openai.AsyncOpenAI object at 0x106f7bbc0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x106f7bbc0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076bd3a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x106f2b920>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x106f2b9c0>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x106f2ba60>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x106f2b9c0>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x106f2ba60>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x106f2b9c0>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10259a3e0>
    │       └ <function run at 0x102c053a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x107398f40>
           │      └ <function Runner.run at 0x102c81760>
           └ <asyncio.runners.Runner object at 0x10713c710>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x102c77240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10713c710>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102c771a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102c80fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102bba2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,)}
                     │    │           │    └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x10753fbc0>
                     │    └ <function Dispatcher.feed_update at 0x1069776a0>
                     └ <Dispatcher '0x10753edb0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106976200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107578da0>
                     └ <Dispatcher '0x10753edb0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x107578ec0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x107578f80>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x106561f80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x107563ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10753edb0'>>, Update(update_id=414369803, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106976ca0>
                 └ <Dispatcher '0x10753edb0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10757e7a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106976200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10753fb90>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106976d40>
                 └ <Dispatcher '0x10753edb0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106976ca0>
                     └ <Router '0x106a1e540'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10757e480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106976200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a1e570>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106976d40>
                 └ <Router '0x106a1e540'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106976340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a1e570>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x10757f100>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107561a80>, Message(message_id=760, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'фыв'
                     └ <function gpt at 0x106a28c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 43, in gpt
    raise Exception

Exception
2024-09-23T14:33:21.383310+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (33883), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x106c6b740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x107603500>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x106c849a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x106c6ab60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x106c6ac00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x106c68cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x1076037a0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x106c865c0>
                 │    └ <httpcore.AnyIOBackend object at 0x107b65640>
                 └ <httpcore._backends.auto.AutoBackend object at 0x1076037a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106b25c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107680040>
    └ <contextlib._GeneratorContextManager object at 0x107b66f60>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x106c91ee0>
                     │    └ <httpx.AsyncClient object at 0x107603380>
                     └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x106c91f80>
                     └ <httpx.AsyncClient object at 0x107603380>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x106c92020>
                     └ <httpx.AsyncClient object at 0x107603380>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x106c920c0>
                     └ <httpx.AsyncClient object at 0x107603380>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x106c86fc0>
                     └ <httpx.AsyncHTTPTransport object at 0x107603500>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106afc900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x107b74d40>
    └ <contextlib._GeneratorContextManager object at 0x107b66b40>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 32, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x107131260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076bd3a0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1076bd400>
                     └ <openai.AsyncOpenAI object at 0x106f7bbc0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x106f7bbc0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076bd3a0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x106f2b920>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x106f2b9c0>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x106f2ba60>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x106f2b9c0>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x106f2ba60>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x106f2b9c0>
                 └ <openai.AsyncOpenAI object at 0x106f7bbc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10259a3e0>
    │       └ <function run at 0x102c053a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x107398f40>
           │      └ <function Runner.run at 0x102c81760>
           └ <asyncio.runners.Runner object at 0x10713c710>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x102c77240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10713c710>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102c771a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102c80fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102bba2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,)}
                     │    │           │    └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x10753fbc0>
                     │    └ <function Dispatcher.feed_update at 0x1069776a0>
                     └ <Dispatcher '0x10753edb0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106976200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107578da0>
                     └ <Dispatcher '0x10753edb0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x107578ec0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x107578f80>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x106561f80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369803, message=Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x107563ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x10753edb0'>>, Update(update_id=414369803, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106976ca0>
                 └ <Dispatcher '0x10753edb0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10757e7a0>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106976200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10753fb90>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106976d40>
                 └ <Dispatcher '0x10753edb0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106976ca0>
                     └ <Router '0x106a1e540'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x10757e480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106976200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a1e570>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106976d40>
                 └ <Router '0x106a1e540'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106976340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a1e570>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x10753edb0'>, 'bots': (<aiogram.client.bot.Bot object at 0x10753fbc0>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=760, date=datetime.datetime(2024, 9, 23, 11, 33, 18, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x10757f100>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107561a80>, Message(message_id=760, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'фыв'
                     └ <function gpt at 0x106a28c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 43, in gpt
    raise Exception

Exception
2024-09-23T14:33:21.444329+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:33:21.444329+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:33:21.444329+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:33:21.444329+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:38:11.463570+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:38:11.463570+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:38:11.463570+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:38:11.463570+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:38:11.463570+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:38:14.107831+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:38:14.107831+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:38:14.107831+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:38:14.107831+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:38:14.107831+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:38:14.109662+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (34130), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x107377740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x107cdf920>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x10738c9a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x107376b60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x107376c00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x107374cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x107cdf2c0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x10738e5c0>
                 │    └ <httpcore.AnyIOBackend object at 0x108271a00>
                 └ <httpcore._backends.auto.AutoBackend object at 0x107cdf2c0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x107231c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107e98130>
    └ <contextlib._GeneratorContextManager object at 0x108273560>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x10739dee0>
                     │    └ <httpx.AsyncClient object at 0x107cdfa70>
                     └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x10739df80>
                     └ <httpx.AsyncClient object at 0x107cdfa70>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x10739e020>
                     └ <httpx.AsyncClient object at 0x107cdfa70>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x10739e0c0>
                     └ <httpx.AsyncClient object at 0x107cdfa70>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x10738efc0>
                     └ <httpx.AsyncHTTPTransport object at 0x107cdf920>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x107208900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x108280f40>
    └ <contextlib._GeneratorContextManager object at 0x108272cf0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x10783d260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x107c86cc0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x107cdfc20>
                     └ <openai.AsyncOpenAI object at 0x107dca6f0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x107dca6f0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x107c86cc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x107637920>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1076379c0>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x107637a60>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1076379c0>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x107637a60>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1076379c0>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x102ca63e0>
    │       └ <function run at 0x1033113a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x107aa4f40>
           │      └ <function Runner.run at 0x10338d760>
           └ <asyncio.runners.Runner object at 0x1075a4fb0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x103383240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1075a4fb0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1033831a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x10338cfe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1032c62a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,)}
                     │    │           │    └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x107c4bbf0>
                     │    └ <function Dispatcher.feed_update at 0x1070836a0>
                     └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x107082200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107c84e60>
                     └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x107c84f20>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x107c84fe0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x107c72480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x107c73ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x107c4ba40'>>, Update(update_id=414369806, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x107082ca0>
                 └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107c8a480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x107082200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107c4b740>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x107082d40>
                 └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x107082ca0>
                     └ <Router '0x1075323c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107c8a520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x107082200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107a5ac00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x107082d40>
                 └ <Router '0x1075323c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x107082340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107a5ac00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x107c8b2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107c71a80>, Message(message_id=767, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x107134c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:38:14.109662+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (34130), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x107377740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x107cdf920>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x10738c9a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x107376b60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x107376c00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x107374cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x107cdf2c0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x10738e5c0>
                 │    └ <httpcore.AnyIOBackend object at 0x108271a00>
                 └ <httpcore._backends.auto.AutoBackend object at 0x107cdf2c0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x107231c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107e98130>
    └ <contextlib._GeneratorContextManager object at 0x108273560>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x10739dee0>
                     │    └ <httpx.AsyncClient object at 0x107cdfa70>
                     └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x10739df80>
                     └ <httpx.AsyncClient object at 0x107cdfa70>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x10739e020>
                     └ <httpx.AsyncClient object at 0x107cdfa70>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x10739e0c0>
                     └ <httpx.AsyncClient object at 0x107cdfa70>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x10738efc0>
                     └ <httpx.AsyncHTTPTransport object at 0x107cdf920>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x107208900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x108280f40>
    └ <contextlib._GeneratorContextManager object at 0x108272cf0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x10783d260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x107c86cc0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x107cdfc20>
                     └ <openai.AsyncOpenAI object at 0x107dca6f0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x107dca6f0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x107c86cc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x107637920>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1076379c0>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x107637a60>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1076379c0>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x107637a60>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1076379c0>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x102ca63e0>
    │       └ <function run at 0x1033113a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x107aa4f40>
           │      └ <function Runner.run at 0x10338d760>
           └ <asyncio.runners.Runner object at 0x1075a4fb0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x103383240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1075a4fb0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1033831a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x10338cfe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1032c62a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,)}
                     │    │           │    └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x107c4bbf0>
                     │    └ <function Dispatcher.feed_update at 0x1070836a0>
                     └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x107082200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107c84e60>
                     └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x107c84f20>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x107c84fe0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x107c72480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x107c73ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x107c4ba40'>>, Update(update_id=414369806, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x107082ca0>
                 └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107c8a480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x107082200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107c4b740>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x107082d40>
                 └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x107082ca0>
                     └ <Router '0x1075323c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107c8a520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x107082200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107a5ac00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x107082d40>
                 └ <Router '0x1075323c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x107082340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107a5ac00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x107c8b2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107c71a80>, Message(message_id=767, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x107134c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:38:14.109662+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (34130), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x107377740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x107cdf920>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x10738c9a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x107376b60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x107376c00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x107374cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x107cdf2c0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x10738e5c0>
                 │    └ <httpcore.AnyIOBackend object at 0x108271a00>
                 └ <httpcore._backends.auto.AutoBackend object at 0x107cdf2c0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x107231c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107e98130>
    └ <contextlib._GeneratorContextManager object at 0x108273560>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x10739dee0>
                     │    └ <httpx.AsyncClient object at 0x107cdfa70>
                     └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x10739df80>
                     └ <httpx.AsyncClient object at 0x107cdfa70>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x10739e020>
                     └ <httpx.AsyncClient object at 0x107cdfa70>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x10739e0c0>
                     └ <httpx.AsyncClient object at 0x107cdfa70>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x10738efc0>
                     └ <httpx.AsyncHTTPTransport object at 0x107cdf920>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x107208900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x108280f40>
    └ <contextlib._GeneratorContextManager object at 0x108272cf0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x10783d260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x107c86cc0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x107cdfc20>
                     └ <openai.AsyncOpenAI object at 0x107dca6f0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x107dca6f0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x107c86cc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x107637920>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1076379c0>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x107637a60>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1076379c0>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x107637a60>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1076379c0>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x102ca63e0>
    │       └ <function run at 0x1033113a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x107aa4f40>
           │      └ <function Runner.run at 0x10338d760>
           └ <asyncio.runners.Runner object at 0x1075a4fb0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x103383240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1075a4fb0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1033831a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x10338cfe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1032c62a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,)}
                     │    │           │    └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x107c4bbf0>
                     │    └ <function Dispatcher.feed_update at 0x1070836a0>
                     └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x107082200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107c84e60>
                     └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x107c84f20>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x107c84fe0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x107c72480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x107c73ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x107c4ba40'>>, Update(update_id=414369806, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x107082ca0>
                 └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107c8a480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x107082200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107c4b740>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x107082d40>
                 └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x107082ca0>
                     └ <Router '0x1075323c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107c8a520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x107082200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107a5ac00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x107082d40>
                 └ <Router '0x1075323c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x107082340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107a5ac00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x107c8b2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107c71a80>, Message(message_id=767, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x107134c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:38:14.109662+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (34130), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x107377740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x107cdf920>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x10738c9a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x107376b60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x107376c00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x107374cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x107cdf2c0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x10738e5c0>
                 │    └ <httpcore.AnyIOBackend object at 0x108271a00>
                 └ <httpcore._backends.auto.AutoBackend object at 0x107cdf2c0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x107231c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107e98130>
    └ <contextlib._GeneratorContextManager object at 0x108273560>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x10739dee0>
                     │    └ <httpx.AsyncClient object at 0x107cdfa70>
                     └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x10739df80>
                     └ <httpx.AsyncClient object at 0x107cdfa70>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x10739e020>
                     └ <httpx.AsyncClient object at 0x107cdfa70>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x10739e0c0>
                     └ <httpx.AsyncClient object at 0x107cdfa70>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x10738efc0>
                     └ <httpx.AsyncHTTPTransport object at 0x107cdf920>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x107208900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x108280f40>
    └ <contextlib._GeneratorContextManager object at 0x108272cf0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x10783d260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x107c86cc0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x107cdfc20>
                     └ <openai.AsyncOpenAI object at 0x107dca6f0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x107dca6f0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x107c86cc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x107637920>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1076379c0>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x107637a60>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1076379c0>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x107637a60>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1076379c0>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x102ca63e0>
    │       └ <function run at 0x1033113a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x107aa4f40>
           │      └ <function Runner.run at 0x10338d760>
           └ <asyncio.runners.Runner object at 0x1075a4fb0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x103383240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1075a4fb0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1033831a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x10338cfe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1032c62a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,)}
                     │    │           │    └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x107c4bbf0>
                     │    └ <function Dispatcher.feed_update at 0x1070836a0>
                     └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x107082200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107c84e60>
                     └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x107c84f20>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x107c84fe0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x107c72480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x107c73ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x107c4ba40'>>, Update(update_id=414369806, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x107082ca0>
                 └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107c8a480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x107082200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107c4b740>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x107082d40>
                 └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x107082ca0>
                     └ <Router '0x1075323c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107c8a520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x107082200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107a5ac00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x107082d40>
                 └ <Router '0x1075323c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x107082340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107a5ac00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x107c8b2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107c71a80>, Message(message_id=767, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x107134c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:38:14.109662+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (34130), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x107377740>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x107cdf920>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x10738c9a0>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x107376b60>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x107376c00>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x107374cc0>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x107cdf2c0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x10738e5c0>
                 │    └ <httpcore.AnyIOBackend object at 0x108271a00>
                 └ <httpcore._backends.auto.AutoBackend object at 0x107cdf2c0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x107231c60>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107e98130>
    └ <contextlib._GeneratorContextManager object at 0x108273560>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x10739dee0>
                     │    └ <httpx.AsyncClient object at 0x107cdfa70>
                     └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x10739df80>
                     └ <httpx.AsyncClient object at 0x107cdfa70>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x10739e020>
                     └ <httpx.AsyncClient object at 0x107cdfa70>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x10739e0c0>
                     └ <httpx.AsyncClient object at 0x107cdfa70>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x10738efc0>
                     └ <httpx.AsyncHTTPTransport object at 0x107cdf920>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x107208900>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x108280f40>
    └ <contextlib._GeneratorContextManager object at 0x108272cf0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x10783d260>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x107c86cc0>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x107cdfc20>
                     └ <openai.AsyncOpenAI object at 0x107dca6f0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x107dca6f0>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x107c86cc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x107637920>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1076379c0>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x107637a60>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1076379c0>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x107637a60>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x1076379c0>
                 └ <openai.AsyncOpenAI object at 0x107dca6f0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x102ca63e0>
    │       └ <function run at 0x1033113a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x107aa4f40>
           │      └ <function Runner.run at 0x10338d760>
           └ <asyncio.runners.Runner object at 0x1075a4fb0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x103383240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1075a4fb0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1033831a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x10338cfe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1032c62a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,)}
                     │    │           │    └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x107c4bbf0>
                     │    └ <function Dispatcher.feed_update at 0x1070836a0>
                     └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x107082200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107c84e60>
                     └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x107c84f20>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x107c84fe0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x107c72480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369806, message=Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x107c73ba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x107c4ba40'>>, Update(update_id=414369806, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x107082ca0>
                 └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107c8a480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x107082200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107c4b740>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x107082d40>
                 └ <Dispatcher '0x107c4ba40'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x107082ca0>
                     └ <Router '0x1075323c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107c8a520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x107082200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107a5ac00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x107082d40>
                 └ <Router '0x1075323c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x107082340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107a5ac00>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107c4ba40'>, 'bots': (<aiogram.client.bot.Bot object at 0x107c4bbf0>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=767, date=datetime.datetime(2024, 9, 23, 11, 38, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x107c8b2e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107c71a80>, Message(message_id=767, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x107134c20>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:38:14.176067+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:38:14.176067+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:38:14.176067+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:38:14.176067+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:38:14.176067+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:39:21.221057+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:39:21.221057+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:39:21.221057+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:39:21.221057+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:39:21.221057+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:39:24.762675+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:39:24.762675+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:39:24.762675+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:39:24.762675+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:39:24.762675+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:39:24.764324+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (34674), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x11070b6a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x111092e10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x110720900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x11070aac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x11070ab60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x110708c20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x11125f2c0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x110722520>
                 │    └ <httpcore.AnyIOBackend object at 0x113d05b80>
                 └ <httpcore._backends.auto.AutoBackend object at 0x11125f2c0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x1105c5bc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x113a68130>
    └ <contextlib._GeneratorContextManager object at 0x113d07620>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x110731e40>
                     │    └ <httpx.AsyncClient object at 0x11125f620>
                     └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x110731ee0>
                     └ <httpx.AsyncClient object at 0x11125f620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x110731f80>
                     └ <httpx.AsyncClient object at 0x11125f620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x110732020>
                     └ <httpx.AsyncClient object at 0x11125f620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x110722f20>
                     └ <httpx.AsyncHTTPTransport object at 0x111092e10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x11059c860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x113d14e40>
    └ <contextlib._GeneratorContextManager object at 0x113d07290>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x110dd11c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1111ff020>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x110c599d0>
                     └ <openai.AsyncOpenAI object at 0x113a72a50>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x113a72a50>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1111ff020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x110bcb880>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x110bcb920>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x110bcb9c0>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x110bcb920>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x110bcb9c0>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x110bcb920>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10105e3e0>
    │       └ <function run at 0x1016c93a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1110e0f40>
           │      └ <function Runner.run at 0x101745760>
           └ <asyncio.runners.Runner object at 0x101786f00>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10173b240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x101786f00>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10173b1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101744fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10167e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,)}
                     │    │           │    └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x110c59c70>
                     │    └ <function Dispatcher.feed_update at 0x1104176a0>
                     └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x110416200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1111fd160>
                     └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x110b38140>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x1111fd2e0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x1111ea480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x1111ebba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x1111c75f0'>>, Update(update_id=414369809, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x110416ca0>
                 └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x111206480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x110416200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1111c7dd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x110416d40>
                 └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x110416ca0>
                     └ <Router '0x110d5e9c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x111206520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x110416200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x110beea50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x110416d40>
                 └ <Router '0x110d5e9c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x110416340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x110beea50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x1112072e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x1111e9a80>, Message(message_id=774, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x1104c8b80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:39:24.764324+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (34674), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x11070b6a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x111092e10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x110720900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x11070aac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x11070ab60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x110708c20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x11125f2c0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x110722520>
                 │    └ <httpcore.AnyIOBackend object at 0x113d05b80>
                 └ <httpcore._backends.auto.AutoBackend object at 0x11125f2c0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x1105c5bc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x113a68130>
    └ <contextlib._GeneratorContextManager object at 0x113d07620>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x110731e40>
                     │    └ <httpx.AsyncClient object at 0x11125f620>
                     └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x110731ee0>
                     └ <httpx.AsyncClient object at 0x11125f620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x110731f80>
                     └ <httpx.AsyncClient object at 0x11125f620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x110732020>
                     └ <httpx.AsyncClient object at 0x11125f620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x110722f20>
                     └ <httpx.AsyncHTTPTransport object at 0x111092e10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x11059c860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x113d14e40>
    └ <contextlib._GeneratorContextManager object at 0x113d07290>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x110dd11c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1111ff020>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x110c599d0>
                     └ <openai.AsyncOpenAI object at 0x113a72a50>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x113a72a50>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1111ff020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x110bcb880>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x110bcb920>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x110bcb9c0>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x110bcb920>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x110bcb9c0>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x110bcb920>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10105e3e0>
    │       └ <function run at 0x1016c93a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1110e0f40>
           │      └ <function Runner.run at 0x101745760>
           └ <asyncio.runners.Runner object at 0x101786f00>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10173b240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x101786f00>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10173b1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101744fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10167e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,)}
                     │    │           │    └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x110c59c70>
                     │    └ <function Dispatcher.feed_update at 0x1104176a0>
                     └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x110416200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1111fd160>
                     └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x110b38140>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x1111fd2e0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x1111ea480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x1111ebba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x1111c75f0'>>, Update(update_id=414369809, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x110416ca0>
                 └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x111206480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x110416200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1111c7dd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x110416d40>
                 └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x110416ca0>
                     └ <Router '0x110d5e9c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x111206520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x110416200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x110beea50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x110416d40>
                 └ <Router '0x110d5e9c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x110416340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x110beea50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x1112072e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x1111e9a80>, Message(message_id=774, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x1104c8b80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:39:24.764324+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (34674), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x11070b6a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x111092e10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x110720900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x11070aac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x11070ab60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x110708c20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x11125f2c0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x110722520>
                 │    └ <httpcore.AnyIOBackend object at 0x113d05b80>
                 └ <httpcore._backends.auto.AutoBackend object at 0x11125f2c0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x1105c5bc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x113a68130>
    └ <contextlib._GeneratorContextManager object at 0x113d07620>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x110731e40>
                     │    └ <httpx.AsyncClient object at 0x11125f620>
                     └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x110731ee0>
                     └ <httpx.AsyncClient object at 0x11125f620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x110731f80>
                     └ <httpx.AsyncClient object at 0x11125f620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x110732020>
                     └ <httpx.AsyncClient object at 0x11125f620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x110722f20>
                     └ <httpx.AsyncHTTPTransport object at 0x111092e10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x11059c860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x113d14e40>
    └ <contextlib._GeneratorContextManager object at 0x113d07290>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x110dd11c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1111ff020>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x110c599d0>
                     └ <openai.AsyncOpenAI object at 0x113a72a50>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x113a72a50>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1111ff020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x110bcb880>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x110bcb920>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x110bcb9c0>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x110bcb920>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x110bcb9c0>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x110bcb920>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10105e3e0>
    │       └ <function run at 0x1016c93a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1110e0f40>
           │      └ <function Runner.run at 0x101745760>
           └ <asyncio.runners.Runner object at 0x101786f00>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10173b240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x101786f00>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10173b1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101744fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10167e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,)}
                     │    │           │    └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x110c59c70>
                     │    └ <function Dispatcher.feed_update at 0x1104176a0>
                     └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x110416200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1111fd160>
                     └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x110b38140>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x1111fd2e0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x1111ea480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x1111ebba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x1111c75f0'>>, Update(update_id=414369809, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x110416ca0>
                 └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x111206480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x110416200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1111c7dd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x110416d40>
                 └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x110416ca0>
                     └ <Router '0x110d5e9c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x111206520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x110416200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x110beea50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x110416d40>
                 └ <Router '0x110d5e9c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x110416340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x110beea50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x1112072e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x1111e9a80>, Message(message_id=774, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x1104c8b80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:39:24.764324+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (34674), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x11070b6a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x111092e10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x110720900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x11070aac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x11070ab60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x110708c20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x11125f2c0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x110722520>
                 │    └ <httpcore.AnyIOBackend object at 0x113d05b80>
                 └ <httpcore._backends.auto.AutoBackend object at 0x11125f2c0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x1105c5bc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x113a68130>
    └ <contextlib._GeneratorContextManager object at 0x113d07620>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x110731e40>
                     │    └ <httpx.AsyncClient object at 0x11125f620>
                     └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x110731ee0>
                     └ <httpx.AsyncClient object at 0x11125f620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x110731f80>
                     └ <httpx.AsyncClient object at 0x11125f620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x110732020>
                     └ <httpx.AsyncClient object at 0x11125f620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x110722f20>
                     └ <httpx.AsyncHTTPTransport object at 0x111092e10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x11059c860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x113d14e40>
    └ <contextlib._GeneratorContextManager object at 0x113d07290>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x110dd11c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1111ff020>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x110c599d0>
                     └ <openai.AsyncOpenAI object at 0x113a72a50>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x113a72a50>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1111ff020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x110bcb880>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x110bcb920>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x110bcb9c0>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x110bcb920>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x110bcb9c0>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x110bcb920>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10105e3e0>
    │       └ <function run at 0x1016c93a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1110e0f40>
           │      └ <function Runner.run at 0x101745760>
           └ <asyncio.runners.Runner object at 0x101786f00>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10173b240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x101786f00>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10173b1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101744fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10167e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,)}
                     │    │           │    └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x110c59c70>
                     │    └ <function Dispatcher.feed_update at 0x1104176a0>
                     └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x110416200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1111fd160>
                     └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x110b38140>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x1111fd2e0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x1111ea480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x1111ebba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x1111c75f0'>>, Update(update_id=414369809, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x110416ca0>
                 └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x111206480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x110416200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1111c7dd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x110416d40>
                 └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x110416ca0>
                     └ <Router '0x110d5e9c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x111206520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x110416200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x110beea50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x110416d40>
                 └ <Router '0x110d5e9c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x110416340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x110beea50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x1112072e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x1111e9a80>, Message(message_id=774, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x1104c8b80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:39:24.764324+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (34674), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x11070b6a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x111092e10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x110720900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x11070aac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x11070ab60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x110708c20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x11125f2c0>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x110722520>
                 │    └ <httpcore.AnyIOBackend object at 0x113d05b80>
                 └ <httpcore._backends.auto.AutoBackend object at 0x11125f2c0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x1105c5bc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x113a68130>
    └ <contextlib._GeneratorContextManager object at 0x113d07620>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x110731e40>
                     │    └ <httpx.AsyncClient object at 0x11125f620>
                     └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x110731ee0>
                     └ <httpx.AsyncClient object at 0x11125f620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x110731f80>
                     └ <httpx.AsyncClient object at 0x11125f620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x110732020>
                     └ <httpx.AsyncClient object at 0x11125f620>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x110722f20>
                     └ <httpx.AsyncHTTPTransport object at 0x111092e10>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x11059c860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x113d14e40>
    └ <contextlib._GeneratorContextManager object at 0x113d07290>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x110dd11c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1111ff020>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x110c599d0>
                     └ <openai.AsyncOpenAI object at 0x113a72a50>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x113a72a50>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1111ff020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x110bcb880>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x110bcb920>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x110bcb9c0>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x110bcb920>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x110bcb9c0>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x110bcb920>
                 └ <openai.AsyncOpenAI object at 0x113a72a50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10105e3e0>
    │       └ <function run at 0x1016c93a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x1110e0f40>
           │      └ <function Runner.run at 0x101745760>
           └ <asyncio.runners.Runner object at 0x101786f00>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10173b240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x101786f00>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10173b1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101744fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10167e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,)}
                     │    │           │    └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x110c59c70>
                     │    └ <function Dispatcher.feed_update at 0x1104176a0>
                     └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x110416200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1111fd160>
                     └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x110b38140>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x1111fd2e0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x1111ea480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369809, message=Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x1111ebba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x1111c75f0'>>, Update(update_id=414369809, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x110416ca0>
                 └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x111206480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x110416200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x1111c7dd0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x110416d40>
                 └ <Dispatcher '0x1111c75f0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x110416ca0>
                     └ <Router '0x110d5e9c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x111206520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x110416200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x110beea50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x110416d40>
                 └ <Router '0x110d5e9c0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x110416340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x110beea50>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x1111c75f0'>, 'bots': (<aiogram.client.bot.Bot object at 0x110c59c70>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=774, date=datetime.datetime(2024, 9, 23, 11, 39, 21, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x1112072e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x1111e9a80>, Message(message_id=774, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'Привет!'
                     └ <function gpt at 0x1104c8b80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:39:24.839050+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:39:24.839050+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:39:24.839050+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:39:24.839050+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:39:24.839050+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:42:52.834232+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:42:52.834232+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:42:52.834232+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:42:52.834232+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:42:52.834232+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:42:55.592675+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:42:55.592675+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:42:55.592675+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:42:55.592675+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:42:55.592675+0300  ERROR  Ошибка при обработке запроса: Connection error.
2024-09-23T14:42:55.594397+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (35537), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x106d4f6a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x1076b7890>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x106d68900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x106d4eac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x106d4eb60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x106d4cc20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x10765d550>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x106d6a520>
                 │    └ <httpcore.AnyIOBackend object at 0x107e01b20>
                 └ <httpcore._backends.auto.AutoBackend object at 0x10765d550>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106c09bc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107870040>
    └ <contextlib._GeneratorContextManager object at 0x107e036e0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x106d75e40>
                     │    └ <httpx.AsyncClient object at 0x107223c80>
                     └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x106d75ee0>
                     └ <httpx.AsyncClient object at 0x107223c80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x106d75f80>
                     └ <httpx.AsyncClient object at 0x107223c80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x106d76020>
                     └ <httpx.AsyncClient object at 0x107223c80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x106d6af20>
                     └ <httpx.AsyncHTTPTransport object at 0x1076b7890>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106be0860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x107e10e40>
    └ <contextlib._GeneratorContextManager object at 0x107e032c0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1072151c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076b7950>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1076b7260>
                     └ <openai.AsyncOpenAI object at 0x10705b020>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10705b020>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076b7950>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10700f880>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10700f920>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10700f9c0>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10700f920>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10700f9c0>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10700f920>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10267e3e0>
    │       └ <function run at 0x102ce93a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x10747cf40>
           │      └ <function Runner.run at 0x102d65760>
           └ <asyncio.runners.Runner object at 0x1029c74d0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x102d5b240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1029c74d0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102d5b1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102d64fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102c9e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,)}
                     │    │           │    └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x106f7c2c0>
                     │    └ <function Dispatcher.feed_update at 0x106a5b6a0>
                     └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106a5a200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10765cdd0>
                     └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x10765cef0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x10765cfb0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x10764a480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x10764bba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x107623b90'>>, Update(update_id=414369812, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106a5aca0>
                 └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107662480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106a5a200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107623bc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106a5ad40>
                 └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106a5aca0>
                     └ <Router '0x1063e7fe0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107662520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106a5a200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a8a420>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106a5ad40>
                 └ <Router '0x1063e7fe0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106a5a340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a8a420>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x1076632e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107649a80>, Message(message_id=781, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'привет1'
                     └ <function gpt at 0x106b0cb80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:42:55.594397+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (35537), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x106d4f6a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x1076b7890>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x106d68900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x106d4eac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x106d4eb60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x106d4cc20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x10765d550>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x106d6a520>
                 │    └ <httpcore.AnyIOBackend object at 0x107e01b20>
                 └ <httpcore._backends.auto.AutoBackend object at 0x10765d550>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106c09bc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107870040>
    └ <contextlib._GeneratorContextManager object at 0x107e036e0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x106d75e40>
                     │    └ <httpx.AsyncClient object at 0x107223c80>
                     └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x106d75ee0>
                     └ <httpx.AsyncClient object at 0x107223c80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x106d75f80>
                     └ <httpx.AsyncClient object at 0x107223c80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x106d76020>
                     └ <httpx.AsyncClient object at 0x107223c80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x106d6af20>
                     └ <httpx.AsyncHTTPTransport object at 0x1076b7890>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106be0860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x107e10e40>
    └ <contextlib._GeneratorContextManager object at 0x107e032c0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1072151c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076b7950>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1076b7260>
                     └ <openai.AsyncOpenAI object at 0x10705b020>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10705b020>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076b7950>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10700f880>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10700f920>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10700f9c0>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10700f920>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10700f9c0>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10700f920>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10267e3e0>
    │       └ <function run at 0x102ce93a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x10747cf40>
           │      └ <function Runner.run at 0x102d65760>
           └ <asyncio.runners.Runner object at 0x1029c74d0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x102d5b240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1029c74d0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102d5b1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102d64fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102c9e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,)}
                     │    │           │    └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x106f7c2c0>
                     │    └ <function Dispatcher.feed_update at 0x106a5b6a0>
                     └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106a5a200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10765cdd0>
                     └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x10765cef0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x10765cfb0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x10764a480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x10764bba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x107623b90'>>, Update(update_id=414369812, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106a5aca0>
                 └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107662480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106a5a200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107623bc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106a5ad40>
                 └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106a5aca0>
                     └ <Router '0x1063e7fe0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107662520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106a5a200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a8a420>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106a5ad40>
                 └ <Router '0x1063e7fe0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106a5a340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a8a420>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x1076632e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107649a80>, Message(message_id=781, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'привет1'
                     └ <function gpt at 0x106b0cb80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:42:55.594397+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (35537), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x106d4f6a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x1076b7890>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x106d68900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x106d4eac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x106d4eb60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x106d4cc20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x10765d550>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x106d6a520>
                 │    └ <httpcore.AnyIOBackend object at 0x107e01b20>
                 └ <httpcore._backends.auto.AutoBackend object at 0x10765d550>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106c09bc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107870040>
    └ <contextlib._GeneratorContextManager object at 0x107e036e0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x106d75e40>
                     │    └ <httpx.AsyncClient object at 0x107223c80>
                     └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x106d75ee0>
                     └ <httpx.AsyncClient object at 0x107223c80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x106d75f80>
                     └ <httpx.AsyncClient object at 0x107223c80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x106d76020>
                     └ <httpx.AsyncClient object at 0x107223c80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x106d6af20>
                     └ <httpx.AsyncHTTPTransport object at 0x1076b7890>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106be0860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x107e10e40>
    └ <contextlib._GeneratorContextManager object at 0x107e032c0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1072151c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076b7950>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1076b7260>
                     └ <openai.AsyncOpenAI object at 0x10705b020>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10705b020>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076b7950>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10700f880>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10700f920>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10700f9c0>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10700f920>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10700f9c0>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10700f920>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10267e3e0>
    │       └ <function run at 0x102ce93a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x10747cf40>
           │      └ <function Runner.run at 0x102d65760>
           └ <asyncio.runners.Runner object at 0x1029c74d0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x102d5b240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1029c74d0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102d5b1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102d64fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102c9e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,)}
                     │    │           │    └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x106f7c2c0>
                     │    └ <function Dispatcher.feed_update at 0x106a5b6a0>
                     └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106a5a200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10765cdd0>
                     └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x10765cef0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x10765cfb0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x10764a480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x10764bba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x107623b90'>>, Update(update_id=414369812, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106a5aca0>
                 └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107662480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106a5a200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107623bc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106a5ad40>
                 └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106a5aca0>
                     └ <Router '0x1063e7fe0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107662520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106a5a200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a8a420>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106a5ad40>
                 └ <Router '0x1063e7fe0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106a5a340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a8a420>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x1076632e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107649a80>, Message(message_id=781, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'привет1'
                     └ <function gpt at 0x106b0cb80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:42:55.594397+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (35537), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x106d4f6a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x1076b7890>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x106d68900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x106d4eac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x106d4eb60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x106d4cc20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x10765d550>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x106d6a520>
                 │    └ <httpcore.AnyIOBackend object at 0x107e01b20>
                 └ <httpcore._backends.auto.AutoBackend object at 0x10765d550>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106c09bc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107870040>
    └ <contextlib._GeneratorContextManager object at 0x107e036e0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x106d75e40>
                     │    └ <httpx.AsyncClient object at 0x107223c80>
                     └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x106d75ee0>
                     └ <httpx.AsyncClient object at 0x107223c80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x106d75f80>
                     └ <httpx.AsyncClient object at 0x107223c80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x106d76020>
                     └ <httpx.AsyncClient object at 0x107223c80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x106d6af20>
                     └ <httpx.AsyncHTTPTransport object at 0x1076b7890>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106be0860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x107e10e40>
    └ <contextlib._GeneratorContextManager object at 0x107e032c0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1072151c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076b7950>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1076b7260>
                     └ <openai.AsyncOpenAI object at 0x10705b020>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10705b020>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076b7950>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10700f880>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10700f920>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10700f9c0>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10700f920>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10700f9c0>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10700f920>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10267e3e0>
    │       └ <function run at 0x102ce93a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x10747cf40>
           │      └ <function Runner.run at 0x102d65760>
           └ <asyncio.runners.Runner object at 0x1029c74d0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x102d5b240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1029c74d0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102d5b1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102d64fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102c9e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,)}
                     │    │           │    └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x106f7c2c0>
                     │    └ <function Dispatcher.feed_update at 0x106a5b6a0>
                     └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106a5a200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10765cdd0>
                     └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x10765cef0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x10765cfb0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x10764a480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x10764bba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x107623b90'>>, Update(update_id=414369812, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106a5aca0>
                 └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107662480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106a5a200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107623bc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106a5ad40>
                 └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106a5aca0>
                     └ <Router '0x1063e7fe0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107662520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106a5a200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a8a420>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106a5ad40>
                 └ <Router '0x1063e7fe0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106a5a340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a8a420>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x1076632e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107649a80>, Message(message_id=781, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'привет1'
                     └ <function gpt at 0x106b0cb80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:42:55.594397+0300  ERROR  An error has been caught in function 'process_generation', process 'MainProcess' (35537), thread 'MainThread' (7904336960):
Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 72, in map_httpcore_exceptions
    yield
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
                 │    │     │                    └ <Request [b'POST']>
                 │    │     └ <function AsyncConnectionPool.handle_async_request at 0x106d4f6a0>
                 │    └ <AsyncHTTPProxy [Requests: 0 active, 0 queued | Connections: 0 active, 0 idle]>
                 └ <httpx.AsyncHTTPTransport object at 0x1076b7890>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 216, in handle_async_request
    raise exc from None
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 196, in handle_async_request
    response = await connection.handle_async_request(
                     │          └ <function AsyncTunnelHTTPConnection.handle_async_request at 0x106d68900>
                     └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/http_proxy.py", line 289, in handle_async_request
    connect_response = await self._connection.handle_async_request(
                             │    │           └ <function AsyncHTTPConnection.handle_async_request at 0x106d4eac0>
                             │    └ <AsyncHTTPConnection [CONNECTION FAILED]>
                             └ <AsyncTunnelHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 99, in handle_async_request
    raise exc
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 76, in handle_async_request
    stream = await self._connect(request)
                   │    │        └ <Request [b'CONNECT']>
                   │    └ <function AsyncHTTPConnection._connect at 0x106d4eb60>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_async/connection.py", line 122, in _connect
    stream = await self._network_backend.connect_tcp(**kwargs)
                   │    │                │             └ {'host': '91.199.189.171', 'port': 63004, 'local_address': None, 'timeout': 5.0, 'socket_options': None}
                   │    │                └ <function AutoBackend.connect_tcp at 0x106d4cc20>
                   │    └ <httpcore._backends.auto.AutoBackend object at 0x10765d550>
                   └ <AsyncHTTPConnection [CONNECTION FAILED]>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/auto.py", line 30, in connect_tcp
    return await self._backend.connect_tcp(
                 │    │        └ <function AnyIOBackend.connect_tcp at 0x106d6a520>
                 │    └ <httpcore.AnyIOBackend object at 0x107e01b20>
                 └ <httpcore._backends.auto.AutoBackend object at 0x10765d550>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 114, in connect_tcp
    with map_exceptions(exc_map):
         │              └ {<class 'TimeoutError'>: <class 'httpcore.ConnectTimeout'>, <class 'OSError'>: <class 'httpcore.ConnectError'>, <class 'anyio...
         └ <function map_exceptions at 0x106c09bc0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ OSError('All connection attempts failed')
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_exceptions at 0x107870040>
    └ <contextlib._GeneratorContextManager object at 0x107e036e0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
          └ <class 'httpcore.ConnectError'>

httpcore.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1549, in _request
    response = await self._client.send(
                     │    │       └ <function AsyncClient.send at 0x106d75e40>
                     │    └ <httpx.AsyncClient object at 0x107223c80>
                     └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1674, in send
    response = await self._send_handling_auth(
                     │    └ <function AsyncClient._send_handling_auth at 0x106d75ee0>
                     └ <httpx.AsyncClient object at 0x107223c80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
                     │    └ <function AsyncClient._send_handling_redirects at 0x106d75f80>
                     └ <httpx.AsyncClient object at 0x107223c80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
                     │    │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │    └ <function AsyncClient._send_single_request at 0x106d76020>
                     └ <httpx.AsyncClient object at 0x107223c80>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
                     │         │                    └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
                     │         └ <function AsyncHTTPTransport.handle_async_request at 0x106d6af20>
                     └ <httpx.AsyncHTTPTransport object at 0x1076b7890>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 376, in handle_async_request
    with map_httpcore_exceptions():
         └ <function map_httpcore_exceptions at 0x106be0860>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
    │    │   │     └ ConnectError(OSError('All connection attempts failed'))
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object map_httpcore_exceptions at 0x107e10e40>
    └ <contextlib._GeneratorContextManager object at 0x107e032c0>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/httpx/_transports/default.py", line 89, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
          │          └ 'All connection attempts failed'
          └ <class 'httpx.ConnectError'>

httpx.ConnectError: All connection attempts failed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 27, in gpt
    response = await client.chat.completions.create(
                     │      │    │           └ <function AsyncCompletions.create at 0x1072151c0>
                     │      │    └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076b7950>
                     │      └ <openai.resources.chat.chat.AsyncChat object at 0x1076b7260>
                     └ <openai.AsyncOpenAI object at 0x10705b020>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/resources/chat/completions.py", line 1412, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10705b020>>
                 └ <openai.resources.chat.completions.AsyncCompletions object at 0x1076b7950>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1816, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10700f880>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1510, in request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10700f920>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10700f9c0>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10700f920>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1573, in _request
    return await self._retry_request(
                 │    └ <function AsyncAPIClient._retry_request at 0x10700f9c0>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1643, in _retry_request
    return await self._request(
                 │    └ <function AsyncAPIClient._request at 0x10700f920>
                 └ <openai.AsyncOpenAI object at 0x10705b020>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1583, in _request
    raise APIConnectionError(request=request) from err
          │                          └ <Request('POST', 'https://api.openai.com/v1/chat/completions')>
          └ <class 'openai.APIConnectionError'>

openai.APIConnectionError: Connection error.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/run.py", line 27, in <module>
    asyncio.run(main())
    │       │   └ <function main at 0x10267e3e0>
    │       └ <function run at 0x102ce93a0>
    └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyn...

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object main at 0x10747cf40>
           │      └ <function Runner.run at 0x102d65760>
           └ <asyncio.runners.Runner object at 0x1029c74d0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<main() running at /Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x102d5b240>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1029c74d0>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102d5b1a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102d64fe0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102c9e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.12/3.12.5/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
                     │    │           │    │         └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,)}
                     │    │           │    └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                     │    │           └ <aiogram.client.bot.Bot object at 0x106f7c2c0>
                     │    └ <function Dispatcher.feed_update at 0x106a5b6a0>
                     └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
                     │    │      └ <function TelegramEventObserver.wrap_outer_middleware at 0x106a5a200>
                     │    └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x10765cdd0>
                     └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.dispatcher.middlewares.user_context.UserContextMiddleware object at 0x10765cef0>, functools.partia...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ functools.partial(<aiogram.fsm.middleware.FSMContextMiddleware object at 0x10765cfb0>, <function TelegramEventObserver.trigge...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
                 │       │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │       └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ <function TelegramEventObserver.trigger at 0x10764a480>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │             └ Update(update_id=414369812, message=Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC...
                 └ <function CallableObject.call at 0x10764bba0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<bound method Dispatcher._listen_update of <Dispatcher '0x107623b90'>>, Update(update_id=414369812, message...
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
                 │    │                           │                  │        └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │    │                           │                  └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │    │                           └ 'message'
                 │    └ <function Router.propagate_event at 0x106a5aca0>
                 └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107662480>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106a5a200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x107623bc0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106a5ad40>
                 └ <Dispatcher '0x107623b90'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
                     │      │                           │                  │        └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                     │      │                           │                  └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │      │                           └ 'message'
                     │      └ <function Router.propagate_event at 0x106a5aca0>
                     └ <Router '0x1063e7fe0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
                 │        │                     │               │           └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │        │                     │               └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 │        │                     └ <function Router.propagate_event.<locals>._wrapped at 0x107662520>
                 │        └ <function TelegramEventObserver.wrap_outer_middleware at 0x106a5a200>
                 └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a8a420>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
                 │    └ <function Router._propagate_event at 0x106a5ad40>
                 └ <Router '0x1063e7fe0'>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
                     │        │       │        └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                     │        │       └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                     │        └ <function TelegramEventObserver.trigger at 0x106a5a340>
                     └ <aiogram.dispatcher.event.telegram.TelegramEventObserver object at 0x106a8a420>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
                 │             │      └ {'dispatcher': <Dispatcher '0x107623b90'>, 'bots': (<aiogram.client.bot.Bot object at 0x106f7c2c0>,), 'bot': <aiogram.client....
                 │             └ Message(message_id=781, date=datetime.datetime(2024, 9, 23, 11, 42, 52, tzinfo=TzInfo(UTC)), chat=Chat(id=857805093, type='pr...
                 └ <function CallableObject.call at 0x1076632e0>
  File "/Users/aleksandrvolzanin/Library/Caches/pypoetry/virtualenvs/chat-gpt--89fevAe-py3.12/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
                 └ functools.partial(<function process_generation at 0x107649a80>, Message(message_id=781, date=datetime.datetime(2024, 9, 23, 1...

> File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/handlers.py", line 86, in process_generation
    response = await gpt(user_input, model)
                     │   │           └ 'gpt-4o-mini'
                     │   └ 'привет1'
                     └ <function gpt at 0x106b0cb80>

  File "/Users/aleksandrvolzanin/pet_project/chat_gpt/app/generators.py", line 38, in gpt
    raise Exception

Exception
2024-09-23T14:42:55.669224+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:42:55.669224+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:42:55.669224+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:42:55.669224+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:42:55.669224+0300  ERROR  Ошибка при отправке сообщения: can only concatenate str (not "NoneType") to str
2024-09-23T14:48:25.649568+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:48:25.649568+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:48:25.649568+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:48:25.649568+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:48:25.649568+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:48:26.610193+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:48:26.610193+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:48:26.610193+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:48:26.610193+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:48:26.610193+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:48:27.105614+0300  INFO  Ответ gpt получен
2024-09-23T14:48:27.105614+0300  INFO  Ответ gpt получен
2024-09-23T14:48:27.105614+0300  INFO  Ответ gpt получен
2024-09-23T14:48:27.105614+0300  INFO  Ответ gpt получен
2024-09-23T14:48:27.105614+0300  INFO  Ответ gpt получен
2024-09-23T14:48:52.792573+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:48:52.792573+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:48:52.792573+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:48:52.792573+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:48:52.792573+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:48:52.792573+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:48:52.792573+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:48:52.792573+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:48:54.160183+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:48:54.160183+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:48:54.160183+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:48:54.160183+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:48:54.160183+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:48:54.160183+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:48:54.160183+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:48:54.160183+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:48:54.277690+0300  INFO  Ответ gpt получен
2024-09-23T14:48:54.277690+0300  INFO  Ответ gpt получен
2024-09-23T14:48:54.277690+0300  INFO  Ответ gpt получен
2024-09-23T14:48:54.277690+0300  INFO  Ответ gpt получен
2024-09-23T14:48:54.277690+0300  INFO  Ответ gpt получен
2024-09-23T14:48:54.277690+0300  INFO  Ответ gpt получен
2024-09-23T14:48:54.277690+0300  INFO  Ответ gpt получен
2024-09-23T14:48:54.277690+0300  INFO  Ответ gpt получен
2024-09-23T14:49:23.695117+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:49:23.695117+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:49:23.695117+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:49:23.695117+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:49:23.695117+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:49:25.083468+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:49:25.083468+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:49:25.083468+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:49:25.083468+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:49:25.083468+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:49:25.497749+0300  INFO  Ответ gpt получен
2024-09-23T14:49:25.497749+0300  INFO  Ответ gpt получен
2024-09-23T14:49:25.497749+0300  INFO  Ответ gpt получен
2024-09-23T14:49:25.497749+0300  INFO  Ответ gpt получен
2024-09-23T14:49:25.497749+0300  INFO  Ответ gpt получен
2024-09-23T14:50:19.683144+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:50:19.683144+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:50:19.683144+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:50:19.683144+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:50:19.683144+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:50:20.953576+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:50:20.953576+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:50:20.953576+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:50:20.953576+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:50:20.953576+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:50:21.310972+0300  INFO  Ответ gpt получен
2024-09-23T14:50:21.310972+0300  INFO  Ответ gpt получен
2024-09-23T14:50:21.310972+0300  INFO  Ответ gpt получен
2024-09-23T14:50:21.310972+0300  INFO  Ответ gpt получен
2024-09-23T14:50:21.310972+0300  INFO  Ответ gpt получен
2024-09-23T14:51:33.519990+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:51:33.519990+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:51:33.519990+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:51:33.519990+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:51:33.519990+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:51:34.396409+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:51:34.396409+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:51:34.396409+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:51:34.396409+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:51:34.396409+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:51:34.738415+0300  INFO  Ответ gpt получен
2024-09-23T14:51:34.738415+0300  INFO  Ответ gpt получен
2024-09-23T14:51:34.738415+0300  INFO  Ответ gpt получен
2024-09-23T14:51:34.738415+0300  INFO  Ответ gpt получен
2024-09-23T14:51:34.738415+0300  INFO  Ответ gpt получен
2024-09-23T14:53:27.361867+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:27.361867+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:27.361867+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:27.361867+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:27.361867+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:29.291678+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:29.291678+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:29.291678+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:29.291678+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:29.291678+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:29.647203+0300  INFO  Ответ gpt получен
2024-09-23T14:53:29.647203+0300  INFO  Ответ gpt получен
2024-09-23T14:53:29.647203+0300  INFO  Ответ gpt получен
2024-09-23T14:53:29.647203+0300  INFO  Ответ gpt получен
2024-09-23T14:53:29.647203+0300  INFO  Ответ gpt получен
2024-09-23T14:53:29.796135+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:29.796135+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:29.796135+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:29.796135+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:29.796135+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:29.796135+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:30.943122+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:30.943122+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:30.943122+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:30.943122+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:30.943122+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:30.943122+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:31.085369+0300  INFO  Ответ gpt получен
2024-09-23T14:53:31.085369+0300  INFO  Ответ gpt получен
2024-09-23T14:53:31.085369+0300  INFO  Ответ gpt получен
2024-09-23T14:53:31.085369+0300  INFO  Ответ gpt получен
2024-09-23T14:53:31.085369+0300  INFO  Ответ gpt получен
2024-09-23T14:53:31.085369+0300  INFO  Ответ gpt получен
2024-09-23T14:53:31.279112+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:31.279112+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:31.279112+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:31.279112+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:31.279112+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:31.279112+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:31.279112+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:32.350385+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:32.350385+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:32.350385+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:32.350385+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:32.350385+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:32.350385+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:32.350385+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T14:53:32.507951+0300  INFO  Ответ gpt получен
2024-09-23T14:53:32.507951+0300  INFO  Ответ gpt получен
2024-09-23T14:53:32.507951+0300  INFO  Ответ gpt получен
2024-09-23T14:53:32.507951+0300  INFO  Ответ gpt получен
2024-09-23T14:53:32.507951+0300  INFO  Ответ gpt получен
2024-09-23T14:53:32.507951+0300  INFO  Ответ gpt получен
2024-09-23T14:53:32.507951+0300  INFO  Ответ gpt получен
2024-09-23T14:53:32.650188+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:32.650188+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:32.650188+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:32.650188+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:32.650188+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:32.650188+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:32.650188+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:53:32.650188+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:55:18.023871+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:55:18.023871+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:55:18.023871+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:55:18.023871+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:55:18.023871+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:55:48.150371+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T14:55:48.150371+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T14:55:48.150371+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T14:55:48.150371+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T14:55:48.150371+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T14:55:48.774063+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: message is too long
2024-09-23T14:55:48.774063+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: message is too long
2024-09-23T14:55:48.774063+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: message is too long
2024-09-23T14:55:48.774063+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: message is too long
2024-09-23T14:55:48.774063+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: message is too long
2024-09-23T14:59:54.760686+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:59:54.760686+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:59:54.760686+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:59:54.760686+0300  INFO  API_OPEN_AI обработан
2024-09-23T14:59:54.760686+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:00:34.109587+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:00:34.109587+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:00:34.109587+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:00:34.109587+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:00:34.109587+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:00:34.626500+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 520
2024-09-23T15:00:34.626500+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 520
2024-09-23T15:00:34.626500+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 520
2024-09-23T15:00:34.626500+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 520
2024-09-23T15:00:34.626500+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 520
2024-09-23T15:02:07.851666+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:02:07.851666+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:02:07.851666+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:02:07.851666+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:02:07.851666+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:02:25.974424+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:02:25.974424+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:02:25.974424+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:02:25.974424+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:02:25.974424+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:02:26.577067+0300  INFO  Ответ gpt получен
2024-09-23T15:02:26.577067+0300  INFO  Ответ gpt получен
2024-09-23T15:02:26.577067+0300  INFO  Ответ gpt получен
2024-09-23T15:02:26.577067+0300  INFO  Ответ gpt получен
2024-09-23T15:02:26.577067+0300  INFO  Ответ gpt получен
2024-09-23T15:23:52.621679+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:23:52.621679+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:23:52.621679+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:23:52.621679+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:23:52.621679+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:24:33.908369+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:24:33.908369+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:24:33.908369+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:24:33.908369+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:24:33.908369+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:24:34.390560+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 496
2024-09-23T15:24:34.390560+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 496
2024-09-23T15:24:34.390560+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 496
2024-09-23T15:24:34.390560+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 496
2024-09-23T15:24:34.390560+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 496
2024-09-23T15:25:53.038239+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:25:53.038239+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:25:53.038239+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:25:53.038239+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:25:53.038239+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:25:53.038239+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:25:53.038239+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:25:53.038239+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:25:53.038239+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:26:02.054108+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:26:02.054108+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:26:02.054108+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:26:02.054108+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:26:02.054108+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:26:02.054108+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:26:02.054108+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:26:02.054108+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:26:02.054108+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:26:02.260681+0300  INFO  Ответ gpt получен
2024-09-23T15:26:02.260681+0300  INFO  Ответ gpt получен
2024-09-23T15:26:02.260681+0300  INFO  Ответ gpt получен
2024-09-23T15:26:02.260681+0300  INFO  Ответ gpt получен
2024-09-23T15:26:02.260681+0300  INFO  Ответ gpt получен
2024-09-23T15:26:02.260681+0300  INFO  Ответ gpt получен
2024-09-23T15:26:02.260681+0300  INFO  Ответ gpt получен
2024-09-23T15:26:02.260681+0300  INFO  Ответ gpt получен
2024-09-23T15:26:02.260681+0300  INFO  Ответ gpt получен
2024-09-23T15:30:31.630979+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:30:31.630979+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:30:31.630979+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:30:31.630979+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:30:31.630979+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:30:32.827756+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:30:32.827756+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:30:32.827756+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:30:32.827756+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:30:32.827756+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:30:33.167264+0300  INFO  Ответ gpt получен
2024-09-23T15:30:33.167264+0300  INFO  Ответ gpt получен
2024-09-23T15:30:33.167264+0300  INFO  Ответ gpt получен
2024-09-23T15:30:33.167264+0300  INFO  Ответ gpt получен
2024-09-23T15:30:33.167264+0300  INFO  Ответ gpt получен
2024-09-23T15:30:54.784241+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:30:54.784241+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:30:54.784241+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:30:54.784241+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:30:54.784241+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:30:54.784241+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:30:54.784241+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:30:54.784241+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:30:54.784241+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:31:39.456364+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:31:39.456364+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:31:39.456364+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:31:39.456364+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:31:39.456364+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:31:39.456364+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:31:39.456364+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:31:39.456364+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:31:39.456364+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:31:39.463414+0300  ERROR  Ошибка при отправке сообщения: name 're' is not defined
2024-09-23T15:31:39.463414+0300  ERROR  Ошибка при отправке сообщения: name 're' is not defined
2024-09-23T15:31:39.463414+0300  ERROR  Ошибка при отправке сообщения: name 're' is not defined
2024-09-23T15:31:39.463414+0300  ERROR  Ошибка при отправке сообщения: name 're' is not defined
2024-09-23T15:31:39.463414+0300  ERROR  Ошибка при отправке сообщения: name 're' is not defined
2024-09-23T15:31:39.463414+0300  ERROR  Ошибка при отправке сообщения: name 're' is not defined
2024-09-23T15:31:39.463414+0300  ERROR  Ошибка при отправке сообщения: name 're' is not defined
2024-09-23T15:31:39.463414+0300  ERROR  Ошибка при отправке сообщения: name 're' is not defined
2024-09-23T15:31:39.463414+0300  ERROR  Ошибка при отправке сообщения: name 're' is not defined
2024-09-23T15:32:08.736978+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:32:08.736978+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:32:08.736978+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:32:08.736978+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:32:08.736978+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:32:50.448858+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:32:50.448858+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:32:50.448858+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:32:50.448858+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:32:50.448858+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:32:51.202710+0300  INFO  Ответ gpt получен
2024-09-23T15:32:51.202710+0300  INFO  Ответ gpt получен
2024-09-23T15:32:51.202710+0300  INFO  Ответ gpt получен
2024-09-23T15:32:51.202710+0300  INFO  Ответ gpt получен
2024-09-23T15:32:51.202710+0300  INFO  Ответ gpt получен
2024-09-23T15:37:00.391462+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:37:00.391462+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:37:00.391462+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:37:00.391462+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:37:00.391462+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:37:01.939808+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:37:01.939808+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:37:01.939808+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:37:01.939808+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:37:01.939808+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:37:02.294576+0300  INFO  Ответ gpt получен
2024-09-23T15:37:02.294576+0300  INFO  Ответ gpt получен
2024-09-23T15:37:02.294576+0300  INFO  Ответ gpt получен
2024-09-23T15:37:02.294576+0300  INFO  Ответ gpt получен
2024-09-23T15:37:02.294576+0300  INFO  Ответ gpt получен
2024-09-23T15:37:17.943922+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:37:17.943922+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:37:17.943922+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:37:17.943922+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:37:17.943922+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:37:17.943922+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:37:17.943922+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:37:17.943922+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:37:17.943922+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:38:27.092747+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:38:27.092747+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:38:27.092747+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:38:27.092747+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:38:27.092747+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:38:27.092747+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:38:27.092747+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:38:27.092747+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:38:27.092747+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:38:29.278965+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 482
2024-09-23T15:38:29.278965+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 482
2024-09-23T15:38:29.278965+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 482
2024-09-23T15:38:29.278965+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 482
2024-09-23T15:38:29.278965+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 482
2024-09-23T15:38:29.278965+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 482
2024-09-23T15:38:29.278965+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 482
2024-09-23T15:38:29.278965+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 482
2024-09-23T15:38:29.278965+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 482
2024-09-23T15:39:03.381336+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:39:03.381336+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:39:03.381336+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:39:03.381336+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:39:03.381336+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:39:45.992418+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:39:45.992418+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:39:45.992418+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:39:45.992418+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:39:45.992418+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:39:46.755880+0300  INFO  Ответ gpt получен
2024-09-23T15:39:46.755880+0300  INFO  Ответ gpt получен
2024-09-23T15:39:46.755880+0300  INFO  Ответ gpt получен
2024-09-23T15:39:46.755880+0300  INFO  Ответ gpt получен
2024-09-23T15:39:46.755880+0300  INFO  Ответ gpt получен
2024-09-23T15:40:23.889527+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:40:23.889527+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:40:23.889527+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:40:23.889527+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:40:23.889527+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:40:23.889527+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:40:23.889527+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:40:23.889527+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:40:23.889527+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:40:36.672070+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:40:36.672070+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:40:36.672070+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:40:36.672070+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:40:36.672070+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:40:36.672070+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:40:36.672070+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:40:36.672070+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:40:36.672070+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:40:36.778574+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 838
2024-09-23T15:40:36.778574+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 838
2024-09-23T15:40:36.778574+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 838
2024-09-23T15:40:36.778574+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 838
2024-09-23T15:40:36.778574+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 838
2024-09-23T15:40:36.778574+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 838
2024-09-23T15:40:36.778574+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 838
2024-09-23T15:40:36.778574+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 838
2024-09-23T15:40:36.778574+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 838
2024-09-23T15:41:02.268733+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:41:02.268733+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:41:02.268733+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:41:02.268733+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:41:02.268733+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:41:09.248892+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:41:09.248892+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:41:09.248892+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:41:09.248892+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:41:09.248892+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:41:09.571557+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 3008
2024-09-23T15:41:09.571557+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 3008
2024-09-23T15:41:09.571557+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 3008
2024-09-23T15:41:09.571557+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 3008
2024-09-23T15:41:09.571557+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 3008
2024-09-23T15:42:38.346858+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:42:38.346858+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:42:38.346858+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:42:38.346858+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:42:38.346858+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:42:39.871134+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:42:39.871134+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:42:39.871134+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:42:39.871134+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:42:39.871134+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:42:40.193481+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Character '-' is reserved and must be escaped with the preceding '\'
2024-09-23T15:42:40.193481+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Character '-' is reserved and must be escaped with the preceding '\'
2024-09-23T15:42:40.193481+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Character '-' is reserved and must be escaped with the preceding '\'
2024-09-23T15:42:40.193481+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Character '-' is reserved and must be escaped with the preceding '\'
2024-09-23T15:42:40.193481+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Character '-' is reserved and must be escaped with the preceding '\'
2024-09-23T15:45:33.678930+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:45:33.678930+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:45:33.678930+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:45:33.678930+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:45:33.678930+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:45:34.979100+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:45:34.979100+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:45:34.979100+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:45:34.979100+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:45:34.979100+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:45:35.404011+0300  INFO  Ответ gpt получен
2024-09-23T15:45:35.404011+0300  INFO  Ответ gpt получен
2024-09-23T15:45:35.404011+0300  INFO  Ответ gpt получен
2024-09-23T15:45:35.404011+0300  INFO  Ответ gpt получен
2024-09-23T15:45:35.404011+0300  INFO  Ответ gpt получен
2024-09-23T15:47:13.581545+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:47:13.581545+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:47:13.581545+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:47:13.581545+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:47:13.581545+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:47:14.686683+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:47:14.686683+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:47:14.686683+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:47:14.686683+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:47:14.686683+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:47:15.031412+0300  INFO  Ответ gpt получен
2024-09-23T15:47:15.031412+0300  INFO  Ответ gpt получен
2024-09-23T15:47:15.031412+0300  INFO  Ответ gpt получен
2024-09-23T15:47:15.031412+0300  INFO  Ответ gpt получен
2024-09-23T15:47:15.031412+0300  INFO  Ответ gpt получен
2024-09-23T15:47:17.620913+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:47:17.620913+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:47:17.620913+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:47:17.620913+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:47:17.620913+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:47:17.620913+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:47:17.620913+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:47:18.797488+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:47:18.797488+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:47:18.797488+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:47:18.797488+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:47:18.797488+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:47:18.797488+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:47:18.797488+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:47:18.934783+0300  INFO  Ответ gpt получен
2024-09-23T15:47:18.934783+0300  INFO  Ответ gpt получен
2024-09-23T15:47:18.934783+0300  INFO  Ответ gpt получен
2024-09-23T15:47:18.934783+0300  INFO  Ответ gpt получен
2024-09-23T15:47:18.934783+0300  INFO  Ответ gpt получен
2024-09-23T15:47:18.934783+0300  INFO  Ответ gpt получен
2024-09-23T15:47:18.934783+0300  INFO  Ответ gpt получен
2024-09-23T15:50:36.581660+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:50:36.581660+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:50:36.581660+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:50:36.581660+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:50:36.581660+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:50:38.878846+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:50:38.878846+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:50:38.878846+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:50:38.878846+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:50:38.878846+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:50:39.759062+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:50:39.759062+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:50:39.759062+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:50:39.759062+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:50:39.759062+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:50:42.297827+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:50:42.297827+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:50:42.297827+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:50:42.297827+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:50:42.297827+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:50:42.297827+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:50:42.297827+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:50:43.393703+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:50:43.393703+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:50:43.393703+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:50:43.393703+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:50:43.393703+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:50:43.393703+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:50:43.393703+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T15:50:43.527509+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:50:43.527509+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:50:43.527509+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:50:43.527509+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:50:43.527509+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:50:43.527509+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:50:43.527509+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:51:20.835391+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:51:20.835391+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:51:20.835391+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:51:20.835391+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:51:20.835391+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:51:20.835391+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:51:20.835391+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:51:20.835391+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:51:20.835391+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:51:20.835391+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:51:20.835391+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:51:21.811076+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:51:21.811076+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:51:21.811076+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:51:21.811076+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:51:21.811076+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:51:21.811076+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:51:21.811076+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:51:21.811076+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:51:21.811076+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:51:21.811076+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:51:21.811076+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:51:22.023390+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:51:22.023390+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:51:22.023390+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:51:22.023390+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:51:22.023390+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:51:22.023390+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:51:22.023390+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:51:22.023390+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:51:22.023390+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:51:22.023390+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:51:22.023390+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:53:57.522172+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:53:57.522172+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:53:57.522172+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:53:57.522172+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:53:57.522172+0300  INFO  API_OPEN_AI обработан
2024-09-23T15:53:58.783176+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:53:58.783176+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:53:58.783176+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:53:58.783176+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:53:58.783176+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T15:53:59.211169+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:53:59.211169+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:53:59.211169+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:53:59.211169+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T15:53:59.211169+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:58:57.946878+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:58:57.946878+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:58:57.946878+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:58:57.946878+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:58:57.946878+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:58:59.199658+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:58:59.199658+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:58:59.199658+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:58:59.199658+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:58:59.199658+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:58:59.606258+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:58:59.606258+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:58:59.606258+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:58:59.606258+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:58:59.606258+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:02.861852+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:02.861852+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:02.861852+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:02.861852+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:02.861852+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:02.861852+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:02.861852+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:03.799491+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:03.799491+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:03.799491+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:03.799491+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:03.799491+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:03.799491+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:03.799491+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:03.927517+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:03.927517+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:03.927517+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:03.927517+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:03.927517+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:03.927517+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:03.927517+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:04.252002+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:04.252002+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:04.252002+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:04.252002+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:04.252002+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:04.252002+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:04.252002+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:04.252002+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:04.252002+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:05.948691+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:05.948691+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:05.948691+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:05.948691+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:05.948691+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:05.948691+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:05.948691+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:05.948691+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:05.948691+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:06.158531+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:06.158531+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:06.158531+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:06.158531+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:06.158531+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:06.158531+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:06.158531+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:06.158531+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:06.158531+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:15.568088+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:15.568088+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:15.568088+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:15.568088+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:15.568088+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:15.568088+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:15.568088+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:15.568088+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:15.568088+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:15.568088+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:15.568088+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:16.535557+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:16.535557+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:16.535557+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:16.535557+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:16.535557+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:16.535557+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:16.535557+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:16.535557+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:16.535557+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:16.535557+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:16.535557+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:16.535557+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:16.535557+0300  INFO  API_OPEN_AI обработан
2024-09-23T16:59:17.620832+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:17.620832+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:17.620832+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:17.620832+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:17.620832+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:17.620832+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:17.620832+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:17.620832+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:17.620832+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:17.620832+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:17.620832+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:17.620832+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:17.620832+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:17.795657+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:17.795657+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:17.795657+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:17.795657+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:17.795657+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:17.795657+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:17.795657+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:17.795657+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:17.795657+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:17.795657+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:17.795657+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:17.795657+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:17.795657+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:25.317099+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:25.317099+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:25.317099+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:25.317099+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:25.317099+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:25.317099+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:25.317099+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:25.317099+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:25.317099+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:25.317099+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:25.317099+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:25.317099+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:25.317099+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T16:59:25.498102+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:25.498102+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:25.498102+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:25.498102+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:25.498102+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:25.498102+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:25.498102+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:25.498102+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:25.498102+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:25.498102+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:25.498102+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:25.498102+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T16:59:25.498102+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:01:02.216209+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:01:02.216209+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:01:02.216209+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:01:02.216209+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:01:02.216209+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:01:02.216209+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:01:02.216209+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:01:02.216209+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:01:02.216209+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:01:02.216209+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:01:02.216209+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:01:02.216209+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:01:02.216209+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:01:02.216209+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:01:02.216209+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:01:19.591280+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:01:19.591280+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:01:19.591280+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:01:19.591280+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:01:19.591280+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:01:19.591280+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:01:19.591280+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:01:19.591280+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:01:19.591280+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:01:19.591280+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:01:19.591280+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:01:19.591280+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:01:19.591280+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:01:19.591280+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:01:19.591280+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:01:20.575966+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:01:20.575966+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:01:20.575966+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:01:20.575966+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:01:20.575966+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:01:20.575966+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:01:20.575966+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:01:20.575966+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:01:20.575966+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:01:20.575966+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:01:20.575966+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:01:20.575966+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:01:20.575966+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:01:20.575966+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:01:20.575966+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:04:07.927055+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:04:07.927055+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:04:07.927055+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:04:07.927055+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:04:07.927055+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:04:07.927055+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:04:07.927055+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:04:13.464734+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T17:04:13.464734+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T17:04:13.464734+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T17:04:13.464734+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T17:04:13.464734+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T17:04:13.464734+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T17:04:13.464734+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T17:04:13.841444+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:04:13.841444+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:04:13.841444+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:04:13.841444+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:04:13.841444+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:04:13.841444+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:04:13.841444+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:07:59.516377+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:07:59.516377+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:07:59.516377+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:07:59.516377+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:07:59.516377+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:08:00.491694+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T17:08:00.491694+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T17:08:00.491694+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T17:08:00.491694+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T17:08:00.491694+0300  INFO  Ответ GPT gpt-4o-mini получен
2024-09-23T17:08:00.877592+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:08:00.877592+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:08:00.877592+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:08:00.877592+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:08:00.877592+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:09:06.957907+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:09:06.957907+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:09:06.957907+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:09:06.957907+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:09:06.957907+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:09:06.957907+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:09:06.957907+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:09:06.957907+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:09:06.957907+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:09:15.551061+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:09:15.551061+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:09:15.551061+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:09:15.551061+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:09:15.551061+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:09:15.551061+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:09:15.551061+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:09:15.551061+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:09:15.551061+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:09:15.734068+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:09:15.734068+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:09:15.734068+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:09:15.734068+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:09:15.734068+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:09:15.734068+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:09:15.734068+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:09:15.734068+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:09:15.734068+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:11:26.165578+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:11:26.165578+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:11:26.165578+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:11:26.165578+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:11:26.165578+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:11:27.545201+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:11:27.545201+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:11:27.545201+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:11:27.545201+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:11:27.545201+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:11:27.903934+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:11:27.903934+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:11:27.903934+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:11:27.903934+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:11:27.903934+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:18:07.349277+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:18:07.349277+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:18:07.349277+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:18:07.349277+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:18:07.349277+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:18:07.349277+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:18:07.349277+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:18:07.349277+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:18:07.349277+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:18:20.497027+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:18:20.497027+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:18:20.497027+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:18:20.497027+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:18:20.497027+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:18:20.497027+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:18:20.497027+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:18:20.497027+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:18:20.497027+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:18:20.700704+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:18:20.700704+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:18:20.700704+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:18:20.700704+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:18:20.700704+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:18:20.700704+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:18:20.700704+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:18:20.700704+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:18:20.700704+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:19:11.982985+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:19:11.982985+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:19:11.982985+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:19:11.982985+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:19:11.982985+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:19:11.982985+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:19:11.982985+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:19:11.982985+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:19:11.982985+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:19:11.982985+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:19:11.982985+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:20:02.049236+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:20:02.049236+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:20:02.049236+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:20:02.049236+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:20:02.049236+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:20:02.049236+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:20:02.049236+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:20:02.049236+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:20:02.049236+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:20:02.049236+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:20:02.049236+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:20:02.337318+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:20:02.337318+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:20:02.337318+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:20:02.337318+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:20:02.337318+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:20:02.337318+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:20:02.337318+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:20:02.337318+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:20:02.337318+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:20:02.337318+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:20:02.337318+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:22:06.239361+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:22:06.239361+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:22:06.239361+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:22:06.239361+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:22:19.381117+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:22:19.381117+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:22:19.381117+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:22:19.381117+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:22:19.821973+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:22:19.821973+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:22:19.821973+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:22:19.821973+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:28:28.429154+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:28:28.429154+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:28:28.429154+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:28:28.429154+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:28:39.993605+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:28:39.993605+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:28:39.993605+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:28:39.993605+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:28:40.313957+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: message is too long
2024-09-23T17:28:40.313957+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: message is too long
2024-09-23T17:28:40.313957+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: message is too long
2024-09-23T17:28:40.313957+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: message is too long
2024-09-23T17:29:35.597832+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:29:35.597832+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:29:35.597832+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:29:35.597832+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:29:46.684364+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:29:46.684364+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:29:46.684364+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:29:46.684364+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:29:47.022003+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 4960
2024-09-23T17:29:47.022003+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 4960
2024-09-23T17:29:47.022003+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 4960
2024-09-23T17:29:47.022003+0300  ERROR  Ошибка при отправке сообщения: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 4960
2024-09-23T17:31:51.561726+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:31:51.561726+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:31:51.561726+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:31:51.561726+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:31:51.561726+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:32:05.236076+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:32:05.236076+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:32:05.236076+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:32:05.236076+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:32:05.236076+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:32:05.652218+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:32:05.652218+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:32:05.652218+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:32:05.652218+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:32:05.652218+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:32:50.465260+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:32:50.465260+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:32:50.465260+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:32:50.465260+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:32:50.465260+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:32:50.465260+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:32:50.465260+0300  INFO  API_OPEN_AI обработан
2024-09-23T17:33:14.921946+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:33:14.921946+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:33:14.921946+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:33:14.921946+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:33:14.921946+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:33:14.921946+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:33:14.921946+0300  INFO  Ответ GPT gpt-4o получен
2024-09-23T17:33:15.317912+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:33:15.317912+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:33:15.317912+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:33:15.317912+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:33:15.317912+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:33:15.317912+0300  INFO  Ответ gpt получен и отправлен пользователю
2024-09-23T17:33:15.317912+0300  INFO  Ответ gpt получен и отправлен пользователю
